<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üóæ ÏùºÎ≥∏Ïñ¥ Îã®Ïñ¥ Í≥µÎ∂Ä</title>
    
    <!-- PWA Î©îÌÉÄ ÌÉúÍ∑∏Îì§ -->
    <meta name="description" content="ÏùºÎ≥∏Ïñ¥ Îã®Ïñ¥ÏôÄ ÌûàÎùºÍ∞ÄÎÇòÎ•º ÏâΩÍ≤å Í≥µÎ∂ÄÌï† Ïàò ÏûàÎäî Ïï± ^_^">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ÏùºÎ≥∏Ïñ¥Í≥µÎ∂Ä">
    <meta name="msapplication-TileColor" content="#667eea">
    <link rel="manifest" href="./manifest.json">
    
    <!-- ÏïÑÏù¥ÏΩòÎì§ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjNjY3ZWVhIiByeD0iMjQiLz4KPHA+8J+Yr/CfmLDwn5iy8J+Ys+CfmLfwn5i78J+YvvCfmL88L3A+DQo8L3N2Zz4=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjNjY3ZWVhIiByeD0iMjQiLz4KPHA+8J+Yr/CfmLDwn5iy8J+Ys+CfmLfwn5i78J+YvvCfmL88L3A+DQo8L3N2Zz4=">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav {
            display: flex;
            gap: 1rem;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .main {
            flex: 1;
            padding: 2rem;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .quiz-word {
            text-align: center;
            margin: 2rem 0;
        }

        .kanji {
            font-size: 4rem;
            color: #9b59b6;
            margin-bottom: 1rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .hiragana {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .input-group {
            margin: 1.5rem 0;
        }

        .input-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .input-field {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .input-field:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .score {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 2rem;
        }

        .result {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 12px;
            animation: fadeIn 0.5s ease;
        }

        .result.correct {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }

        .result.incorrect {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .result.partial {
            background: rgba(243, 156, 18, 0.1);
            color: #d68910;
            border-left: 4px solid #f39c12;
        }

        .word-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e1e8ed;
            border-radius: 12px;
            padding: 1rem;
        }

        .word-item {
            padding: 1rem;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .word-item:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 1rem 0;
        }

        .status-success {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }

        .status-error {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .hangul-converter {
            background: rgba(52, 152, 219, 0.05);
            border: 2px dashed #3498db;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-weight: 500;
            font-size: 1rem;
            min-width: 300px;
            max-width: 400px;
            animation: slideInFromRight 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification.success {
            background: rgba(46, 204, 113, 0.9);
            color: white;
            border-color: rgba(46, 204, 113, 0.3);
        }

        .notification.error {
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border-color: rgba(231, 76, 60, 0.3);
        }

        .notification.warning {
            background: rgba(241, 196, 15, 0.9);
            color: white;
            border-color: rgba(241, 196, 15, 0.3);
        }

        .notification.info {
            background: rgba(52, 152, 219, 0.9);
            color: white;
            border-color: rgba(52, 152, 219, 0.3);
        }

        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.8;
            margin-left: auto;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-close:hover {
            opacity: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-in {
            animation: slideIn 0.3s ease;
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .header > div:nth-child(2) {
                flex-wrap: wrap;
                justify-content: center;
            }

            .header select {
                min-width: 200px;
            }
            
            .main {
                padding: 1rem;
            }
            
            .kanji {
                font-size: 3rem;
            }
            
            .hiragana {
                font-size: 2rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }

        /* Ïª§Ïä§ÌÖÄ ÌåùÏóÖ Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .custom-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .custom-popup.show {
            opacity: 1;
            visibility: visible;
        }
        
        .popup-content {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.7);
            transition: transform 0.3s ease;
        }
        
        .custom-popup.show .popup-content {
            transform: scale(1);
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f2f6;
        }
        
        .popup-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }
        
        .popup-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #7f8c8d;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .popup-close:hover {
            background-color: #f1f2f6;
            color: #e74c3c;
        }
        
        .popup-body {
            margin-bottom: 2rem;
        }
        
        .popup-message {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #34495e;
            margin-bottom: 1.5rem;
        }
        
        .popup-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .popup-btn {
            padding: 0.8rem 1.8rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .popup-btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .popup-btn-primary:hover {
            background: linear-gradient(45deg, #2980b9, #1abc9c);
            transform: translateY(-2px);
        }
        
        .popup-btn-secondary {
            background: #ecf0f1;
            color: #34495e;
            border: 2px solid #bdc3c7;
        }
        
        .popup-btn-secondary:hover {
            background: #d5dbdb;
            border-color: #95a5a6;
        }
        
        .popup-btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .popup-btn-success:hover {
            background: linear-gradient(45deg, #229954, #27ae60);
            transform: translateY(-2px);
        }
        
        .popup-btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .popup-btn-danger:hover {
            background: linear-gradient(45deg, #c0392b, #a93226);
            transform: translateY(-2px);
        }

        /* ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶º Ìö®Í≥º */
        .hiragana-container {
            position: relative;
            display: inline-block;
            margin: 2rem 0;
        }

        .hiragana-hidden {
            filter: blur(20px);
            color: transparent;
            text-shadow: none;
            user-select: none;
            pointer-events: none;
        }

        .hiragana-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
            animation: pulse 2s infinite;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            white-space: nowrap;
            z-index: 10;
        }

        .hiragana-toggle-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background: rgba(52, 152, 219, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .hiragana-toggle-btn:hover {
            background: rgba(41, 128, 185, 0.9);
            transform: scale(1.1);
        }

        .quiz-word {
            position: relative;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }

        /* ÌÄ¥Ï¶à ÌôîÎ©¥ Ï¶êÍ≤®Ï∞æÍ∏∞ Î≤ÑÌäº ÏµúÏ†ÅÌôî */
        .quiz-favorite-btn {
            position: absolute;
            top: -10px;
            left: -10px;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 5;
            color: white;
            backdrop-filter: blur(10px);
        }

        .quiz-favorite-btn:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .quiz-favorite-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        /* Î≥Ñ Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º */
        @keyframes starPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .quiz-favorite-btn.favorited {
            animation: starPulse 0.6s ease-in-out;
        }
        
        /* Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
                margin: 0;
            }
            
            .card {
                padding: 1rem;
                margin-bottom: 1rem;
                border-radius: 12px;
            }
            
            .quiz-word .kanji {
                font-size: 2.5rem !important;
            }
            
            .quiz-word .hiragana {
                font-size: 1.8rem !important;
            }
            
            .btn-group {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .btn {
                width: 100%;
                min-width: auto !important;
                padding: 1rem;
                font-size: 1rem;
            }
            
            .input-field {
                font-size: 1rem;
                padding: 1rem;
            }
            
            .nav-btn {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
            
            /* 2Îã®Í≥Ñ ÌÄ¥Ï¶à ÏÑ†ÌÉù Î≤ÑÌäºÎì§ */
            div[style*="display: flex"][style*="gap: 1rem"] {
                flex-direction: column !important;
                align-items: stretch !important;
            }
            
            /* Î™®Î∞îÏùºÏóêÏÑú Î≥ÄÌôò ÏïàÎÇ¥ ÌÖçÏä§Ìä∏ ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            div[style*="background: rgba(46, 204, 113, 0.1)"] {
                font-size: 0.8rem !important;
            }
        }
        
        /* ÏïÑÏ£º ÏûëÏùÄ ÌôîÎ©¥ (320px Ïù¥Ìïò) */
        @media (max-width: 320px) {
            .card {
                padding: 0.8rem;
            }
            
            .quiz-word .kanji {
                font-size: 2rem !important;
            }
            
            .quiz-word .hiragana {
                font-size: 1.5rem !important;
            }
            
            .btn {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Ïª§Ïä§ÌÖÄ ÌåùÏóÖ Î™®Îã¨ -->
    <div id="customPopup" class="custom-popup">
        <div class="popup-content">
            <div class="popup-header">
                <h3 id="popupTitle" class="popup-title">ÏïåÎ¶º</h3>
                <button class="popup-close" onclick="closeCustomPopup()">√ó</button>
            </div>
            <div class="popup-body">
                <div id="popupMessage" class="popup-message"></div>
            </div>
            <div class="popup-buttons">
                <button id="popupOkBtn" class="popup-btn popup-btn-primary" onclick="closeCustomPopup()">ÌôïÏù∏</button>
                <button id="popupCancelBtn" class="popup-btn popup-btn-secondary" onclick="closeCustomPopup()" style="display: none;">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>


    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Ïª§Ïä§ÌÖÄ ÌåùÏóÖ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
        function showCustomPopup(message, title = 'ÏïåÎ¶º', type = 'info', showCancel = false) {
            const popup = document.getElementById('customPopup');
            const titleElement = document.getElementById('popupTitle');
            const messageElement = document.getElementById('popupMessage');
            const okBtn = document.getElementById('popupOkBtn');
            const cancelBtn = document.getElementById('popupCancelBtn');
            
            // ÎÇ¥Ïö© ÏÑ§Ï†ï
            titleElement.textContent = title;
            messageElement.textContent = message;
            
            // Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏÑ§Ï†ï
            okBtn.className = 'popup-btn ';
            switch(type) {
                case 'success':
                    okBtn.className += 'popup-btn-success';
                    break;
                case 'error':
                case 'danger':
                    okBtn.className += 'popup-btn-danger';
                    break;
                case 'warning':
                    okBtn.className += 'popup-btn-primary';
                    break;
                default:
                    okBtn.className += 'popup-btn-primary';
            }
            
            // Ï∑®ÏÜå Î≤ÑÌäº ÌëúÏãú/Ïà®ÍπÄ
            if (showCancel) {
                cancelBtn.style.display = 'inline-block';
            } else {
                cancelBtn.style.display = 'none';
            }
            
            // ÌåùÏóÖ ÌëúÏãú
            popup.classList.add('show');
            
            return new Promise((resolve) => {
                // ÌôïÏù∏ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú
                okBtn.onclick = () => {
                    closeCustomPopup();
                    resolve(true);
                };
                
                // Ï∑®ÏÜå Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú
                if (showCancel) {
                    cancelBtn.onclick = () => {
                        closeCustomPopup();
                        resolve(false);
                    };
                }
            });
        }
        
        function closeCustomPopup() {
            const popup = document.getElementById('customPopup');
            popup.classList.remove('show');
        }
        
        // ESC ÌÇ§Î°ú ÌåùÏóÖ Îã´Í∏∞
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeCustomPopup();
            }
        });
        
        // Î∞∞Í≤Ω ÌÅ¥Î¶≠ÏúºÎ°ú ÌåùÏóÖ Îã´Í∏∞
        document.getElementById('customPopup').addEventListener('click', function(event) {
            if (event.target === this) {
                closeCustomPopup();
            }
        });

        // ÌôïÏû•Îêú ÌïúÏûê ÏÇ¨Ï†ÑÏóê „Åä„Å® Ï∂îÍ∞Ä
        const kanjiDict = {
            "„Åå„Å£„Åì„ÅÜ": "Â≠¶Ê†°", "„Åõ„Çì„Åõ„ÅÑ": "ÂÖàÁîü", "„Åå„Åè„Åõ„ÅÑ": "Â≠¶Áîü",
            "„Åü„Åπ„ÇÇ„ÅÆ": "È£ü„ÅπÁâ©", "„Åø„Åö": "Ê∞¥", "„Åò„Åã„Çì": "ÊôÇÈñì",
            "„Å®„ÇÇ„Å†„Å°": "ÂèãÈÅî", "„Åã„Åû„Åè": "ÂÆ∂Êóè", "„Åó„Åî„Å®": "‰ªï‰∫ã",
            "„ÅÑ„Åà": "ÂÆ∂", "„ÅÇ„Åü„Åæ": "È†≠", "„Åì„Åì„Çç": "ÂøÉ",
            "„Å¶„Åå„Åø": "ÊâãÁ¥ô", "„Åß„Çì„Çè": "ÈõªË©±", "„Åè„Çã„Åæ": "Ëªä",
            "„Åà„Åç": "ÈßÖ", "„Å≥„Çá„ÅÜ„ÅÑ„Çì": "ÁóÖÈô¢", "„Åé„Çì„Åì„ÅÜ": "ÈäÄË°å",
            "„Åì„ÅÜ„Åà„Çì": "ÂÖ¨Âúí", "„Å®„Åó„Çá„Åã„Çì": "Âõ≥Êõ∏È§®", "„Åã„ÅÑ„Åó„ÇÉ": "‰ºöÁ§æ",
            "„ÅØ„Å™„Åó": "Ë©±", "„Åπ„Çì„Åç„Çá„ÅÜ": "ÂãâÂº∑", "„Åó„ÇÖ„Åè„Å†„ÅÑ": "ÂÆøÈ°å",
            "„Åß„Çì„Åó„ÇÉ": "ÈõªËªä", "„Åò„Å¶„Çì„Åó„ÇÉ": "Ëá™Ëª¢Ëªä", "„Å≤„Åì„ÅÜ„Åç": "È£õË°åÊ©ü",
            
            // Ï∂îÍ∞ÄÎêú Í∏∞Î≥∏ ÌïúÏûêÎì§
            "„Åä„Å®": "Èü≥", "„Åì„Åà": "Â£∞", "„ÇÅ": "ÁõÆ", "„Å¶": "Êâã", 
            "„ÅÇ„Åó": "Ë∂≥", "„ÅÇ„Åü„Åæ": "È†≠", "„Åã„Çâ„Å†": "‰Ωì", "„Å≤„Å®": "‰∫∫",
            "„ÅÑ„Å°": "‰∏Ä", "„Å´": "‰∫å", "„Åï„Çì": "‰∏â", "„Çà„Çì": "Âõõ", "„Åî": "‰∫î",
            "„Çç„Åè": "ÂÖ≠", "„Å™„Å™": "‰∏É", "„ÅØ„Å°": "ÂÖ´", "„Åç„ÇÖ„ÅÜ": "‰πù", "„Åò„ÇÖ„ÅÜ": "ÂçÅ",
            "„Å≤": "Êó•", "„Å§„Åç": "Êúà", "„Åã": "ÁÅ´", "„Åô„ÅÑ": "Ê∞¥", "„ÇÇ„Åè": "Êú®", 
            "„Åç„Çì": "Èáë", "„Å©": "Âúü", "„Å´„Å°": "Êó•", "„Åí„Å§": "Êúà", "„Åã": "ÁÅ´",
            "„ÅÇ„Åã": "Ëµ§", "„ÅÇ„Åä": "Èùí", "„Åó„Çç": "ÁôΩ", "„Åè„Çç": "Èªí", "„Åç„ÅÑ„Çç": "ÈªÑ"
        };

        // ÌôïÏû•Îêú ÌïúÍ∏Ä-ÌûàÎùºÍ∞ÄÎÇò Î≥ÄÌôò (Î≥µÌï©Ïùå, ÏöîÏùå Ìè¨Ìï®)
        const hangulToHiragana = {
            // Í∏∞Î≥∏ Î™®Ïùå (Ï§ëÏöî!)
            '„Öè': '„ÅÇ', '„Ö£': '„ÅÑ', '„Öú': '„ÅÜ', '„Öì': '„Åà', '„Öó': '„Åä',
            '„Öë': '„ÇÑ', '„Öï': '„Çà', '„Ö†': '„ÇÜ', '„Öõ': '„Çà', '„Öò': '„Çè', '„Öô': '„Çè„ÅÑ', '„Öö': '„ÅÜ„Åá',
            '„Öù': '„ÅÜ„Åâ', '„Öû': '„ÅÜ„Åá', '„Öü': '„ÅÜ„ÅÑ', '„Ö¢': '„ÅÜ„ÅÑ', '„Öî': '„Åà', '„Öê': '„Åà',
            
            // Í∏∞Î≥∏ ÏûêÏùå (Îã®ÎèÖ)
            '„Ñ±': '„Åå', '„Ñ¥': '„Çì', '„Ñ∑': '„Å†', '„Ñπ': '„Çâ', '„ÖÅ': '„Åæ', '„ÖÇ': '„Å∞', 
            '„ÖÖ': '„Åï', '„Öá': '', '„Öà': '„Åò', '„Öä': '„Å°', '„Öã': '„Åã', '„Öå': '„Åü', 
            '„Öç': '„Å±', '„Öé': '„ÅØ',
            
            // ÏÜåÏø†Ïò®(Ï¥âÏùå) „ÖÖ ‚Üí „Å£ Ï≤òÎ¶¨
            '„ÖÖ„ÖÖ': '„Å£', '„Å£': '„Å£',
            
            // ÏôÄÌñâ Ï∂îÍ∞Ä (Ï§ëÏöî!)
            'ÏôÄ': '„Çè', 'Ïôú': '„Çè„ÅÑ', 'Ïô∏': '„ÅÜ„Åá', 'Ïõ®': '„ÅÜ„Åá', 'ÏúÑ': '„ÅÜ„ÅÑ', 'Ïùò': '„ÅÜ„ÅÑ',
            
            // Í∏∞Î≥∏ ÏûêÏùå+Î™®Ïùå
            'Í∞Ä': '„Åå', 'Í∞∏': '„Åé„ÇÉ', 'Í±∞': '„Åí', 'Í≤®': '„Åé„Åá', 'Í≥†': '„Åî', 'Íµê': '„Åé„Çá', 'Íµ¨': '„Åê', 'Í∑ú': '„Åé„ÇÖ', 'Í∑∏': '„Åê', 'Í∏∞': '„Åé', 'Í∞ú': '„Åå„ÅÑ', 'Í≤å': '„Åí',
            'ÎÇò': '„Å™', 'ÎÉê': '„Å´„ÇÉ', 'ÎÑà': '„Å≠', 'ÎÖÄ': '„Å´„Åá', 'ÎÖ∏': '„ÅÆ', 'Îá®': '„Å´„Çá', 'ÎàÑ': '„Å¨', 'Îâ¥': '„Å´„ÇÖ', 'Îäê': '„Å¨', 'Îãà': '„Å´', 'ÎÇ¥': '„Å™„ÅÑ', 'ÎÑ§': '„Å≠',
            'Îã§': '„Å†', 'Îåú': '„Å¢„ÇÉ', 'Îçî': '„Åß', 'Îéå': '„Å¢„Åá', 'ÎèÑ': '„Å©', 'Îê¥': '„Å¢„Çá', 'Îëê': '„Å•', 'ÎìÄ': '„Å¢„ÇÖ', 'Îìú': '„Å•', 'Îîî': '„Å¢', 'ÎåÄ': '„Å†„ÅÑ', 'Îç∞': '„Åß',
            'Îùº': '„Çâ', 'Îû¥': '„Çä„ÇÉ', 'Îü¨': '„Çå', 'Î†§': '„Çä„Åá', 'Î°ú': '„Çç', 'Î£å': '„Çä„Çá', 'Î£®': '„Çã', 'Î•ò': '„Çä„ÇÖ', 'Î•¥': '„Çã', 'Î¶¨': '„Çä', 'Îûò': '„Çâ„ÅÑ', 'Î†à': '„Çå',
            'Îßà': '„Åæ', 'Î®Ä': '„Åø„ÇÉ', 'Î®∏': '„ÇÅ', 'Î©∞': '„Åø„Åá', 'Î™®': '„ÇÇ', 'Î¨ò': '„Åø„Çá', 'Î¨¥': '„ÇÄ', 'ÎÆ§': '„Åø„ÇÖ', 'ÎØÄ': '„ÇÄ', 'ÎØ∏': '„Åø', 'Îß§': '„Åæ„ÅÑ', 'Î©î': '„ÇÅ',
            'Î∞î': '„Å∞', 'Î±å': '„Å≥„ÇÉ', 'Î≤Ñ': '„Åπ', 'Î≤º': '„Å≥„Åá', 'Î≥¥': '„Åº', 'Îµ§': '„Å≥„Çá', 'Î∂Ä': '„Å∂', 'Î∑∞': '„Å≥„ÇÖ', 'Î∏å': '„Å∂', 'ÎπÑ': '„Å≥', 'Î∞∞': '„Å∞„ÅÑ', 'Î≤†': '„Åπ',
            'ÏÇ¨': '„Åï', 'ÏÉ§': '„Åó„ÇÉ', 'ÏÑú': '„Åõ', 'ÏÖî': '„Åó„Åá', 'ÏÜå': '„Åù', 'Ïáº': '„Åó„Çá', 'Ïàò': '„Åô', 'Ïäà': '„Åó„ÇÖ', 'Ïä§': '„Åô', 'Ïãú': '„Åó', 'ÏÉà': '„Åï„ÅÑ', 'ÏÑ∏': '„Åõ',
            'ÏïÑ': '„ÅÇ', 'Ïïº': '„ÇÑ', 'Ïñ¥': '„Åà', 'Ïó¨': '„ÅÑ„Åá', 'Ïò§': '„Åä', 'Ïöî': '„Çà', 'Ïö∞': '„ÅÜ', 'Ïú†': '„ÇÜ', 'Ïúº': '„ÅÜ', 'Ïù¥': '„ÅÑ', 'Ïï†': '„ÅÇ„ÅÑ', 'Ïóê': '„Åà',
            'Ïûê': '„Åñ', 'Ïüà': '„Åò„ÇÉ', 'Ï†Ä': '„Åú', 'Ï†∏': '„Åò„Åá', 'Ï°∞': '„Åû', 'Ï£†': '„Åò„Çá', 'Ï£º': '„Åö', 'Ï•¨': '„Åò„ÇÖ', 'Ï¶à': '„Åö', 'ÏßÄ': '„Åò', 'Ïû¨': '„Åñ„ÅÑ', 'Ï†ú': '„Åú',
            'Ï∞®': '„Å°„ÇÉ', 'Ï±†': '„Å°„ÇÉ', 'Ï≤ò': '„Å°„Åá', 'Ï≥ê': '„Å°„Åá', 'Ï¥à': '„Å°„Çá', 'Ïµ∏': '„Å°„Çá', 'Ï∂î': '„Å°„ÇÖ', 'Ï∏Ñ': '„Å°„ÇÖ', 'Ï∏†': '„Å§', 'Ïπò': '„Å°', 'Ï±Ñ': '„Å°„ÇÉ„ÅÑ', 'Ï≤¥': '„Å°„Åá',
            'Ïπ¥': '„Åã', 'Ï∫¨': '„Åç„ÇÉ', 'Ïª§': '„Åë', 'Ïºú': '„Åç„Åá', 'ÏΩî': '„Åì', 'ÏøÑ': '„Åç„Çá', 'Ïø†': '„Åè', 'ÌÅê': '„Åç„ÇÖ', 'ÌÅ¨': '„Åè', 'ÌÇ§': '„Åç', 'Ï∫ê': '„Åã„ÅÑ', 'ÏºÄ': '„Åë',
            'ÌÉÄ': '„Åü', 'ÌÉ∏': '„Å°„ÇÉ', 'ÌÑ∞': '„Å¶', 'ÌÖ®': '„Å°„Åá', 'ÌÜ†': '„Å®', 'Ìàê': '„Å°„Çá', 'Ìà¨': '„Å§', 'Ìäú': '„Å°„ÇÖ', 'Ìä∏': '„Å§', 'Ìã∞': '„Å°', 'ÌÉú': '„Åü„ÅÑ', 'ÌÖå': '„Å¶',
            'Ìåå': '„Å±', 'ÌçÑ': '„Å¥„ÇÉ', 'Ìçº': '„Å∫', 'Ìé¥': '„Å¥„Åá', 'Ìè¨': '„ÅΩ', 'Ìëú': '„Å¥„Çá', 'Ìë∏': '„Å∑', 'Ìì®': '„Å¥„ÇÖ', 'ÌîÑ': '„Å∑', 'Ìîº': '„Å¥', 'Ìå®': '„Å±„ÅÑ', 'Ìéò': '„Å∫',
            'Ìïò': '„ÅØ', 'Ìñê': '„Å≤„ÇÉ', 'Ìóà': '„Å∏', 'ÌòÄ': '„Å≤„Åá', 'Ìò∏': '„Åª', 'Ìö®': '„Å≤„Çá', 'ÌõÑ': '„Åµ', 'Ìú¥': '„Å≤„ÇÖ', 'Ìùê': '„Åµ', 'Ìûà': '„Å≤', 'Ìï¥': '„ÅØ„ÅÑ', 'Ìó§': '„Å∏',
            
            // Î∞õÏπ® Ï≤òÎ¶¨ + ÏÜåÏø†Ïò®(Ï¥âÏùå)
            'Í∞ì': '„Åå„Å£', 'ÎÇ´': '„Å™„Å£', 'Îåì': '„Å†„Å£', 'Îûè': '„Çâ„Å£', 'Îßõ': '„Åæ„Å£', 'Î∞ß': '„Å∞„Å£', 'ÏÇø': '„Åï„Å£', 'Ïïó': '„ÅÇ„Å£', 'Ïû£': '„Åñ„Å£', 'Ï∞ª': '„Å°„ÇÉ„Å£', 'Ï∫£': '„Åã„Å£', 'ÌÉì': '„Åü„Å£', 'Ìåü': '„Å±„Å£', 'Ìï´': '„ÅØ„Å£',
            'Í∞ñ': '„Åå„Å£', 'ÎÇÆ': '„Å™„Å£', 'Îã´': '„Å†„Å£', 'Îûí': '„Çâ„Å£', 'Îßû': '„Åæ„Å£', 'Î∞≠': '„Å∞„Å£', 'ÏÉ∑': '„Åï„Å£', 'Ïïö': '„ÅÇ„Å£', 'Ïû¶': '„Åñ„Å£', 'Ï≥á': '„Å°„ÇÉ„Å£', 'Ï∫£': '„Åã„Å£', 'ÌÉØ': '„Åü„Å£', 'Ìåü': '„Å±„Å£', 'Ìï´': '„ÅØ„Å£',
            'Í∞Å': '„Åå„Åè', 'ÎÇô': '„Å™„Åè', 'Îã®': '„Å†„Çì', 'ÎûÄ': '„Çâ„Çì', 'Îßå': '„Åæ„Çì', 'Î∞ò': '„Å∞„Çì', 'ÏÇ∞': '„Åï„Çì', 'Ïïà': '„ÅÇ„Çì', 'Ïûî': '„Åñ„Çì', 'Ï∞¨': '„Å°„ÇÉ„Çì', 'Ïπ∏': '„Åã„Çì', 'ÌÉÑ': '„Åü„Çì', 'Ìåê': '„Å±„Çì', 'Ìïú': '„ÅØ„Çì',
            'Í∞ï': '„Åå„Çì', 'ÎÇ≠': '„Å™„Çì', 'Îãπ': '„Å†„Çì', 'Îûë': '„Çâ„Çì', 'Îßù': '„Åæ„Çì', 'Î∞©': '„Å∞„Çì', 'ÏÉÅ': '„Åï„Çì', 'Ïïô': '„ÅÇ„Çì', 'Ïû•': '„Åñ„Çì', 'Ï∞Ω': '„Å°„ÇÉ„Çì', 'Ï∫â': '„Åã„Çì', 'ÌÉï': '„Åü„Çì', 'Ìå°': '„Å±„Çì', 'Ìï≠': '„ÅØ„Çì',
            
            // ÏÜåÏø†Ïò® Ï°∞Ìï©Îì§ (Ï§ëÏöî!)
            'ÌÇ∑': '„Åç„Å£', 'ÍπÉ': '„Åé„Å£', 'Îãõ': '„Å´„Å£', 'Îîß': '„Å¢„Å£', 'Î¶ø': '„Çä„Å£', 'Î∞ë': '„Åø„Å£', 'Îπó': '„Å≥„Å£', 'ÏãØ': '„Åó„Å£', 'Ïûá': '„ÅÑ„Å£', 'Ïßì': '„Åò„Å£', 
            'Ïπ´': '„Å°„Å£', 'ÌÇ∑': '„Åç„Å£', 'Ìã±': '„Å°„Å£', 'Ìïè': '„Å¥„Å£', 'Ìûõ': '„Å≤„Å£',
            'Ïºì': '„Åë„Å£', 'Í≤ü': '„Åí„Å£', 'ÎÑ∑': '„Å≠„Å£', 'ÎéÉ': '„Åß„Å£', 'Î†õ': '„Çå„Å£', 'Î©ß': '„ÇÅ„Å£', 'Î≤≥': '„Åπ„Å£', 'ÏÖã': '„Åõ„Å£', 'Ïó£': '„Åà„Å£', 'Ï†Ø': '„Åú„Å£',
            'Ï≥á': '„Å°„Åá„Å£', 'Ïºì': '„Åë„Å£', 'ÌÖü': '„Å¶„Å£', 'Ìé´': '„Å∫„Å£', 'Ìó∑': '„Å∏„Å£',
            'ÏΩß': '„Åì„Å£', 'Í≥≥': '„Åî„Å£', 'ÎÜã': '„ÅÆ„Å£', 'Îèó': '„Å©„Å£', 'Î°Ø': '„Çç„Å£', 'Î™ª': '„ÇÇ„Å£', 'Î¥á': '„Åº„Å£', 'ÏÜü': '„Åù„Å£', 'Ïò∑': '„Åä„Å£', 'Ï¢É': '„Åû„Å£',
            'Ï¥õ': '„Å°„Çá„Å£', 'ÏΩß': '„Åì„Å£', 'ÌÜ≥': '„Å®„Å£', 'Ìèø': '„ÅΩ„Å£', 'Ìôã': '„Åª„Å£',
            'Ïø≥': '„Åè„Å£', 'Íµø': '„Åê„Å£', 'Îàó': '„Å¨„Å£', 'Îë£': '„Å•„Å£', 'Î£ª': '„Çã„Å£', 'Î≠á': '„ÇÄ„Å£', 'Î∂ì': '„Å∂„Å£', 'ÏàØ': '„Åô„Å£', 'ÏõÉ': '„ÅÜ„Å£', 'Ï§è': '„Åö„Å£',
            'Ï∂ß': '„Å°„ÇÖ„Å£', 'Ïø≥': '„Åè„Å£', 'ÎúØ': '„Å§„Å£', 'Ìíã': '„Å∑„Å£', 'Ìõó': '„Åµ„Å£',
            
            // ÏöîÏùå („Çá) Ï≤òÎ¶¨
            'Í∞∏': '„Åé„ÇÉ', 'ÎÉê': '„Å´„ÇÉ', 'Îåú': '„Å¢„ÇÉ', 'Îû¥': '„Çä„ÇÉ', 'Î®Ä': '„Åø„ÇÉ', 'Î±å': '„Å≥„ÇÉ', 'ÏÉ§': '„Åó„ÇÉ', 'Ïïº': '„ÇÑ', 'Ïüà': '„Åò„ÇÉ', 'Ï±†': '„Å°„ÇÉ', 'Ï∫¨': '„Åç„ÇÉ', 'ÌÉ∏': '„Å°„ÇÉ', 'ÌçÑ': '„Å¥„ÇÉ', 'Ìñê': '„Å≤„ÇÉ',
            'Í≤®': '„Åé„Åá', 'ÎÖÄ': '„Å´„Åá', 'Îéå': '„Å¢„Åá', 'Î†§': '„Çä„Åá', 'Î©∞': '„Åø„Åá', 'Î≤º': '„Å≥„Åá', 'ÏÖî': '„Åó„Åá', 'Ïó¨': '„ÅÑ„Åá', 'Ï†∏': '„Åò„Åá', 'Ï≥ê': '„Å°„Åá', 'Ïºú': '„Åç„Åá', 'ÌÖ®': '„Å°„Åá', 'Ìé¥': '„Å¥„Åá', 'ÌòÄ': '„Å≤„Åá',
            'Íµê': '„Åé„Çá', 'Îá®': '„Å´„Çá', 'Îê¥': '„Å¢„Çá', 'Î£å': '„Çä„Çá', 'Î¨ò': '„Åø„Çá', 'Îµ§': '„Å≥„Çá', 'Ïáº': '„Åó„Çá', 'Ïöî': '„Çà', 'Ï£†': '„Åò„Çá', 'Ïµ∏': '„Å°„Çá', 'ÏøÑ': '„Åç„Çá', 'Ìàê': '„Å°„Çá', 'Ìëú': '„Å¥„Çá', 'Ìö®': '„Å≤„Çá',
            'Í∑ú': '„Åé„ÇÖ', 'Îâ¥': '„Å´„ÇÖ', 'ÎìÄ': '„Å¢„ÇÖ', 'Î•ò': '„Çä„ÇÖ', 'ÎÆ§': '„Åø„ÇÖ', 'Î∑∞': '„Å≥„ÇÖ', 'Ïäà': '„Åó„ÇÖ', 'Ïú†': '„ÇÜ', 'Ï•¨': '„Åò„ÇÖ', 'Ï∏Ñ': '„Å°„ÇÖ', 'ÌÅê': '„Åç„ÇÖ', 'Ìäú': '„Å°„ÇÖ', 'Ìì®': '„Å¥„ÇÖ', 'Ìú¥': '„Å≤„ÇÖ',
            
            // Ïû•Ïùå Ï≤òÎ¶¨
            'Í∞ÄÏïÑ': '„Åå„ÅÇ', 'ÎÇòÏïÑ': '„Å™„ÅÇ', 'Îã§ÏïÑ': '„Å†„ÅÇ', 'ÎùºÏïÑ': '„Çâ„ÅÇ', 'ÎßàÏïÑ': '„Åæ„ÅÇ', 'Î∞îÏïÑ': '„Å∞„ÅÇ', 'ÏÇ¨ÏïÑ': '„Åï„ÅÇ', 'ÏïÑÏïÑ': '„ÅÇ„ÅÇ', 'ÏûêÏïÑ': '„Åñ„ÅÇ', 'Ï∞®ÏïÑ': '„Å°„ÇÉ„ÅÇ', 'Ïπ¥ÏïÑ': '„Åã„ÅÇ', 'ÌÉÄÏïÑ': '„Åü„ÅÇ', 'ÌååÏïÑ': '„Å±„ÅÇ', 'ÌïòÏïÑ': '„ÅØ„ÅÇ',
            'Í∏∞Ïù¥': '„Åé„ÅÑ', 'ÎãàÏù¥': '„Å´„ÅÑ', 'ÎîîÏù¥': '„Å¢„ÅÑ', 'Î¶¨Ïù¥': '„Çä„ÅÑ', 'ÎØ∏Ïù¥': '„Åø„ÅÑ', 'ÎπÑÏù¥': '„Å≥„ÅÑ', 'ÏãúÏù¥': '„Åó„ÅÑ', 'Ïù¥Ïù¥': '„ÅÑ„ÅÑ', 'ÏßÄÏù¥': '„Åò„ÅÑ', 'ÏπòÏù¥': '„Å°ii', 'ÌÇ§Ïù¥': '„Åç„ÅÑ', 'Ìã∞Ïù¥': '„Å°„ÅÑ', 'ÌîºÏù¥': '„Å¥„ÅÑ', 'ÌûàÏù¥': '„Å≤„ÅÑ',
            'Íµ¨Ïö∞': '„Åê„ÅÜ', 'ÎàÑÏö∞': '„Å¨„ÅÜ', 'ÎëêÏö∞': '„Å•„ÅÜ', 'Î£®Ïö∞': '„Çã„ÅÜ', 'Î¨¥Ïö∞': '„ÇÄ„ÅÜ', 'Î∂ÄÏö∞': '„Å∂„ÅÜ', 'ÏàòÏö∞': '„Åô„ÅÜ', 'Ïö∞Ïö∞': '„ÅÜ„ÅÜ', 'Ï£ºÏö∞': '„Åö„ÅÜ', 'Ï∂îÏö∞': '„Å°„ÇÖ„ÅÜ', 'Ïø†Ïö∞': '„Åè„ÅÜ', 'Ìà¨Ïö∞': '„Å§„ÅÜ', 'Ìë∏Ïö∞': '„Å∑„ÅÜ', 'ÌõÑÏö∞': '„Åµ„ÅÜ',
            'Í≤åÏóê': '„Åí„Åà', 'ÎÑ§Ïóê': '„Å≠„Åà', 'Îç∞Ïóê': '„Åß„Åà', 'Î†àÏóê': '„Çå„Åà', 'Î©îÏóê': '„ÇÅ„Åà', 'Î≤†Ïóê': '„Åπ„Åà', 'ÏÑ∏Ïóê': '„Åõ„Åà', 'ÏóêÏóê': '„Åà„Åà', 'Ï†úÏóê': '„Åú„Åà', 'Ï≤¥Ïóê': '„Å°„Åá„Åà', 'ÏºÄÏóê': '„Åë„Åà', 'ÌÖåÏóê': '„Å¶„Åà', 'ÌéòÏóê': '„Å∫„Åà', 'Ìó§Ïóê': '„Å∏„Åà',
            'Í≥†Ïò§': '„Åî„Åä', 'ÎÖ∏Ïò§': '„ÅÆ„Åä', 'ÎèÑÏò§': '„Å©„Åä', 'Î°úÏò§': '„Çç„Åä', 'Î™®Ïò§': '„ÇÇ„Åä', 'Î≥¥Ïò§': '„Åº„Åä', 'ÏÜåÏò§': '„Åù„Åä', 'Ïò§Ïò§': '„Åä„Åä', 'Ï°∞Ïò§': '„Åû„Åä', 'Ï¥àÏò§': '„Å°„Çá„Åä', 'ÏΩîÏò§': '„Åì„Åä', 'ÌÜ†Ïò§': '„Å®„Åä', 'Ìè¨Ïò§': '„ÅΩ„Åä', 'Ìò∏Ïò§': '„Åª„Åä'
        };

        function JapaneseStudyApp() {
            const [currentTab, setCurrentTab] = useState('quiz');
            const [words, setWords] = useState({});
            const [currentWord, setCurrentWord] = useState(null);
            const [userAnswer, setUserAnswer] = useState('');
            const [score, setScore] = useState(0);
            const [totalQuestions, setTotalQuestions] = useState(0);
            const [result, setResult] = useState(null);
            const [quizStarted, setQuizStarted] = useState(false);
            const [usedWords, setUsedWords] = useState(new Set()); // Ïù¥ÎØ∏ Ï∂úÏ†úÎêú Î¨∏Ï†úÎì§
            const [quizCompleted, setQuizCompleted] = useState(false); // ÌÄ¥Ï¶à ÏôÑÎ£å Ïó¨Î∂Ä
            const [hideHiragana, setHideHiragana] = useState(false); // ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶º Ïó¨Î∂Ä
            
            // Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ Í¥ÄÎ¶¨
            const [wordSets, setWordSets] = useState({}); // Î™®Îì† Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏Îì§
            const [currentSetId, setCurrentSetId] = useState('default'); // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÏÑ∏Ìä∏
            const [setNames, setSetNames] = useState({ default: 'Í∏∞Î≥∏ Îã®Ïñ¥Ïû•' }); // ÏÑ∏Ìä∏ Ïù¥Î¶ÑÎì§
            
            // Îã®Ïñ¥ Ï∂îÍ∞Ä Ìèº
            const [newKanji, setNewKanji] = useState('');
            const [newHiragana, setNewHiragana] = useState('');
            const [newKorean, setNewKorean] = useState('');
            const [hangulInput, setHangulInput] = useState('');
            const [convertedHiragana, setConvertedHiragana] = useState('');
            const [kanjiStatus, setKanjiStatus] = useState('');
            const [kanjiCandidates, setKanjiCandidates] = useState([]);
            const [showNotification, setShowNotification] = useState(false);
            const [notificationMessage, setNotificationMessage] = useState('');
            const [notificationType, setNotificationType] = useState('success'); // success, error, warning, info
            
            // ÏàòÏ†ï Î™®Îìú Í¥ÄÎ†® ÏÉÅÌÉú
            const [isEditMode, setIsEditMode] = useState(false); // ÏàòÏ†ï Î™®ÎìúÏù∏ÏßÄ Ïó¨Î∂Ä
            const [editingWordKey, setEditingWordKey] = useState(null); // ÏàòÏ†ï Ï§ëÏù∏ Îã®Ïñ¥Ïùò ÏõêÎûò ÌÇ§
            
            // Ï¶êÍ≤®Ï∞æÍ∏∞/ÌëúÏãú Í¥ÄÎ†® ÏÉÅÌÉú
            const [favoriteWords, setFavoriteWords] = useState({}); // ÏÑ∏Ìä∏Î≥Ñ Ï¶êÍ≤®Ï∞æÍ∏∞ Îã®Ïñ¥Îì§
            const [showFavoritesOnly, setShowFavoritesOnly] = useState(false); // Ï¶êÍ≤®Ï∞æÍ∏∞Îßå ÌëúÏãú
            const [quizMode, setQuizMode] = useState('all'); // 'all' | 'favorites'
            const [quizType, setQuizType] = useState('korean'); // 'korean' | 'hiragana' | 'both'
            const [convertedQuizAnswer, setConvertedQuizAnswer] = useState(''); // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÏö© Î≥ÄÌôòÎêú ÎãµÏïà
            
            // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏö© ÏÉÅÌÉúÎì§
            const [userKoreanAnswer, setUserKoreanAnswer] = useState(''); // ÌïúÍµ≠Ïñ¥ ÎãµÏïà
            const [userHiraganaAnswer, setUserHiraganaAnswer] = useState(''); // ÌûàÎùºÍ∞ÄÎÇò ÎãµÏïà
            const [convertedHiraganaAnswer, setConvertedHiraganaAnswer] = useState(''); // Î≥ÄÌôòÎêú ÌûàÎùºÍ∞ÄÎÇò
            const [bothQuizResult, setBothQuizResult] = useState({ korean: null, hiragana: null }); // Í∞ÅÍ∞ÅÏùò Ï†ïÎãµ Ïó¨Î∂Ä
            
            // ÌÄ¥Ï¶à ÏÑ†ÌÉù UI ÏÉÅÌÉú
            const [selectedRange, setSelectedRange] = useState('all'); // 'all' | 'favorites'
            const [selectedType, setSelectedType] = useState('korean'); // 'korean' | 'hiragana' | 'both' | 'japanese'
            
            // ÌÄ¥Ï¶à ÏßÑÌñâ ÏÉÅÌÉú
            const [isLoadingNextQuestion, setIsLoadingNextQuestion] = useState(false);

            // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            useEffect(() => {
                loadAllWordSets();
                loadFavoriteWords();
            }, []);

            // ÌòÑÏû¨ ÏÑ∏Ìä∏Í∞Ä Î≥ÄÍ≤ΩÎê† Îïå Îã®Ïñ¥ ÏóÖÎç∞Ïù¥Ìä∏
            useEffect(() => {
                if (wordSets[currentSetId]) {
                    setWords(wordSets[currentSetId]);
                }
            }, [currentSetId, wordSets]);

            // Î™®Îì† Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ Î°úÎìú
            const loadAllWordSets = () => {
                const savedSets = localStorage.getItem('japaneseWordSets');
                const savedSetNames = localStorage.getItem('japaneseSetNames');
                
                if (savedSets && savedSetNames) {
                    try {
                        const parsedSets = JSON.parse(savedSets);
                        const parsedNames = JSON.parse(savedSetNames);
                        setWordSets(parsedSets);
                        setSetNames(parsedNames);
                        
                        // ÌòÑÏû¨ ÏÑ∏Ìä∏ ÏÑ§Ï†ï
                        const savedCurrentSet = localStorage.getItem('currentWordSet') || 'default';
                        if (parsedSets[savedCurrentSet]) {
                            setCurrentSetId(savedCurrentSet);
                            setWords(parsedSets[savedCurrentSet]);
                        }
                        console.log('Ï†ÄÏû•Îêú Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏Îì§ÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§:', Object.keys(parsedSets).length + 'Í∞ú ÏÑ∏Ìä∏');
                    } catch (error) {
                        console.error('Ï†ÄÏû•Îêú ÏÑ∏Ìä∏ Î°úÎìú Ïã§Ìå®:', error);
                        // Í∏∞Î≥∏ Îã®Ïñ¥ ÏÑ∏Ìä∏ ÏÉùÏÑ±
                        createDefaultWordSet();
                    }
                } else {
                    // Í∏∞Î≥∏ Îã®Ïñ¥ ÏÑ∏Ìä∏ ÏÉùÏÑ±
                    createDefaultWordSet();
                }
            };

            // Í∏∞Î≥∏ Îã®Ïñ¥ ÏÑ∏Ìä∏ ÏÉùÏÑ±
            const createDefaultWordSet = () => {
                const defaultWords = {
                    "„Åå„Å£„Åì„ÅÜ": { kanji: "Â≠¶Ê†°", hiragana: "„Åå„Å£„Åì„ÅÜ", korean: "ÌïôÍµê" },
                    "„Åõ„Çì„Åõ„ÅÑ": { kanji: "ÂÖàÁîü", hiragana: "„Åõ„Çì„Åõ„ÅÑ", korean: "ÏÑ†ÏÉùÎãò" },
                    "„Åå„Åè„Åõ„ÅÑ": { kanji: "Â≠¶Áîü", hiragana: "„Åå„Åè„Åõ„ÅÑ", korean: "ÌïôÏÉù" },
                    "„Åü„Åπ„ÇÇ„ÅÆ": { kanji: "È£ü„ÅπÁâ©", hiragana: "„Åü„Åπ„ÇÇ„ÅÆ", korean: "ÏùåÏãù" },
                    "„Åø„Åö": { kanji: "Ê∞¥", hiragana: "„Åø„Åö", korean: "Î¨º" },
                    "„Åò„Åã„Çì": { kanji: "ÊôÇÈñì", hiragana: "„Åò„Åã„Çì", korean: "ÏãúÍ∞Ñ" },
                    "„Å®„ÇÇ„Å†„Å°": { kanji: "ÂèãÈÅî", hiragana: "„Å®„ÇÇ„Å†„Å°", korean: "ÏπúÍµ¨" },
                    "„Åß„Çì„Åó„ÇÉ": { kanji: "ÈõªËªä", hiragana: "„Åß„Çì„Åó„ÇÉ", korean: "Ï†ÑÏ∞®" },
                    "„Å≥„Çá„ÅÜ„ÅÑ„Çì": { kanji: "ÁóÖÈô¢", hiragana: "„Å≥„Çá„ÅÜ„ÅÑ„Çì", korean: "Î≥ëÏõê" },
                    "„Åì„ÅÜ„Åà„Çì": { kanji: "ÂÖ¨Âúí", hiragana: "„Åì„ÅÜ„Åà„Çì", korean: "Í≥µÏõê" }
                };
                
                const initialSets = { default: defaultWords };
                const initialNames = { default: 'ÏùºÎ≥∏Ïñ¥ Îã®Ïñ¥Ïû•' };
                
                setWordSets(initialSets);
                setSetNames(initialNames);
                setWords(defaultWords);
                setCurrentSetId('default');
                
                saveAllSets(initialSets, initialNames, 'default');
                console.log('Í∏∞Î≥∏ Îã®Ïñ¥Ïû•Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§.');
            };

            // Î™®Îì† ÏÑ∏Ìä∏ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            const saveAllSets = (sets, names, currentSet) => {
                localStorage.setItem('japaneseWordSets', JSON.stringify(sets));
                localStorage.setItem('japaneseSetNames', JSON.stringify(names));
                localStorage.setItem('currentWordSet', currentSet);
            };

            // Ï¶êÍ≤®Ï∞æÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            const loadFavoriteWords = () => {
                const savedFavorites = localStorage.getItem('japaneseFavoriteWords');
                if (savedFavorites) {
                    try {
                        const parsedFavorites = JSON.parse(savedFavorites);
                        setFavoriteWords(parsedFavorites);
                        console.log('Ï¶êÍ≤®Ï∞æÍ∏∞ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                    } catch (error) {
                        console.error('Ï¶êÍ≤®Ï∞æÍ∏∞ Î°úÎìú Ïã§Ìå®:', error);
                        setFavoriteWords({});
                    }
                }
            };

            // Ï¶êÍ≤®Ï∞æÍ∏∞ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            const saveFavoriteWords = (favorites) => {
                localStorage.setItem('japaneseFavoriteWords', JSON.stringify(favorites));
                console.log('Ï¶êÍ≤®Ï∞æÍ∏∞ Îç∞Ïù¥ÌÑ∞Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
            };

            // Îã®Ïñ¥ Ï¶êÍ≤®Ï∞æÍ∏∞ ÌÜ†Í∏Ä
            const toggleWordFavorite = (wordKey) => {
                const currentSetFavorites = favoriteWords[currentSetId] || {};
                const isCurrentlyFavorite = currentSetFavorites[wordKey];

                const updatedFavorites = {
                    ...favoriteWords,
                    [currentSetId]: {
                        ...currentSetFavorites,
                        [wordKey]: !isCurrentlyFavorite
                    }
                };

                // falseÏù∏ Ìï≠Î™©Îì§ÏùÄ Ï†úÍ±∞ (Ï†ïÎ¶¨)
                if (!updatedFavorites[currentSetId][wordKey]) {
                    delete updatedFavorites[currentSetId][wordKey];
                }

                setFavoriteWords(updatedFavorites);
                saveFavoriteWords(updatedFavorites);

                const action = !isCurrentlyFavorite ? 'ÌëúÏãú' : 'Ìï¥Ï†ú';
                showAlert(`‚≠ê '${wordKey}' Îã®Ïñ¥Î•º ${action}ÌñàÏäµÎãàÎã§.`, 'info');
            };

            // ÌòÑÏû¨ ÏÑ∏Ìä∏Ïùò Ï¶êÍ≤®Ï∞æÍ∏∞ Îã®Ïñ¥Îì§ Í∞ÄÏ†∏Ïò§Í∏∞
            const getCurrentSetFavorites = () => {
                return favoriteWords[currentSetId] || {};
            };

            // Ï¶êÍ≤®Ï∞æÍ∏∞Îêú Îã®Ïñ¥Îßå ÌïÑÌÑ∞ÎßÅ
            const getFilteredWords = () => {
                if (!showFavoritesOnly) return words;
                
                const currentFavorites = getCurrentSetFavorites();
                const filteredWords = {};
                
                Object.keys(words).forEach(wordKey => {
                    if (currentFavorites[wordKey]) {
                        filteredWords[wordKey] = words[wordKey];
                    }
                });
                
                return filteredWords;
            };

            // ÌòÑÏû¨ ÏÑ∏Ìä∏Ïùò Îã®Ïñ¥Í∞Ä Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ Ï†ÄÏû•
            useEffect(() => {
                if (Object.keys(words).length > 0 && wordSets[currentSetId]) {
                    const updatedSets = {
                        ...wordSets,
                        [currentSetId]: words
                    };
                    setWordSets(updatedSets);
                    saveAllSets(updatedSets, setNames, currentSetId);
                    console.log(`'${setNames[currentSetId]}' ÏÑ∏Ìä∏Í∞Ä ÏûêÎèô Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§:`, Object.keys(words).length + 'Í∞ú Îã®Ïñ¥');
                }
            }, [words]);

            // ÌûàÎùºÍ∞ÄÎÇò ÏûÖÎ†• Ïãú ÌïúÏûê ÏûêÎèô Í≤ÄÏÉâ (API ÏÇ¨Ïö©)
            useEffect(() => {
                const searchKanji = async () => {
                    if (newHiragana) {
                        const foundKanji = await findKanjiForWord(newHiragana);
                        if (foundKanji) {
                            setNewKanji(foundKanji);
                        }
                    } else {
                        setNewKanji('');
                        setKanjiStatus('');
                    }
                };
                
                // ÎîîÎ∞îÏö¥Ïä§ Ï≤òÎ¶¨ (500ms ÌõÑÏóê Í≤ÄÏÉâ)
                const timeoutId = setTimeout(searchKanji, 500);
                return () => clearTimeout(timeoutId);
            }, [newHiragana]);

            // Î≥µÏû°Ìïú ÌïúÍ∏Ä ‚Üí ÌûàÎùºÍ∞ÄÎÇò Î≥ÄÌôò (ÏÜåÏø†Ïò® Ï≤òÎ¶¨ Í∞úÏÑ†)
            const convertHangulToHiragana = useCallback((hangul) => {
                let result = '';
                let i = 0;
                
                while (i < hangul.length) {
                    let found = false;
                    
                    // 4Í∏ÄÏûê Ï°∞Ìï© ÌôïÏù∏ (Ïòà: "ÌÇ§ÌÜ†")
                    if (i + 3 < hangul.length) {
                        const four = hangul.substr(i, 4);
                        if (hangulToHiragana[four]) {
                            result += hangulToHiragana[four];
                            i += 4;
                            found = true;
                        }
                    }
                    
                    // 3Í∏ÄÏûê Ï°∞Ìï© ÌôïÏù∏ (Ïòà: "ÌÇ∑ÌÜ†", "Ïµ∏ÌÜ†")
                    if (!found && i + 2 < hangul.length) {
                        const three = hangul.substr(i, 3);
                        if (hangulToHiragana[three]) {
                            result += hangulToHiragana[three];
                            i += 3;
                            found = true;
                        }
                    }
                    
                    // 2Í∏ÄÏûê Ï°∞Ìï© ÌôïÏù∏ (Ïòà: "ÌÇ∑", "ÏöîÏùå")
                    if (!found && i + 1 < hangul.length) {
                        const two = hangul.substr(i, 2);
                        if (hangulToHiragana[two]) {
                            result += hangulToHiragana[two];
                            i += 2;
                            found = true;
                        }
                    }
                    
                    // 1Í∏ÄÏûê ÌôïÏù∏
                    if (!found) {
                        const one = hangul[i];
                        if (hangulToHiragana[one]) {
                            result += hangulToHiragana[one];
                        } else {
                            // ÏÜåÏø†Ïò® ÌäπÎ≥Ñ Ï≤òÎ¶¨: „ÖÖÍ∞Ä ÏûêÏùå ÏïûÏóê Ïò§Î©¥ „Å£Î°ú Î≥ÄÌôò
                            if (one === '„ÖÖ' && i + 1 < hangul.length) {
                                const nextChar = hangul[i + 1];
                                // Îã§Ïùå Í∏ÄÏûêÍ∞Ä ÏûêÏùåÏúºÎ°ú ÏãúÏûëÌïòÎäî Í∏ÄÏûêÎ©¥ ÏÜåÏø†Ïò®
                                if (['„Ñ±', '„Ñ¥', '„Ñ∑', '„Ñπ', '„ÖÅ', '„ÖÇ', '„ÖÖ', '„Öà', '„Öä', '„Öã', '„Öå', '„Öç', '„Öé',
                                     '„Ñ≤', '„Ñ∏', '„ÖÉ', '„ÖÜ', '„Öâ'].includes(nextChar) ||
                                    ['Í∞Ä', 'ÎÇò', 'Îã§', 'Îùº', 'Îßà', 'Î∞î', 'ÏÇ¨', 'Ïûê', 'Ï∞®', 'Ïπ¥', 'ÌÉÄ', 'Ìåå', 'Ìïò',
                                     'Í∏∞', 'Îãà', 'Îîî', 'Î¶¨', 'ÎØ∏', 'ÎπÑ', 'Ïãú', 'ÏßÄ', 'Ïπò', 'ÌÇ§', 'Ìã∞', 'Ìîº', 'Ìûà',
                                     'Íµ¨', 'ÎàÑ', 'Îëê', 'Î£®', 'Î¨¥', 'Î∂Ä', 'Ïàò', 'Ï£º', 'Ï∂î', 'Ïø†', 'Ìà¨', 'Ìë∏', 'ÌõÑ',
                                     'Í≤å', 'ÎÑ§', 'Îç∞', 'Î†à', 'Î©î', 'Î≤†', 'ÏÑ∏', 'Ï†ú', 'Ï≤¥', 'ÏºÄ', 'ÌÖå', 'Ìéò', 'Ìó§',
                                     'Í≥†', 'ÎÖ∏', 'ÎèÑ', 'Î°ú', 'Î™®', 'Î≥¥', 'ÏÜå', 'Ï°∞', 'Ï¥à', 'ÏΩî', 'ÌÜ†', 'Ìè¨', 'Ìò∏'].some(char => nextChar.startsWith(char))) {
                                    result += '„Å£';
                                } else {
                                    result += one; // Î≥ÄÌôòÌï† Ïàò ÏóÜÎäî Î¨∏ÏûêÎäî Í∑∏ÎåÄÎ°ú
                                }
                            } else {
                                result += one; // Î≥ÄÌôòÌï† Ïàò ÏóÜÎäî Î¨∏ÏûêÎäî Í∑∏ÎåÄÎ°ú
                            }
                        }
                        i += 1;
                    }
                }
                
                return result;
            }, []);

            // ÌïúÍ∏Ä ÏûÖÎ†• Ïãú ÏûêÎèô Î≥ÄÌôò
            useEffect(() => {
                if (hangulInput) {
                    const converted = convertHangulToHiragana(hangulInput);
                    setConvertedHiragana(converted);
                } else {
                    setConvertedHiragana('');
                }
            }, [hangulInput, convertHangulToHiragana]);

            // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÏö© Ïã§ÏãúÍ∞Ñ ÌïúÍ∏Ä Î≥ÄÌôò
            useEffect(() => {
                if (quizType === 'hiragana' && userAnswer) {
                    const converted = convertHangulToHiragana(userAnswer);
                    setConvertedQuizAnswer(converted);
                } else {
                    setConvertedQuizAnswer('');
                }
            }, [userAnswer, quizType, convertHangulToHiragana]);

            // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏö© ÌûàÎùºÍ∞ÄÎÇò Ïã§ÏãúÍ∞Ñ Î≥ÄÌôò
            useEffect(() => {
                if (quizType === 'both' && userHiraganaAnswer) {
                    const converted = convertHangulToHiragana(userHiraganaAnswer);
                    setConvertedHiraganaAnswer(converted);
                } else {
                    setConvertedHiraganaAnswer('');
                }
            }, [userHiraganaAnswer, quizType, convertHangulToHiragana]);

            // APIÎ•º ÌÜµÌïú ÌïúÏûê Í≤ÄÏÉâ (Ïó¨Îü¨ ÌõÑÎ≥¥ Î∞òÌôò)
            const searchKanjiAPI = async (hiragana) => {
                try {
                    setKanjiStatus('üîç ÌïúÏûê ÌõÑÎ≥¥ Í≤ÄÏÉâ Ï§ë...');
                    setKanjiCandidates([]);
                    
                    // Ïó¨Îü¨ CORS ÌîÑÎ°ùÏãú ÏÑúÎπÑÏä§Î•º ÏàúÏ∞®Ï†ÅÏúºÎ°ú ÏãúÎèÑ
                    const proxies = [
                        'https://api.codetabs.com/v1/proxy?quest=',
                        'https://cors-proxy.htmldriven.com/?url=',
                        'https://cors.bridged.cc/',
                        'https://api.allorigins.win/raw?url='
                    ];
                    
                    const jishoUrl = `https://jisho.org/api/v1/search/words?keyword=${encodeURIComponent(hiragana)}`;
                    let data = null;
                    
                    // Í∞Å ÌîÑÎ°ùÏãúÎ•º ÏàúÏ∞®Ï†ÅÏúºÎ°ú ÏãúÎèÑ
                    for (const proxy of proxies) {
                        try {
                            console.log(`ÌîÑÎ°ùÏãú ÏãúÎèÑ: ${proxy}`);
                            const response = await fetch(proxy + encodeURIComponent(jishoUrl), {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json',
                                },
                                timeout: 10000 // 10Ï¥à ÌÉÄÏûÑÏïÑÏõÉ
                            });
                            
                            if (response.ok) {
                                const responseText = await response.text();
                                // JSONÏù∏ÏßÄ ÌôïÏù∏
                                if (responseText.trim().startsWith('{')) {
                                    data = JSON.parse(responseText);
                                    if (data.data) {
                                        console.log(`ÏÑ±Í≥µÌïú ÌîÑÎ°ùÏãú: ${proxy}`);
                                        break;
                                    }
                                }
                            }
                        } catch (proxyError) {
                            console.log(`ÌîÑÎ°ùÏãú ${proxy} Ïã§Ìå®:`, proxyError.message);
                            continue;
                        }
                    }
                    
                    console.log('API ÏùëÎãµ:', data); // ÎîîÎ≤ÑÍπÖÏö©
                    
                    if (data && data.data && data.data.length > 0) {
                        const candidates = [];
                        
                        // Î™®Îì† Í≤∞Í≥ºÏóêÏÑú ÌïúÏûê ÌõÑÎ≥¥Îì§ ÏàòÏßë
                        for (let entry of data.data.slice(0, 8)) { // ÏµúÎåÄ 8Í∞úÎßå
                            if (entry.japanese && entry.japanese.length > 0) {
                                for (let japanese of entry.japanese) {
                                    // ÌïúÏûêÍ∞Ä ÏûàÍ≥†, ÌûàÎùºÍ∞ÄÎÇòÏôÄ Îã§Î•∏ Í≤ΩÏö∞Îßå
                                    if (japanese.word && 
                                        japanese.word !== hiragana && 
                                        /[\u4e00-\u9faf]/.test(japanese.word) &&
                                        !candidates.some(c => c.kanji === japanese.word)) {
                                        
                                        // ÏòÅÏñ¥ Îúª Ï∂îÍ∞Ä
                                        const meanings = entry.senses && entry.senses[0] && entry.senses[0].english_definitions
                                            ? entry.senses[0].english_definitions.slice(0, 3).join(', ')
                                            : '';
                                        
                                        candidates.push({
                                            kanji: japanese.word,
                                            reading: japanese.reading || hiragana,
                                            meanings: meanings
                                        });
                                    }
                                }
                            }
                        }
                        
                        if (candidates.length > 0) {
                            setKanjiCandidates(candidates);
                            setKanjiStatus(`‚úÖ ${candidates.length}Í∞úÏùò ÌïúÏûê ÌõÑÎ≥¥Î•º Ï∞æÏïòÏäµÎãàÎã§`);
                            return candidates[0].kanji; // Ï≤´ Î≤àÏß∏Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú
                        }
                    }
                    
                    // Î™®Îì† ÌîÑÎ°ùÏãúÍ∞Ä Ïã§Ìå®Ìïú Í≤ΩÏö∞ ÏßÅÏ†ë API Ìò∏Ï∂ú ÏãúÎèÑ (CORS ÏóêÎü¨Í∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÏßÄÎßå ÏãúÎèÑÌï¥Î≥º Í∞ÄÏπòÍ∞Ä ÏûàÏùå)
                    console.log('Î™®Îì† ÌîÑÎ°ùÏãú Ïã§Ìå®, ÏßÅÏ†ë API Ìò∏Ï∂ú ÏãúÎèÑ Ï§ë...');
                    try {
                        const directResponse = await fetch(`https://jisho.org/api/v1/search/words?keyword=${encodeURIComponent(hiragana)}`, {
                            mode: 'cors',
                            headers: {
                                'Accept': 'application/json',
                            }
                        });
                        
                        if (directResponse.ok) {
                            const directData = await directResponse.json();
                            if (directData.data && directData.data.length > 0) {
                                const candidates = [];
                                
                                for (let entry of directData.data.slice(0, 8)) {
                                    if (entry.japanese && entry.japanese.length > 0) {
                                        for (let japanese of entry.japanese) {
                                            if (japanese.word && 
                                                japanese.word !== hiragana && 
                                                /[\u4e00-\u9faf]/.test(japanese.word) &&
                                                !candidates.some(c => c.kanji === japanese.word)) {
                                                
                                                const meanings = entry.senses && entry.senses[0] && entry.senses[0].english_definitions
                                                    ? entry.senses[0].english_definitions.slice(0, 3).join(', ')
                                                    : '';
                                                
                                                candidates.push({
                                                    kanji: japanese.word,
                                                    reading: japanese.reading || hiragana,
                                                    meanings: meanings
                                                });
                                            }
                                        }
                                    }
                                }
                                
                                if (candidates.length > 0) {
                                    setKanjiCandidates(candidates);
                                    setKanjiStatus(`‚úÖ ÏßÅÏ†ë API ÏÑ±Í≥µ: ${candidates.length}Í∞ú ÌïúÏûê Î∞úÍ≤¨`);
                                    return candidates[0].kanji;
                                }
                            }
                        }
                    } catch (directError) {
                        console.error('ÏßÅÏ†ë API Ìò∏Ï∂úÎèÑ Ïã§Ìå®:', directError);
                    }
                    
                    setKanjiStatus('‚ùå APIÏóêÏÑú ÌïúÏûê ÌõÑÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                    return '';
                } catch (error) {
                    console.error('API Í≤ÄÏÉâ Ï†ÑÏ≤¥ Ïò§Î•ò:', error);
                    setKanjiStatus('‚ö†Ô∏è API Ïó∞Í≤∞ Ïã§Ìå® - ÎÇ¥Ïû• ÏÇ¨Ï†Ñ ÏÇ¨Ïö©');
                    return '';
                }
            };

            // Í∞úÏÑ†Îêú ÌïúÏûê Í≤ÄÏÉâ (API + ÎÇ¥Ïû• ÏÇ¨Ï†Ñ)
            const findKanjiForWord = async (hiragana) => {
                // 1ÏàúÏúÑ: ÎÇ¥Ïû• ÏÇ¨Ï†ÑÏóêÏÑú Îπ†Î•∏ Í≤ÄÏÉâ
                if (kanjiDict[hiragana]) {
                    setKanjiStatus(`‚úÖ ÎÇ¥Ïû• ÏÇ¨Ï†ÑÏóêÏÑú Î∞úÍ≤¨: ${kanjiDict[hiragana]}`);
                    setKanjiCandidates([{ kanji: kanjiDict[hiragana], reading: hiragana, meanings: 'ÎÇ¥Ïû• ÏÇ¨Ï†Ñ' }]);
                    return kanjiDict[hiragana];
                }
                
                // 2ÏàúÏúÑ: API Í≤ÄÏÉâ (Ïó¨Îü¨ ÌõÑÎ≥¥ Î∞òÌôò)
                const apiResult = await searchKanjiAPI(hiragana);
                if (apiResult) {
                    // API Í≤∞Í≥ºÎ•º ÎÇ¥Ïû• ÏÇ¨Ï†ÑÏóê Ï†ÄÏû•Ìï¥ÏÑú Îã§ÏùåÎ≤àÏóêÎäî Îçî Îπ®Î¶¨
                    kanjiDict[hiragana] = apiResult;
                    return apiResult;
                }
                
                return '';
            };

            // ÌïúÏûê ÌõÑÎ≥¥ ÏÑ†ÌÉù Ìï®Ïàò
            const selectKanjiCandidate = (candidate) => {
                setNewKanji(candidate.kanji);
                setKanjiStatus(`‚úÖ ÏÑ†ÌÉùÎê®: ${candidate.kanji} (${candidate.meanings})`);
                // ÏÑ†ÌÉùÎêú Í≤∞Í≥ºÎ•º ÎÇ¥Ïû• ÏÇ¨Ï†ÑÏóê Ï†ÄÏû•
                kanjiDict[newHiragana] = candidate.kanji;
            };

            // ÏÑ∏Ìä∏ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
            const createNewSet = async () => {
                // Í∞ÑÎã®Ìïú prompt ÏÇ¨Ïö©
                const setName = prompt('ÏÉà Îã®Ïñ¥Ïû•Ïùò Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî:');
                
                if (setName && setName.trim()) {
                    const newSetId = Date.now().toString();
                    const updatedSets = { ...wordSets, [newSetId]: {} };
                    const updatedNames = { ...setNames, [newSetId]: setName.trim() };
                    
                    setWordSets(updatedSets);
                    setSetNames(updatedNames);
                    saveAllSets(updatedSets, updatedNames, currentSetId);
                    
                    showAlert(`üìö '${setName.trim()}' Îã®Ïñ¥Ïû•Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!`, 'success');
                }
            };

            const switchToSet = (setId) => {
                if (wordSets[setId]) {
                    setCurrentSetId(setId);
                    setWords(wordSets[setId]);
                    localStorage.setItem('currentWordSet', setId);
                    showAlert(`üìñ '${setNames[setId]}' Îã®Ïñ¥Ïû•ÏúºÎ°ú Ï†ÑÌôòÌñàÏäµÎãàÎã§.`, 'info');
                }
            };

            const deleteSet = async (setId) => {

                const confirmed = await showCustomPopup(
                    `Ï†ïÎßêÎ°ú '${setNames[setId]}' Îã®Ïñ¥Ïû•ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÇ≠Ï†úÎêú Îã®Ïñ¥Ïû•ÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.`,
                    'Îã®Ïñ¥Ïû• ÏÇ≠Ï†ú ÌôïÏù∏',
                    'danger',
                    true
                );

                if (confirmed) {
                    const updatedSets = { ...wordSets };
                    const updatedNames = { ...setNames };
                    delete updatedSets[setId];
                    delete updatedNames[setId];

                    // ÌòÑÏû¨ ÏÑ∏Ìä∏Í∞Ä ÏÇ≠Ï†úÎêòÎäî Í≤ΩÏö∞ Îã§Î•∏ ÏÑ∏Ìä∏Î°ú Ï†ÑÌôò
                    let newCurrentSet = currentSetId;
                    if (setId === currentSetId) {
                        const remainingSetIds = Object.keys(updatedSets);
                        newCurrentSet = remainingSetIds.length > 0 ? remainingSetIds[0] : '';
                    }
                    
                    setWordSets(updatedSets);
                    setSetNames(updatedNames);
                    if (newCurrentSet !== currentSetId) {
                        setCurrentSetId(newCurrentSet);
                        setWords(newCurrentSet ? updatedSets[newCurrentSet] : {});
                    }
                    
                    saveAllSets(updatedSets, updatedNames, newCurrentSet);
                    showAlert(`üóëÔ∏è '${setNames[setId]}' Îã®Ïñ¥Ïû•Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'info');
                }
            };

            // Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ/Î≥µÏõê Í∏∞Îä•Îì§
            const exportToJSON = () => {
                const dataToExport = {
                    wordSets: wordSets,
                    setNames: setNames,
                    currentSetId: currentSetId,
                    exportDate: new Date().toISOString(),
                    version: "1.0"
                };
                
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `japanese_vocabulary_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showAlert('üìÅ Îã®Ïñ¥Ïû•Ïù¥ JSON ÌååÏùºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Ï°åÏäµÎãàÎã§!', 'success');
            };

            const importFromJSON = async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const importedData = JSON.parse(text);
                    
                    if (!importedData.wordSets || !importedData.setNames) {
                        throw new Error('Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùÄ ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§.');
                    }
                    
                    const confirmed = await showCustomPopup(
                        'Îã®Ïñ¥Ïû•ÏùÑ Í∞ÄÏ†∏Ïò§ÏãúÍ≤†ÏäµÎãàÍπå?\n\nÍ∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Îäî Î∞±ÏóÖÎêú ÌõÑ ÏÉà Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥Îê©ÎãàÎã§.',
                        'Îã®Ïñ¥Ïû• Í∞ÄÏ†∏Ïò§Í∏∞ ÌôïÏù∏',
                        'warning',
                        true
                    );
                    
                    if (confirmed) {
                        // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ
                        const backupData = {
                            wordSets: wordSets,
                            setNames: setNames,
                            currentSetId: currentSetId,
                            backupDate: new Date().toISOString()
                        };
                        localStorage.setItem('japaneseWordSetsBackup', JSON.stringify(backupData));
                        
                        // ÏÉà Îç∞Ïù¥ÌÑ∞ Ï†ÅÏö©
                        setWordSets(importedData.wordSets);
                        setSetNames(importedData.setNames);
                        
                        const firstSetId = importedData.currentSetId || Object.keys(importedData.wordSets)[0];
                        setCurrentSetId(firstSetId);
                        setWords(importedData.wordSets[firstSetId]);
                        
                        saveAllSets(importedData.wordSets, importedData.setNames, firstSetId);
                        
                        showAlert(`üéâ Îã®Ïñ¥Ïû•ÏùÑ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Í∞ÄÏ†∏ÏôîÏäµÎãàÎã§! (${Object.keys(importedData.wordSets).length}Í∞ú ÏÑ∏Ìä∏)`, 'success');
                    }
                } catch (error) {
                    showAlert('‚ùå ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
                }
                
                // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî
                event.target.value = '';
            };

            const exportToCSV = () => {
                let csvContent = 'Set Name,Kanji,Hiragana,Korean,Favorite\n';
                
                Object.entries(wordSets).forEach(([setId, words]) => {
                    const setName = setNames[setId] || setId;
                    Object.entries(words).forEach(([kanji, data]) => {
                        const row = [
                            `"${setName}"`,
                            `"${kanji}"`,
                            `"${data.hiragana || ''}"`,
                            `"${data.korean || ''}"`,
                            data.favorite ? 'true' : 'false'
                        ].join(',');
                        csvContent += row + '\n';
                    });
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `japanese_vocabulary_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showAlert('üìä Îã®Ïñ¥Ïû•Ïù¥ CSV ÌååÏùºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Ï°åÏäµÎãàÎã§!', 'success');
            };

            const importFromCSV = async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const lines = text.split('\n').filter(line => line.trim());
                    
                    if (lines.length < 2) {
                        throw new Error('CSV ÌååÏùºÏù¥ ÎπÑÏñ¥ÏûàÍ±∞ÎÇò ÌòïÏãùÏù¥ ÏûòÎ™ªÎêòÏóàÏäµÎãàÎã§.');
                    }
                    
                    const confirmed = await showCustomPopup(
                        'CSV ÌååÏùºÏóêÏÑú Îã®Ïñ¥Ïû•ÏùÑ Í∞ÄÏ†∏Ïò§ÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÉàÎ°úÏö¥ ÏÑ∏Ìä∏Î°ú Ï∂îÍ∞ÄÎêòÎ©∞ Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Îäî Ïú†ÏßÄÎê©ÎãàÎã§.',
                        'CSV Í∞ÄÏ†∏Ïò§Í∏∞ ÌôïÏù∏',
                        'info',
                        true
                    );
                    
                    if (!confirmed) return;
                    
                    const headers = lines[0].split(',');
                    const newSets = {};
                    const newSetNames = {};
                    
                    for (let i = 1; i < lines.length; i++) {
                        const values = lines[i].split(',').map(v => v.replace(/"/g, '').trim());
                        if (values.length < 4) continue;
                        
                        const [setName, kanji, hiragana, korean, favorite] = values;
                        if (!setName || !kanji) continue;
                        
                        const setId = `imported_${setName.toLowerCase().replace(/[^a-z0-9]/g, '_')}_${Date.now()}`;
                        
                        if (!newSets[setId]) {
                            newSets[setId] = {};
                            newSetNames[setId] = `${setName} (Í∞ÄÏ†∏Ïò¥)`;
                        }
                        
                        newSets[setId][kanji] = {
                            hiragana: hiragana || '',
                            korean: korean || '',
                            favorite: favorite === 'true'
                        };
                    }
                    
                    if (Object.keys(newSets).length === 0) {
                        throw new Error('Ïú†Ìö®Ìïú Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                    
                    const updatedSets = { ...wordSets, ...newSets };
                    const updatedNames = { ...setNames, ...newSetNames };
                    
                    setWordSets(updatedSets);
                    setSetNames(updatedNames);
                    saveAllSets(updatedSets, updatedNames, currentSetId);
                    
                    showAlert(`üìä CSVÏóêÏÑú ${Object.keys(newSets).length}Í∞ú ÏÑ∏Ìä∏Î•º Í∞ÄÏ†∏ÏôîÏäµÎãàÎã§!`, 'success');
                } catch (error) {
                    showAlert('‚ùå CSV ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
                }
                
                event.target.value = '';
            };

            const clearAllData = async () => {
                const confirmed = await showCustomPopup(
                    'Ï†ïÎßêÎ°ú Î™®Îì† Îã®Ïñ¥Ïû• Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÇ≠Ï†úÎêú Îç∞Ïù¥ÌÑ∞Îäî Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.\n\nÏÇ≠Ï†ú Ï†ÑÏóê Î∞±ÏóÖÏùÑ Í∂åÏû•Ìï©ÎãàÎã§!',
                    'Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú',
                    'danger',
                    true
                );
                
                if (confirmed) {
                    // Î∞±ÏóÖ ÏÉùÏÑ±
                    const backupData = {
                        wordSets: wordSets,
                        setNames: setNames,
                        currentSetId: currentSetId,
                        deletedDate: new Date().toISOString()
                    };
                    localStorage.setItem('japaneseWordSetsBackup', JSON.stringify(backupData));
                    
                    // Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                    localStorage.removeItem('japaneseWordSets');
                    localStorage.removeItem('japaneseSetNames');
                    localStorage.removeItem('currentWordSet');
                    
                    // Í∏∞Î≥∏ Îã®Ïñ¥ ÏÑ∏Ìä∏ ÏÉùÏÑ±
                    createDefaultWordSet();
                    showAlert('üóëÔ∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§. (Î∞±ÏóÖ Ï†ÄÏû•Îê®)', 'info');
                }
            };

            const restoreBackup = async () => {
                try {
                    const backupData = localStorage.getItem('japaneseWordSetsBackup');
                    if (!backupData) {
                        showAlert('‚ùå Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'warning');
                        return;
                    }
                    
                    const parsedBackup = JSON.parse(backupData);
                    
                    const confirmed = await showCustomPopup(
                        `Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î•º Î≥µÏõêÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÎ∞±ÏóÖ ÎÇ†Ïßú: ${new Date(parsedBackup.backupDate || parsedBackup.deletedDate).toLocaleString()}\n\nÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Îäî ÎçÆÏñ¥Ïì∞Ïó¨ÏßëÎãàÎã§.`,
                        'Î∞±ÏóÖ Î≥µÏõê ÌôïÏù∏',
                        'warning',
                        true
                    );
                    
                    if (confirmed) {
                        setWordSets(parsedBackup.wordSets);
                        setSetNames(parsedBackup.setNames);
                        setCurrentSetId(parsedBackup.currentSetId);
                        setWords(parsedBackup.wordSets[parsedBackup.currentSetId]);
                        
                        saveAllSets(parsedBackup.wordSets, parsedBackup.setNames, parsedBackup.currentSetId);
                        
                        showAlert('üîÑ Î∞±ÏóÖÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î≥µÏõêÎêòÏóàÏäµÎãàÎã§!', 'success');
                    }
                } catch (error) {
                    showAlert('‚ùå Î∞±ÏóÖ Î≥µÏõê Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
                }
            };

            // ÏïåÎ¶º ÌëúÏãú Ìï®Ïàò (ÎîîÎ≤ÑÍπÖ Ï∂îÍ∞Ä)
            const showAlert = (message, type = 'success') => {
                console.log('ÏïåÎ¶º ÌëúÏãú ÏãúÎèÑ:', { message, type }); // ÎîîÎ≤ÑÍπÖ
                setNotificationMessage(message);
                setNotificationType(type);
                setShowNotification(true);
                
                console.log('ÏïåÎ¶º ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏Îê®:', { showNotification: true, message, type }); // ÎîîÎ≤ÑÍπÖ
                
                // 3Ï¥à ÌõÑ ÏûêÎèôÏúºÎ°ú ÏÇ¨ÎùºÏßê
                setTimeout(() => {
                    setShowNotification(false);
                    console.log('ÏïåÎ¶º ÏûêÎèô Îã´Ìûò'); // ÎîîÎ≤ÑÍπÖ
                }, 3000);
            };

            // ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏ÌïòÎäî Ìó¨Ìçº Ìï®Ïàò
            const hasHiraganaData = (wordKey, targetWords) => {
                if (!targetWords || !targetWords[wordKey]) return false;
                return (targetWords[wordKey]?.hiragana && targetWords[wordKey].hiragana.trim() !== '') || 
                       /^[\u3041-\u3096]+$/.test(wordKey);
            };

            // ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä ÏûàÎäî Îã®Ïñ¥Ïùò Í∞úÏàòÎ•º ÏÑ∏Îäî Ìó¨Ìçº Ìï®Ïàò
            const countHiraganaWords = (targetWords) => {
                if (!targetWords) return 0;
                return Object.keys(targetWords).filter(key => hasHiraganaData(key, targetWords)).length;
            };

            const startQuiz = (mode = 'all', type = 'korean') => {
                let targetWords;
                if (mode === 'favorites') {
                    const currentFavorites = getCurrentSetFavorites();
                    targetWords = {};
                    Object.keys(words).forEach(wordKey => {
                        if (currentFavorites[wordKey]) {
                            targetWords[wordKey] = words[wordKey];
                        }
                    });
                } else {
                    targetWords = words;
                }
                
                // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÎÇò Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏùò Í≤ΩÏö∞ ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä ÏûàÎäî Îã®Ïñ¥Îßå ÌïÑÌÑ∞ÎßÅ
                if (type === 'hiragana' || type === 'both') {
                    const filteredWords = {};
                    Object.keys(targetWords).forEach(key => {
                        if (hasHiraganaData(key, targetWords)) {
                            filteredWords[key] = targetWords[key];
                        }
                    });
                    targetWords = filteredWords;
                }
                
                if (Object.keys(targetWords).length === 0) {
                    if (type === 'hiragana' || type === 'both') {
                        showAlert('ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä Îì±Î°ùÎêú Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§! Î®ºÏ†Ä Îã®Ïñ¥Ïóê ÌûàÎùºÍ∞ÄÎÇòÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî. üà∂', 'warning');
                    } else if (mode === 'favorites') {
                        showAlert('ÌëúÏãúÎêú Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§! Î®ºÏ†Ä Îã®Ïñ¥Ïû•ÏóêÏÑú Îã®Ïñ¥Î•º ÌëúÏãúÌï¥Ï£ºÏÑ∏Ïöî. ‚≠ê', 'warning');
                    } else {
                        showAlert('ÌòÑÏû¨ Îã®Ïñ¥Ïû•Ïù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§! Î®ºÏ†Ä Îã®Ïñ¥Î•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî. üìö', 'warning');
                    }
                    return;
                }
                
                setQuizMode(mode);
                setQuizType(type);
                setQuizStarted(true);
                setScore(0);
                setTotalQuestions(0);
                setUsedWords(new Set()); // Ï∂úÏ†úÎêú Î¨∏Ï†ú Ï¥àÍ∏∞Ìôî
                setQuizCompleted(false);
                setHideHiragana(false); // ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶º ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                setConvertedQuizAnswer(''); // Î≥ÄÌôòÎêú ÎãµÏïà Ï¥àÍ∏∞Ìôî
                setIsLoadingNextQuestion(false); // Î°úÎî© ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                
                // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶à ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                setUserKoreanAnswer('');
                setUserHiraganaAnswer('');
                setConvertedHiraganaAnswer('');
                setBothQuizResult({ korean: null, hiragana: null });
                
                const modeText = mode === 'favorites' ? 'ÌëúÏãúÎêú Îã®Ïñ¥Îßå' : 'Ï†ÑÏ≤¥ Îã®Ïñ¥';
                const typeText = type === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò' : type === 'both' ? 'Îëò Îã§ ÎßûÏ∂îÍ∏∞' : type === 'japanese' ? 'ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'ÌïúÍµ≠Ïñ¥';
                showAlert(`${modeText} ${typeText} ÌÄ¥Ï¶à ÏãúÏûë! ÌôîÏù¥ÌåÖ! üéå`, 'info');
                nextQuestion();
            };

            // ÌÄ¥Ï¶à ÎåÄÏÉÅ Îã®Ïñ¥ Í∞ÄÏ†∏Ïò§Í∏∞
            const getQuizTargetWords = () => {
                let targetWords = {};
                
                if (quizMode === 'favorites') {
                    const currentFavorites = getCurrentSetFavorites();
                    Object.keys(words).forEach(wordKey => {
                        if (currentFavorites[wordKey]) {
                            targetWords[wordKey] = words[wordKey];
                        }
                    });
                } else {
                    targetWords = words;
                }
                
                // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÎÇò Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏùò Í≤ΩÏö∞ ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä ÏûàÎäî Îã®Ïñ¥Îßå ÌïÑÌÑ∞ÎßÅ
                if (quizType === 'hiragana' || quizType === 'both') {
                    const filteredWords = {};
                    Object.keys(targetWords).forEach(key => {
                        // hiragana ÏÜçÏÑ±Ïù¥ ÏûàÍ±∞ÎÇò, ÌÇ§ ÏûêÏ≤¥Í∞Ä ÌûàÎùºÍ∞ÄÎÇòÏù∏ Í≤ΩÏö∞ Ìè¨Ìï®
                        const hasHiragana = (targetWords[key].hiragana && targetWords[key].hiragana.trim() !== '') || 
                                           /^[\u3041-\u3096]+$/.test(key); // ÌûàÎùºÍ∞ÄÎÇò Î¨∏Ïûê Ï≤¥ÌÅ¨
                        if (hasHiragana) {
                            filteredWords[key] = targetWords[key];
                        }
                    });
                    return filteredWords;
                }
                
                return targetWords;
            };

            const nextQuestion = () => {
                // Ïù¥ÎØ∏ Î°úÎî© Ï§ëÏù¥Î©¥ Ï§ëÎ≥µ Ïã§Ìñâ Î∞©ÏßÄ
                if (isLoadingNextQuestion) return;
                
                setIsLoadingNextQuestion(true);
                
                const targetWords = getQuizTargetWords();
                const wordKeys = Object.keys(targetWords);
                
                // Îã®Ïñ¥Í∞Ä ÏóÜÏúºÎ©¥ ÌÄ¥Ï¶àÎ•º ÏãúÏûëÌï† Ïàò ÏóÜÏùå
                if (wordKeys.length === 0) {
                    setQuizCompleted(true);
                    setCurrentWord(null);
                    setIsLoadingNextQuestion(false);
                    return;
                }
                
                // ÌòÑÏû¨ usedWords ÏÉÅÌÉúÎ•º ÏµúÏã†ÏúºÎ°ú Í∞ÄÏ†∏Ïò§Í∏∞
                setUsedWords(currentUsedWords => {
                    const availableWords = wordKeys.filter(key => !currentUsedWords.has(key));
                    
                    // Î™®Îì† Îã®Ïñ¥Î•º Îã§ Ìëº Í≤ΩÏö∞
                    if (availableWords.length === 0) {
                        setQuizCompleted(true);
                        setCurrentWord(null);
                        const accuracy = totalQuestions > 0 ? Math.round((score / totalQuestions) * 100) : 0;
                        const modeText = quizMode === 'favorites' ? 'ÌëúÏãúÎêú Îã®Ïñ¥' : 'Ï†ÑÏ≤¥ Îã®Ïñ¥';
                        const typeText = quizType === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò' : quizType === 'both' ? 'Îëò Îã§ ÎßûÏ∂îÍ∏∞' : quizType === 'japanese' ? 'ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'ÌïúÍµ≠Ïñ¥';
                        const scoreDisplay = quizType === 'both' ? `${score}Ï†ê` : `${score}Î¨∏Ï†ú Ï†ïÎãµ`;
                        showCustomPopup(
                            `üéâ Ï∂ïÌïòÌï©ÎãàÎã§! ${modeText} ${typeText} ÌÄ¥Ï¶àÎ•º ÏôÑÎ£åÌñàÏäµÎãàÎã§!\n\nÏ¥ù ${totalQuestions}Î¨∏Ï†ú Ï§ë ${scoreDisplay}\nÏ†ïÎãµÎ•†: ${accuracy}%\n\nÌÄ¥Ï¶àÎ•º Îã§Ïãú ÏãúÏûëÌïòÎ†§Î©¥ 'ÌÄ¥Ï¶à Ïû¨ÏãúÏûë' Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.`,
                            'ÌÄ¥Ï¶à ÏôÑÎ£å!',
                            'success'
                        );
                        setIsLoadingNextQuestion(false);
                        return currentUsedWords;
                    }
                    
                    // ÏïÑÏßÅ Ï∂úÏ†úÎêòÏßÄ ÏïäÏùÄ Î¨∏Ï†ú Ï§ëÏóêÏÑú ÎûúÎç§ ÏÑ†ÌÉù
                    const randomKey = availableWords[Math.floor(Math.random() * availableWords.length)];
                    
                    // Ï§ëÎ≥µ Î∞©ÏßÄÎ•º ÏúÑÌïú Ï∂îÍ∞Ä Í≤ÄÏ¶ù
                    if (currentUsedWords.has(randomKey)) {
                        console.warn('Ï§ëÎ≥µ Î¨∏Ï†ú ÏÑ†ÌÉù Í∞êÏßÄ:', randomKey);
                        // Ïû¨Í∑ÄÏ†ÅÏúºÎ°ú Îã§Ïãú ÏÑ†ÌÉù (Î¨¥ÌïúÎ£®ÌîÑ Î∞©ÏßÄÎ•º ÏúÑÌï¥ availableWords ÏÇ¨Ïö©)
                        const alternativeWords = availableWords.filter(key => !currentUsedWords.has(key));
                        if (alternativeWords.length > 0) {
                            const alternativeKey = alternativeWords[0]; // Ï≤´ Î≤àÏß∏ ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Îã®Ïñ¥ ÏÑ†ÌÉù
                            setCurrentWord(alternativeKey);
                        } else {
                            setCurrentWord(randomKey); // fallback
                        }
                    } else {
                        setCurrentWord(randomKey);
                    }
                    
                    setUserAnswer('');
                    setResult(null);
                    setConvertedQuizAnswer(''); // Î≥ÄÌôòÎêú ÎãµÏïà Ï¥àÍ∏∞Ìôî
                    
                    // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶à ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                    setUserKoreanAnswer('');
                    setUserHiraganaAnswer('');
                    setConvertedHiraganaAnswer('');
                    setBothQuizResult({ korean: null, hiragana: null });
                    
                    // Î°úÎî© ÏÉÅÌÉú Ìï¥Ï†ú
                    setTimeout(() => setIsLoadingNextQuestion(false), 100);
                    
                    return currentUsedWords;
                });
            };

            const checkAnswer = () => {
                if (!currentWord) return;
                
                if (quizType === 'both') {
                    // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶à Î°úÏßÅ
                    checkBothAnswers();
                } else {
                    // Í∏∞Ï°¥ Îã®Ïùº ÎãµÏïà ÌÄ¥Ï¶à Î°úÏßÅ
                    checkSingleAnswer();
                }
            };

            const checkSingleAnswer = () => {
                let correct, typeText;
                if (quizType === 'hiragana') {
                    // hiragana ÏÜçÏÑ±Ïù¥ ÏûàÏúºÎ©¥ ÏÇ¨Ïö©ÌïòÍ≥†, ÏóÜÏúºÎ©¥ ÌÇ§ ÏûêÏ≤¥Î•º ÌûàÎùºÍ∞ÄÎÇòÎ°ú ÏÇ¨Ïö©
                    correct = words[currentWord].hiragana || currentWord;
                    typeText = 'ÌûàÎùºÍ∞ÄÎÇò';
                } else if (quizType === 'japanese') {
                    // ÏùºÎ≥∏Ïñ¥ ÌÄ¥Ï¶à: ÌûàÎùºÍ∞ÄÎÇò ÌÇ§ ÎòêÎäî ÌïúÏûêÎ•º Ï†ïÎãµÏúºÎ°ú
                    correct = (words[currentWord] && words[currentWord].kanji) || currentWord;
                    typeText = 'ÏùºÎ≥∏Ïñ¥';
                } else {
                    correct = words[currentWord] && words[currentWord].korean;
                    typeText = 'ÌïúÍµ≠Ïñ¥';
                }
                
                setTotalQuestions(prev => prev + 1);
                
                // Ï†ïÎãµ/Ïò§Îãµ Í¥ÄÍ≥ÑÏóÜÏù¥ Ï∂úÏ†úÎêú Î¨∏Ï†úÎ°ú ÌëúÏãú (Ï§ëÎ≥µ Î∞©ÏßÄ)
                setUsedWords(prev => {
                    const newUsedWords = new Set(prev);
                    newUsedWords.add(currentWord);
                    console.log('Î¨∏Ï†ú Ï∂îÍ∞Ä:', currentWord, 'Ï¥ù Ï∂úÏ†ú:', newUsedWords.size);
                    return newUsedWords;
                });
                
                // ÎãµÏïà Ï†ïÎ¶¨ (Í≥µÎ∞± Ï†úÍ±∞)
                let cleanUserAnswer = userAnswer.trim();
                const cleanCorrectAnswer = correct ? correct.trim() : '';
                
                // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÏùº Îïå ÌïúÍ∏Ä ÏûÖÎ†•ÏùÑ ÌûàÎùºÍ∞ÄÎÇòÎ°ú Î≥ÄÌôòÌï¥ÏÑú Ï≤¥ÌÅ¨
                if (quizType === 'hiragana') {
                    const convertedAnswer = convertHangulToHiragana(cleanUserAnswer);
                    // ÏõêÎ≥∏ ÏûÖÎ†•Í≥º Î≥ÄÌôòÎêú ÏûÖÎ†• Îëò Îã§ Ï≤¥ÌÅ¨
                    if (cleanUserAnswer === cleanCorrectAnswer || convertedAnswer === cleanCorrectAnswer) {
                        setScore(prev => prev + 1);
                        setResult({ type: 'correct', message: '‚úÖ Ï†ïÎãµ!' });
                        showAlert('üéâ Ï†ïÎãµÏûÖÎãàÎã§!', 'success');
                    } else {
                        setResult({ type: 'incorrect', message: `‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§. Ï†ïÎãµ: ${correct}` });
                        showAlert(`‚ùå ÌãÄÎ†∏Ïñ¥Ïöî! Ï†ïÎãµÏùÄ "${correct}" ÏûÖÎãàÎã§.`, 'error');
                    }
                } else if (quizType === 'japanese') {
                    // ÏùºÎ≥∏Ïñ¥ ÌÄ¥Ï¶à: ÌïúÏûêÏôÄ ÌûàÎùºÍ∞ÄÎÇò Îëò Îã§ Ï†ïÎãµÏúºÎ°ú Ïù∏Ï†ï
                    const hiraganaAnswer = (words[currentWord] && words[currentWord].hiragana) || currentWord;
                    const kanjiAnswer = words[currentWord] && words[currentWord].kanji;
                    
                    let isCorrect = false;
                    let correctAnswers = [];
                    
                    // ÌûàÎùºÍ∞ÄÎÇò Ï†ïÎãµ Ï≤¥ÌÅ¨ (ÌïúÍµ≠Ïñ¥ ÏûÖÎ†•ÎèÑ ÌûàÎùºÍ∞ÄÎÇòÎ°ú Î≥ÄÌôòÌï¥ÏÑú Ï≤¥ÌÅ¨)
                    const convertedAnswer = convertHangulToHiragana(cleanUserAnswer);
                    if (cleanUserAnswer === hiraganaAnswer.trim() || convertedAnswer === hiraganaAnswer.trim()) {
                        isCorrect = true;
                    }
                    correctAnswers.push(hiraganaAnswer);
                    
                    // ÌïúÏûê Ï†ïÎãµ Ï≤¥ÌÅ¨ (ÌïúÏûêÍ∞Ä ÏûàÎäî Í≤ΩÏö∞)
                    if (kanjiAnswer && kanjiAnswer.trim() !== '') {
                        if (cleanUserAnswer === kanjiAnswer.trim()) {
                            isCorrect = true;
                        }
                        correctAnswers.push(kanjiAnswer);
                    }
                    
                    if (isCorrect) {
                        setScore(prev => prev + 1);
                        setResult({ type: 'correct', message: '‚úÖ Ï†ïÎãµ!' });
                        showAlert('üéâ Ï†ïÎãµÏûÖÎãàÎã§!', 'success');
                    } else {
                        const answerText = correctAnswers.length > 1 ? correctAnswers.join(' / ') : correctAnswers[0];
                        setResult({ type: 'incorrect', message: `‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§. Ï†ïÎãµ: ${answerText}` });
                        showAlert(`‚ùå ÌãÄÎ†∏Ïñ¥Ïöî! Ï†ïÎãµÏùÄ "${answerText}" ÏûÖÎãàÎã§.`, 'error');
                    }
                } else {
                    // ÌïúÍµ≠Ïñ¥ ÌÄ¥Ï¶àÏùº ÎïåÎäî Í∏∞Ï°¥ Î°úÏßÅ
                    if (cleanUserAnswer === cleanCorrectAnswer) {
                        setScore(prev => prev + 1);
                        setResult({ type: 'correct', message: '‚úÖ Ï†ïÎãµ!' });
                        showAlert('üéâ Ï†ïÎãµÏûÖÎãàÎã§!', 'success');
                    } else {
                        setResult({ type: 'incorrect', message: `‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§. Ï†ïÎãµ: ${correct}` });
                        showAlert(`‚ùå ÌãÄÎ†∏Ïñ¥Ïöî! Ï†ïÎãµÏùÄ "${correct}" ÏûÖÎãàÎã§.`, 'error');
                    }
                }
                
                setTimeout(() => {
                    nextQuestion();
                }, 2000);
            };

            const checkBothAnswers = () => {
                const correctKorean = words[currentWord] && words[currentWord].korean;
                const correctHiragana = (words[currentWord] && words[currentWord].hiragana) || currentWord;
                
                setTotalQuestions(prev => prev + 1);
                
                // Ï†ïÎãµ/Ïò§Îãµ Í¥ÄÍ≥ÑÏóÜÏù¥ Ï∂úÏ†úÎêú Î¨∏Ï†úÎ°ú ÌëúÏãú (Ï§ëÎ≥µ Î∞©ÏßÄ)
                setUsedWords(prev => {
                    const newUsedWords = new Set(prev);
                    newUsedWords.add(currentWord);
                    console.log('Î¨∏Ï†ú Ï∂îÍ∞Ä:', currentWord, 'Ï¥ù Ï∂úÏ†ú:', newUsedWords.size);
                    return newUsedWords;
                });
                
                // ÌïúÍµ≠Ïñ¥ ÎãµÏïà Ï≤¥ÌÅ¨
                const cleanKoreanAnswer = userKoreanAnswer.trim();
                const cleanCorrectKorean = correctKorean ? correctKorean.trim() : '';
                const koreanCorrect = cleanKoreanAnswer === cleanCorrectKorean;
                
                // ÌûàÎùºÍ∞ÄÎÇò ÎãµÏïà Ï≤¥ÌÅ¨ (ÌïúÍ∏Ä ÏûÖÎ†•ÎèÑ Î≥ÄÌôòÌï¥ÏÑú Ï≤¥ÌÅ¨)
                const cleanHiraganaAnswer = userHiraganaAnswer.trim();
                const cleanCorrectHiragana = correctHiragana ? correctHiragana.trim() : '';
                const convertedHiraganaInput = convertHangulToHiragana(cleanHiraganaAnswer);
                const hiraganaCorrect = cleanHiraganaAnswer === cleanCorrectHiragana || convertedHiraganaInput === cleanCorrectHiragana;
                
                // Í≤∞Í≥º Ï†ÄÏû•
                setBothQuizResult({
                    korean: koreanCorrect,
                    hiragana: hiraganaCorrect
                });
                
                // Ï†êÏàò Í≥ÑÏÇ∞ (Îëò Îã§ ÎßûÏ∂∞Ïïº 1Ï†ê, ÌïòÎÇòÎßå ÎßûÏ∂îÎ©¥ 0.5Ï†ê)
                if (koreanCorrect && hiraganaCorrect) {
                    setScore(prev => prev + 1);
                    setResult({ type: 'correct', message: 'üéâ ÏôÑÎ≤Ω! ÌïúÍµ≠Ïñ¥ÏôÄ ÌûàÎùºÍ∞ÄÎÇò Î™®Îëê Ï†ïÎãµ!' });
                    showAlert('üéâ ÏôÑÎ≤ΩÌï©ÎãàÎã§! Îëò Îã§ Ï†ïÎãµ!', 'success');
                } else if (koreanCorrect || hiraganaCorrect) {
                    setScore(prev => prev + 0.5);
                    const correctPart = koreanCorrect ? 'ÌïúÍµ≠Ïñ¥' : 'ÌûàÎùºÍ∞ÄÎÇò';
                    const wrongPart = koreanCorrect ? 'ÌûàÎùºÍ∞ÄÎÇò' : 'ÌïúÍµ≠Ïñ¥';
                    const wrongAnswer = koreanCorrect ? correctHiragana : correctKorean;
                    setResult({ 
                        type: 'partial', 
                        message: `‚ö° Î∂ÄÎ∂Ñ Ï†ïÎãµ! ${correctPart}Îäî ÎßûÍ≥†, ${wrongPart}Îäî "${wrongAnswer}"` 
                    });
                    showAlert(`‚ö° Î∂ÄÎ∂Ñ Ï†ïÎãµ! ${correctPart}Îßå ÎßûÏ∑ÑÏñ¥Ïöî. +0.5Ï†ê`, 'warning');
                } else {
                    setResult({ 
                        type: 'incorrect', 
                        message: `‚ùå Î™®Îëê ÌãÄÎ†∏ÏäµÎãàÎã§. ÌïúÍµ≠Ïñ¥: ${correctKorean}, ÌûàÎùºÍ∞ÄÎÇò: ${correctHiragana}` 
                    });
                    showAlert('‚ùå Îëò Îã§ ÌãÄÎ†∏Ïñ¥Ïöî. Îã§Ïãú ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî!', 'error');
                }
                
                setTimeout(() => {
                    nextQuestion();
                }, 3000); // Îëò Îã§ ÎßûÏ∂îÍ∏∞Îäî Í≤∞Í≥ºÎ•º Îçî Ïò§Îûò Î≥¥Ïó¨Ï§å
            };

            const addNewWord = async () => {
                if (!newHiragana || !newKorean) {
                    await showCustomPopup('ÌûàÎùºÍ∞ÄÎÇòÏôÄ ÌïúÍµ≠Ïñ¥Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!', 'ÏûÖÎ†• Ïò§Î•ò', 'warning');
                    return;
                }

                // ÏàòÏ†ï Î™®ÎìúÍ∞Ä ÏïÑÎãê Îïå Ï§ëÎ≥µ ÌôïÏù∏
                if (!isEditMode && words[newHiragana]) {
                    await showCustomPopup(`'${newHiragana}' ÌûàÎùºÍ∞ÄÎÇòÎäî Ïù¥ÎØ∏ Ï°¥Ïû¨Ìï©ÎãàÎã§!`, 'Ï§ëÎ≥µ Ïò§Î•ò', 'error');
                    return;
                }

                // ÏàòÏ†ï Î™®ÎìúÏùº Îïå: ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÍ≥†, ÏÉà ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî Í≤ΩÏö∞
                if (isEditMode && newHiragana !== editingWordKey && words[newHiragana]) {
                    await showCustomPopup(`'${newHiragana}' ÌûàÎùºÍ∞ÄÎÇòÎäî Ïù¥ÎØ∏ Ï°¥Ïû¨Ìï©ÎãàÎã§!`, 'Ï§ëÎ≥µ Ïò§Î•ò', 'error');
                    return;
                }

                const newWordData = {
                    kanji: newKanji.trim(),
                    korean: newKorean.trim()
                };

                setWords(prev => {
                    const updatedWords = { ...prev };
                    
                    // ÏàòÏ†ï Î™®ÎìúÏùº Îïå Í∏∞Ï°¥ Îã®Ïñ¥ ÏÇ≠Ï†ú (ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä Î≥ÄÍ≤ΩÎêú Í≤ΩÏö∞)
                    if (isEditMode && newHiragana !== editingWordKey) {
                        delete updatedWords[editingWordKey];
                    }
                    
                    // ÏÉà Îã®Ïñ¥ Ï∂îÍ∞Ä/ÏàòÏ†ï
                    updatedWords[newHiragana] = newWordData;
                    return updatedWords;
                });

                // Ìèº Ï¥àÍ∏∞Ìôî
                const isEdit = isEditMode;
                setNewKanji('');
                setNewHiragana('');
                setNewKorean('');
                setHangulInput('');
                setKanjiStatus('');
                setKanjiCandidates([]);
                setIsEditMode(false);
                setEditingWordKey(null);
                
                if (isEdit) {
                    showCustomPopup('Îã®Ïñ¥Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§! ‚úÖ', 'ÏàòÏ†ï ÏôÑÎ£å', 'success');
                    setCurrentTab('words'); // Îã®Ïñ¥Ïû•ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                } else {
                    showCustomPopup('Îã®Ïñ¥Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§! üéâ', 'Ï∂îÍ∞Ä ÏôÑÎ£å', 'success');
                }
            };

            const useConvertedWord = () => {
                if (convertedHiragana) {
                    setNewHiragana(convertedHiragana);
                }
            };

            // Îã®Ïñ¥ ÏàòÏ†ï ÏãúÏûë - Îã®Ïñ¥ Ï∂îÍ∞Ä ÌÉ≠ÏúºÎ°ú Ïù¥ÎèôÌïòÏó¨ ÏàòÏ†ï
            const startEditWord = (wordKey) => {
                const wordData = words[wordKey];
                
                // ÏàòÏ†ï Î™®Îìú ÌôúÏÑ±Ìôî
                setIsEditMode(true);
                setEditingWordKey(wordKey);
                
                // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Î•º ÏûÖÎ†• ÌïÑÎìúÏóê ÏÑ§Ï†ï
                setNewHiragana(wordKey);
                setNewKanji(wordData.kanji || '');
                setNewKorean(wordData.korean || '');
                
                // Îã®Ïñ¥ Ï∂îÍ∞Ä ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
                setCurrentTab('add');
                
                showAlert(`üìù '${wordKey}' Îã®Ïñ¥Î•º ÏàòÏ†ï Î™®ÎìúÎ°ú Ï†ÑÌôòÌñàÏäµÎãàÎã§.`, 'info');
            };

            // ÏàòÏ†ï Ï∑®ÏÜå
            const cancelEdit = () => {
                setIsEditMode(false);
                setEditingWordKey(null);
                setNewKanji('');
                setNewHiragana('');
                setNewKorean('');
                setHangulInput('');
                setKanjiStatus('');
                setKanjiCandidates([]);
                
                showAlert('ÏàòÏ†ïÏù¥ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.', 'info');
            };

            const deleteWord = async (wordKey) => {
                const confirmed = await showCustomPopup(
                    `Ï†ïÎßêÎ°ú '${wordKey}' Îã®Ïñ¥Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÇ≠Ï†úÎêú Îã®Ïñ¥Îäî Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.`, 
                    'Îã®Ïñ¥ ÏÇ≠Ï†ú ÌôïÏù∏', 
                    'danger', 
                    true  // Ï∑®ÏÜå Î≤ÑÌäº ÌëúÏãú
                );
                
                if (confirmed) {
                    setWords(prev => {
                        const newWords = { ...prev };
                        delete newWords[wordKey];
                        return newWords;
                    });
                    
                    showAlert(`üóëÔ∏è '${wordKey}' Îã®Ïñ¥Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'info');
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    if (quizType === 'both') {
                        // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏóêÏÑúÎäî Îëò Îã§ ÏûÖÎ†•ÌñàÏùÑ ÎïåÎßå Ï≤¥ÌÅ¨
                        if (userKoreanAnswer.trim() && userHiraganaAnswer.trim()) {
                            checkAnswer();
                        }
                    } else {
                        checkAnswer();
                    }
                }
            };

            const handleBothQuizKeyPress = (e, type) => {
                if (e.key === 'Enter') {
                    if (type === 'korean' && userKoreanAnswer.trim() && userHiraganaAnswer.trim()) {
                        checkAnswer();
                    } else if (type === 'hiragana' && userKoreanAnswer.trim() && userHiraganaAnswer.trim()) {
                        checkAnswer();
                    }
                }
            };

            return (
                <div className="app">
                    {/* Ïª§Ïä§ÌÖÄ ÏïåÎ¶º ÌåùÏóÖ - ÎîîÎ≤ÑÍπÖ */}
                    {console.log('Î†åÎçîÎßÅ Ïãú ÏïåÎ¶º ÏÉÅÌÉú:', { showNotification, notificationMessage, notificationType })}
                    {showNotification && (
                        <div className={`notification ${notificationType}`}>
                            <span>{notificationMessage}</span>
                            <button 
                                className="notification-close"
                                onClick={() => {
                                    console.log('ÏïåÎ¶º ÏàòÎèô Îã´Í∏∞');
                                    setShowNotification(false);
                                }}
                            >
                                √ó
                            </button>
                        </div>
                    )}

                    <header className="header">
                        <div className="logo">
                            üóæ ÏùºÎ≥∏Ïñ¥ Îã®Ïñ¥ Í≥µÎ∂Ä
                        </div>
                        
                        {/* Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ ÏÑ†ÌÉù */}
                        <div style={{ 
                            display: 'flex', 
                            alignItems: 'center', 
                            gap: '1rem',
                            background: 'rgba(255, 255, 255, 0.1)',
                            padding: '0.5rem 1rem',
                            borderRadius: '15px',
                            border: '1px solid rgba(255, 255, 255, 0.2)'
                        }}>
                            <select
                                value={currentSetId}
                                onChange={(e) => switchToSet(e.target.value)}
                                style={{
                                    background: 'rgba(255, 255, 255, 0.9)',
                                    border: '1px solid rgba(255, 255, 255, 0.3)',
                                    borderRadius: '8px',
                                    padding: '0.3rem 0.8rem',
                                    fontSize: '0.9rem',
                                    color: '#2c3e50',
                                    fontWeight: '500'
                                }}
                            >
                                {Object.entries(setNames).map(([setId, setName]) => (
                                    <option key={setId} value={setId}>
                                        üìö {setName} ({Object.keys(wordSets[setId] || {}).length}Í∞ú)
                                    </option>
                                ))}
                            </select>
                            <button
                                onClick={createNewSet}
                                style={{
                                    background: 'rgba(46, 204, 113, 0.8)',
                                    border: 'none',
                                    color: 'white',
                                    padding: '0.3rem 0.8rem',
                                    borderRadius: '8px',
                                    fontSize: '0.8rem',
                                    fontWeight: '500',
                                    cursor: 'pointer',
                                    transition: 'all 0.3s ease'
                                }}
                                onMouseEnter={(e) => e.target.style.background = 'rgba(46, 204, 113, 1)'}
                                onMouseLeave={(e) => e.target.style.background = 'rgba(46, 204, 113, 0.8)'}
                                title="ÏÉà Îã®Ïñ¥Ïû• ÎßåÎì§Í∏∞"
                            >
                                ‚ûï ÏÉà ÏÑ∏Ìä∏
                            </button>
                            {currentSetId !== 'default' && (
                                <button
                                    onClick={() => deleteSet(currentSetId)}
                                    style={{
                                        background: 'rgba(231, 76, 60, 0.8)',
                                        border: 'none',
                                        color: 'white',
                                        padding: '0.3rem 0.8rem',
                                        borderRadius: '8px',
                                        fontSize: '0.8rem',
                                        fontWeight: '500',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease'
                                    }}
                                    onMouseEnter={(e) => e.target.style.background = 'rgba(231, 76, 60, 1)'}
                                    onMouseLeave={(e) => e.target.style.background = 'rgba(231, 76, 60, 0.8)'}
                                    title="ÌòÑÏû¨ Îã®Ïñ¥Ïû• ÏÇ≠Ï†ú"
                                >
                                    üóëÔ∏è
                                </button>
                            )}
                        </div>

                        <nav className="nav">
                            <button 
                                className={`nav-btn ${currentTab === 'quiz' ? 'active' : ''}`}
                                onClick={() => setCurrentTab('quiz')}
                            >
                                üìù ÌÄ¥Ï¶à
                            </button>
                            <button 
                                className={`nav-btn ${currentTab === 'words' ? 'active' : ''}`}
                                onClick={() => setCurrentTab('words')}
                            >
                                üìö Îã®Ïñ¥Ïû•
                            </button>
                            <button 
                                className={`nav-btn ${currentTab === 'add' ? 'active' : ''}`}
                                onClick={() => setCurrentTab('add')}
                            >
                                ‚ûï Îã®Ïñ¥ Ï∂îÍ∞Ä
                            </button>
                            <button 
                                className={`nav-btn ${currentTab === 'data' ? 'active' : ''}`}
                                onClick={() => setCurrentTab('data')}
                            >
                                üíæ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨
                            </button>
                        </nav>
                    </header>

                    <main className="main">
                        <div className="container">
                            {currentTab === 'quiz' && (
                                <div className="card fade-in">
                                    <div className="score">
                                        Ï†êÏàò: {score}/{totalQuestions}
                                        {quizStarted && !quizCompleted && (
                                            <>
                                                <div style={{ fontSize: '0.9rem', color: '#7f8c8d', marginTop: '0.5rem' }}>
                                                    {quizMode === 'favorites' ? '‚≠ê ÌëúÏãúÎêú Îã®Ïñ¥' : 'üìö Ï†ÑÏ≤¥ Îã®Ïñ¥'} {quizType === 'hiragana' ? 'üà∂ ÌûàÎùºÍ∞ÄÎÇò' : quizType === 'both' ? 'üíØ Îëò Îã§ ÎßûÏ∂îÍ∏∞' : quizType === 'japanese' ? 'üóæ ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'üá∞üá∑ ÌïúÍµ≠Ïñ¥'} - 
                                                    ÏßÑÌñâÎ•†: {usedWords.size}/{Object.keys(getQuizTargetWords()).length} Î¨∏Ï†ú ÏôÑÎ£å
                                                </div>
                                                {currentWord && words[currentWord] && words[currentWord].kanji && words[currentWord].kanji !== currentWord && (
                                                    <div style={{ fontSize: '0.8rem', color: '#3498db', marginTop: '0.3rem' }}>
                                                        üí° Ïö∞Ï∏° ÏÉÅÎã® {hideHiragana ? 'üëÅÔ∏è' : 'üôà'} Î≤ÑÌäºÏúºÎ°ú ÌûàÎùºÍ∞ÄÎÇòÎ•º Í∞ÄÎ¶¨Í±∞ÎÇò Î≥º Ïàò ÏûàÏñ¥Ïöî!
                                                    </div>
                                                )}
                                            </>
                                        )}
                                    </div>
                                    
                                    {!quizStarted || quizCompleted ? (
                                        <div style={{ textAlign: 'center' }}>
                                            <h2 style={{ marginBottom: '2rem', color: '#2c3e50' }}>
                                                {quizCompleted ? 
                                                    `üéâ ${quizMode === 'favorites' ? 'ÌëúÏãúÎêú Îã®Ïñ¥' : 'Ï†ÑÏ≤¥ Îã®Ïñ¥'} ${quizType === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò' : quizType === 'both' ? 'Îëò Îã§ ÎßûÏ∂îÍ∏∞' : quizType === 'japanese' ? 'ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'ÌïúÍµ≠Ïñ¥'} ÌÄ¥Ï¶à ÏôÑÎ£å! Îã§Ïãú ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî!` : 
                                                    'ÏùºÎ≥∏Ïñ¥ Îã®Ïñ¥ ÌÄ¥Ï¶àÎ•º ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî! üéå'
                                                }
                                            </h2>
                                            {/* ÍπîÎÅîÌïú 2Îã®Í≥Ñ ÌÄ¥Ï¶à ÏÑ†ÌÉù UI */}
                                            <div style={{ background: 'rgba(52, 152, 219, 0.05)', padding: '2rem', borderRadius: '16px', border: '1px solid rgba(52, 152, 219, 0.2)' }}>
                                                {/* 1Îã®Í≥Ñ: ÌÄ¥Ï¶à Î≤îÏúÑ ÏÑ†ÌÉù */}
                                                <div style={{ marginBottom: '2rem' }}>
                                                    <h3 style={{ color: '#2c3e50', marginBottom: '1rem', fontSize: '1.1rem' }}>üìù ÌÄ¥Ï¶à Î≤îÏúÑ</h3>
                                                    <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap', justifyContent: 'center' }}>
                                                        <button 
                                                            className={`btn ${selectedRange === 'all' ? 'btn-primary' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedRange('all')}
                                                            style={{ 
                                                                minWidth: '180px',
                                                                background: selectedRange === 'all' ? '#3498db' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1.2rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease'
                                                            }}
                                                        >
                                                            üìö Ï†ÑÏ≤¥ Îã®Ïñ¥ ({Object.keys(words).length}Í∞ú)
                                                        </button>
                                                        <button 
                                                            className={`btn ${selectedRange === 'favorites' ? 'btn-primary' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedRange('favorites')}
                                                            disabled={Object.keys(getCurrentSetFavorites()).length === 0}
                                                            style={{ 
                                                                minWidth: '180px',
                                                                background: selectedRange === 'favorites' ? '#3498db' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1.2rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease',
                                                                opacity: Object.keys(getCurrentSetFavorites()).length === 0 ? 0.5 : 1
                                                            }}
                                                        >
                                                            ‚≠ê ÌëúÏãúÎêú Îã®Ïñ¥Îßå ({Object.keys(getCurrentSetFavorites()).length}Í∞ú)
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* 2Îã®Í≥Ñ: ÌÄ¥Ï¶à ÌÉÄÏûÖ ÏÑ†ÌÉù */}
                                                <div style={{ marginBottom: '2rem' }}>
                                                    <h3 style={{ color: '#2c3e50', marginBottom: '1rem', fontSize: '1.1rem' }}>üéØ ÌÄ¥Ï¶à ÌÉÄÏûÖ</h3>
                                                    <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap', justifyContent: 'center' }}>
                                                        <button 
                                                            className={`btn ${selectedType === 'korean' ? 'btn-success' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedType('korean')}
                                                            style={{ 
                                                                minWidth: '150px',
                                                                background: selectedType === 'korean' ? '#27ae60' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease'
                                                            }}
                                                        >
                                                            üá∞üá∑ ÌïúÍµ≠Ïñ¥ Îúª
                                                        </button>
                                                        <button 
                                                            className={`btn ${selectedType === 'hiragana' ? 'btn-success' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedType('hiragana')}
                                                            disabled={(() => {
                                                                const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                return countHiraganaWords(targetWords) === 0;
                                                            })()}
                                                            style={{ 
                                                                minWidth: '150px',
                                                                background: selectedType === 'hiragana' ? '#27ae60' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease',
                                                                opacity: (() => {
                                                                    const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                    return countHiraganaWords(targetWords) === 0 ? 0.5 : 1;
                                                                })()
                                                            }}
                                                        >
                                                            üà∂ ÌûàÎùºÍ∞ÄÎÇò
                                                        </button>
                                                        <button 
                                                            className={`btn ${selectedType === 'both' ? 'btn-success' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedType('both')}
                                                            disabled={(() => {
                                                                const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                return countHiraganaWords(targetWords) === 0;
                                                            })()}
                                                            style={{ 
                                                                minWidth: '150px',
                                                                background: selectedType === 'both' ? '#27ae60' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease',
                                                                opacity: (() => {
                                                                    const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                    return countHiraganaWords(targetWords) === 0 ? 0.5 : 1;
                                                                })()
                                                            }}
                                                        >
                                                            üíØ Îëò Îã§ ÎßûÏ∂îÍ∏∞
                                                        </button>
                                                        <button 
                                                            className={`btn ${selectedType === 'japanese' ? 'btn-success' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedType('japanese')}
                                                            style={{ 
                                                                minWidth: '150px',
                                                                background: selectedType === 'japanese' ? '#27ae60' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease'
                                                            }}
                                                        >
                                                            üóæ ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* 3Îã®Í≥Ñ: ÌÄ¥Ï¶à ÏãúÏûë Î≤ÑÌäº */}
                                                <div style={{ textAlign: 'center' }}>
                                                    <button 
                                                        className="btn btn-primary"
                                                        onClick={() => startQuiz(selectedRange, selectedType)}
                                                        style={{ 
                                                            background: 'linear-gradient(45deg, #e74c3c, #c0392b)',
                                                            border: 'none',
                                                            padding: '1rem 2rem',
                                                            fontSize: '1.1rem',
                                                            fontWeight: 'bold',
                                                            minWidth: '200px'
                                                        }}
                                                        disabled={(() => {
                                                            if (selectedType === 'hiragana' || selectedType === 'both') {
                                                                const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                return countHiraganaWords(targetWords) === 0;
                                                            }
                                                            if (selectedRange === 'favorites') {
                                                                return Object.keys(getCurrentSetFavorites()).length === 0;
                                                            }
                                                            return Object.keys(words).length === 0;
                                                        })()}
                                                    >
                                                        üöÄ ÌÄ¥Ï¶à ÏãúÏûëÌïòÍ∏∞
                                                    </button>
                                                </div>
                                                {quizCompleted && (
                                                    <button 
                                                        className="btn btn-success" 
                                                        onClick={() => {
                                                            const targetWords = getQuizTargetWords();
                                                            const accuracy = totalQuestions > 0 ? Math.round((score / totalQuestions) * 100) : 0;
                                                            const modeText = quizMode === 'favorites' ? 'ÌëúÏãúÎêú Îã®Ïñ¥' : 'Ï†ÑÏ≤¥ Îã®Ïñ¥';
                                                            const typeText = quizType === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò' : quizType === 'both' ? 'Îëò Îã§ ÎßûÏ∂îÍ∏∞' : quizType === 'japanese' ? 'ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'ÌïúÍµ≠Ïñ¥';
                                                            const scoreText = quizType === 'both' ? `Ï†êÏàò: ${score}Ï†ê` : `Ï†ïÎãµÏàò: ${score}Í∞ú`;
                                                            showCustomPopup(
                                                                `üìä ${modeText} ${typeText} ÌÄ¥Ï¶à ÏµúÏ¢Ö Í≤∞Í≥º\n\nÏ¥ù Î¨∏Ï†úÏàò: ${Object.keys(targetWords).length}Í∞ú\n${scoreText}\nÏò§ÎãµÏàò: ${totalQuestions - score}Í∞ú\nÏ†ïÎãµÎ•†: ${accuracy}%\n\n${accuracy >= 90 ? 'üèÜ ÏôÑÎ≤ΩÌï©ÎãàÎã§!' : accuracy >= 70 ? 'üëç ÏûòÌñàÏñ¥Ïöî!' : 'üí™ Îçî Ïó∞ÏäµÌï¥Î≥¥ÏÑ∏Ïöî!'}`,
                                                                'ÏµúÏ¢Ö Ï†êÏàò',
                                                                'info'
                                                            );
                                                        }}
                                                        style={{ marginTop: '1rem' }}
                                                    >
                                                        üìä Í≤∞Í≥º Î≥¥Í∏∞
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            {currentWord && (
                                                <div className="quiz-word">
                                                    {quizType === 'japanese' ? (
                                                        // ÏùºÎ≥∏Ïñ¥ ÌÄ¥Ï¶à: ÌïúÍµ≠Ïñ¥ ÎúªÏùÑ Î¨∏Ï†úÎ°ú ÌëúÏãú
                                                        <div className="korean-question" style={{ 
                                                            fontSize: '2rem', 
                                                            fontWeight: 'bold', 
                                                            color: '#2c3e50',
                                                            textAlign: 'center',
                                                            padding: '2rem'
                                                        }}>
                                                            {words[currentWord] && words[currentWord].korean}
                                                            <div style={{ 
                                                                fontSize: '1rem', 
                                                                color: '#7f8c8d', 
                                                                marginTop: '1rem',
                                                                fontWeight: 'normal'
                                                            }}>
                                                                üëá Ïù¥ ÎúªÏóê Ìï¥ÎãπÌïòÎäî ÏùºÎ≥∏Ïñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        // Í∏∞Ï°¥ ÌÄ¥Ï¶àÎì§: ÏùºÎ≥∏Ïñ¥Î•º Î¨∏Ï†úÎ°ú ÌëúÏãú
                                                        <>
                                                            {words[currentWord] && words[currentWord].kanji && (
                                                                <div className="kanji">{words[currentWord].kanji}</div>
                                                            )}
                                                            <div className="hiragana-container">
                                                                <div className={`hiragana ${hideHiragana ? 'hiragana-hidden' : ''}`}>
                                                                    {currentWord}
                                                                </div>
                                                                {hideHiragana && (
                                                                    <div className="hiragana-overlay">
                                                                        üëÅÔ∏èÌûàÎùºÍ∞ÄÎÇò Î≥¥Í∏∞
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </>
                                                    )}
                                                    {/* ÌïúÏûêÍ∞Ä ÏûàÏùÑ ÎïåÎßå ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶º Î≤ÑÌäº ÌëúÏãú (japanese ÌÄ¥Ï¶àÏóêÏÑúÎäî Ï†úÏô∏) */}
                                                    {quizType !== 'japanese' && words[currentWord] && words[currentWord].kanji && words[currentWord].kanji !== currentWord && (
                                                        <button 
                                                            className="hiragana-toggle-btn"
                                                            onClick={() => setHideHiragana(!hideHiragana)}
                                                            title={hideHiragana ? "ÌûàÎùºÍ∞ÄÎÇò Î≥¥Í∏∞" : "ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶¨Í∏∞"}
                                                        >
                                                            {hideHiragana ? 'üëÅÔ∏è' : 'üôà'}
                                                        </button>
                                                    )}
                                                    
                                                    {/* Ï¶êÍ≤®Ï∞æÍ∏∞/ÌëúÏãú Î≤ÑÌäº */}
                                                    <button 
                                                        className={`quiz-favorite-btn ${getCurrentSetFavorites()[currentWord] ? 'favorited' : ''}`}
                                                        onClick={() => toggleWordFavorite(currentWord)}
                                                        title={getCurrentSetFavorites()[currentWord] ? "ÌëúÏãú Ìï¥Ï†ú" : "ÌëúÏãú Ï∂îÍ∞Ä"}
                                                        style={{
                                                            background: getCurrentSetFavorites()[currentWord] ? 
                                                                'linear-gradient(45deg, #f39c12, #e67e22)' : 
                                                                'rgba(189, 195, 199, 0.8)'
                                                        }}
                                                        onMouseEnter={(e) => {
                                                            if (getCurrentSetFavorites()[currentWord]) {
                                                                e.target.style.background = 'linear-gradient(45deg, #e67e22, #d35400)';
                                                            } else {
                                                                e.target.style.background = 'rgba(149, 165, 166, 0.9)';
                                                            }
                                                        }}
                                                        onMouseLeave={(e) => {
                                                            if (getCurrentSetFavorites()[currentWord]) {
                                                                e.target.style.background = 'linear-gradient(45deg, #f39c12, #e67e22)';
                                                            } else {
                                                                e.target.style.background = 'rgba(189, 195, 199, 0.8)';
                                                            }
                                                        }}
                                                    >
                                                        {getCurrentSetFavorites()[currentWord] ? '‚≠ê' : '‚òÜ'}
                                                    </button>
                                                </div>
                                            )}
                                            
                                            {quizType === 'both' ? (
                                                // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏö© UI
                                                <div>
                                                    <div className="input-group" style={{ marginBottom: '1.5rem' }}>
                                                        <label className="input-label">ÌïúÍµ≠Ïñ¥ Îúª:</label>
                                                        <input
                                                            type="text"
                                                            className="input-field"
                                                            value={userKoreanAnswer}
                                                            onChange={(e) => setUserKoreanAnswer(e.target.value)}
                                                            onKeyPress={(e) => handleBothQuizKeyPress(e, 'korean')}
                                                            placeholder="ÌïúÍµ≠Ïñ¥ ÎúªÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Ïòà: ÌïôÍµê)"
                                                            style={{
                                                                border: bothQuizResult.korean === true ? '2px solid #27ae60' :
                                                                       bothQuizResult.korean === false ? '2px solid #e74c3c' :
                                                                       '1px solid #bdc3c7'
                                                            }}
                                                        />
                                                        {bothQuizResult.korean === true && (
                                                            <div style={{ color: '#27ae60', fontSize: '0.8rem', marginTop: '0.3rem' }}>
                                                                ‚úÖ ÌïúÍµ≠Ïñ¥ Ï†ïÎãµ!
                                                            </div>
                                                        )}
                                                        {bothQuizResult.korean === false && (
                                                            <div style={{ color: '#e74c3c', fontSize: '0.8rem', marginTop: '0.3rem' }}>
                                                                ‚ùå ÌïúÍµ≠Ïñ¥ Ïò§Îãµ
                                                            </div>
                                                        )}
                                                    </div>
                                                    
                                                    <div className="input-group">
                                                        <label className="input-label">ÌûàÎùºÍ∞ÄÎÇò:</label>
                                                        <input
                                                            type="text"
                                                            className="input-field"
                                                            value={userHiraganaAnswer}
                                                            onChange={(e) => setUserHiraganaAnswer(e.target.value)}
                                                            onKeyPress={(e) => handleBothQuizKeyPress(e, 'hiragana')}
                                                            placeholder="ÌûàÎùºÍ∞ÄÎÇòÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (ÌïúÍ∏ÄÎ°úÎèÑ Í∞ÄÎä•)"
                                                            style={{
                                                                border: bothQuizResult.hiragana === true ? '2px solid #27ae60' :
                                                                       bothQuizResult.hiragana === false ? '2px solid #e74c3c' :
                                                                       '1px solid #bdc3c7'
                                                            }}
                                                        />
                                                        {convertedHiraganaAnswer && userHiraganaAnswer && (
                                                            <div style={{
                                                                marginTop: '0.5rem',
                                                                padding: '0.5rem',
                                                                background: 'rgba(46, 204, 113, 0.1)',
                                                                borderRadius: '8px',
                                                                border: '1px solid rgba(46, 204, 113, 0.3)',
                                                                fontSize: '0.9rem',
                                                                color: '#27ae60'
                                                            }}>
                                                                üîÑ ÌïúÍ∏Ä ‚Üí ÌûàÎùºÍ∞ÄÎÇò Î≥ÄÌôò: <strong>{convertedHiraganaAnswer}</strong>
                                                            </div>
                                                        )}
                                                        {bothQuizResult.hiragana === true && (
                                                            <div style={{ color: '#27ae60', fontSize: '0.8rem', marginTop: '0.3rem' }}>
                                                                ‚úÖ ÌûàÎùºÍ∞ÄÎÇò Ï†ïÎãµ!
                                                            </div>
                                                        )}
                                                        {bothQuizResult.hiragana === false && (
                                                            <div style={{ color: '#e74c3c', fontSize: '0.8rem', marginTop: '0.3rem' }}>
                                                                ‚ùå ÌûàÎùºÍ∞ÄÎÇò Ïò§Îãµ
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            ) : (
                                                // Í∏∞Ï°¥ Îã®Ïùº ÎãµÏïà ÌÄ¥Ï¶àÏö© UI
                                                <div className="input-group">
                                                    <label className="input-label">
                                                        {quizType === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò:' : 'ÌïúÍµ≠Ïñ¥ Îúª:'}
                                                    </label>
                                                    <input
                                                        type="text"
                                                        className="input-field"
                                                        value={userAnswer}
                                                        onChange={(e) => {
                                                            setUserAnswer(e.target.value);
                                                            // ÌûàÎùºÍ∞ÄÎÇò/ÏùºÎ≥∏Ïñ¥ ÌÄ¥Ï¶àÏùº Îïå Ïã§ÏãúÍ∞Ñ Î≥ÄÌôò ÌëúÏãú
                                                            if (quizType === 'hiragana' || quizType === 'japanese') {
                                                                const converted = convertHangulToHiragana(e.target.value);
                                                                setConvertedQuizAnswer(converted);
                                                            }
                                                        }}
                                                        onKeyPress={handleKeyPress}
                                                        placeholder={
                                                            quizType === 'hiragana' ? "ÌûàÎùºÍ∞ÄÎÇòÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (ÌïúÍ∏ÄÎ°úÎèÑ Í∞ÄÎä•)" : 
                                                            quizType === 'japanese' ? "ÏùºÎ≥∏Ïñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (ÌïúÍ∏ÄÎ°úÎèÑ Í∞ÄÎä•)" :
                                                            "ÌïúÍµ≠Ïñ¥ ÎúªÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Ïòà: Î®πÎã§)"
                                                        }
                                                    />
                                                    {(quizType === 'hiragana' || quizType === 'japanese') && (
                                                        <div style={{
                                                            marginTop: '0.5rem',
                                                            padding: '0.5rem',
                                                            background: 'rgba(46, 204, 113, 0.1)',
                                                            borderRadius: '8px',
                                                            border: '1px solid rgba(46, 204, 113, 0.3)',
                                                            fontSize: '0.9rem',
                                                            color: '#27ae60'
                                                        }}>
                                                            <div style={{ fontSize: '0.8rem', color: '#666', marginBottom: '0.5rem' }}>
                                                                üí° ÌïúÍ∏ÄÎ°ú ÏûÖÎ†•Ìï¥ÎèÑ ÏûêÎèôÏúºÎ°ú ÌûàÎùºÍ∞ÄÎÇòÎ°ú Î≥ÄÌôòÎêòÏñ¥ Ï±ÑÏ†êÎê©ÎãàÎã§!
                                                            </div>
                                                            <div>
                                                                üîÑ ÌïúÍ∏Ä ‚Üí ÌûàÎùºÍ∞ÄÎÇò Î≥ÄÌôò: <strong>
                                                                    {userAnswer ? convertHangulToHiragana(userAnswer) || userAnswer : '(ÏûÖÎ†•ÌïòÎ©¥ Ïó¨Í∏∞Ïóê Î≥ÄÌôò Í≤∞Í≥ºÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§)'}
                                                                </strong>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            {result && (
                                                <div className={`result ${result.type}`}>
                                                    {result.message}
                                                </div>
                                            )}

                                            <div className="btn-group">
                                                <button 
                                                    className="btn btn-success" 
                                                    onClick={checkAnswer}
                                                    disabled={quizType === 'both' && (!userKoreanAnswer.trim() || !userHiraganaAnswer.trim())}
                                                    title={quizType === 'both' && (!userKoreanAnswer.trim() || !userHiraganaAnswer.trim()) ? 
                                                          'ÌïúÍµ≠Ïñ¥ÏôÄ ÌûàÎùºÍ∞ÄÎÇòÎ•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî' : ''}
                                                >
                                                    {quizType === 'both' ? 'Îëò Îã§ Ï†ïÎãµ ÌôïÏù∏' : 'Ï†ïÎãµ ÌôïÏù∏'}
                                                </button>
                                                <button 
                                                    className="btn btn-warning" 
                                                    onClick={nextQuestion}
                                                    disabled={isLoadingNextQuestion}
                                                >
                                                    {isLoadingNextQuestion ? '‚è≥ Î°úÎî©Ï§ë...' : 'Îã§Ïùå Î¨∏Ï†ú'}
                                                </button>
                                                <button 
                                                    className="btn btn-danger" 
                                                    onClick={async () => {
                                                        const confirmed = await showCustomPopup(
                                                            'ÌÄ¥Ï¶àÎ•º Ï§ëÎã®ÌïòÍ≥† Ï≤òÏùåÎ∂ÄÌÑ∞ Îã§Ïãú ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?', 
                                                            'ÌÄ¥Ï¶à Ïû¨ÏãúÏûë', 
                                                            'warning', 
                                                            true
                                                        );
                                                        if (confirmed) {
                                                            startQuiz(quizMode, quizType);
                                                        }
                                                    }}
                                                >
                                                    üîÑ Ïû¨ÏãúÏûë
                                                </button>
                                            </div>
                                        </>
                                    )}
                                </div>
                            )}

                            {currentTab === 'words' && (
                                <div className="card fade-in">
                                    <h2 style={{ marginBottom: '2rem', color: '#2c3e50' }}>
                                        üìö {setNames[currentSetId]} ({Object.keys(words).length}Í∞ú Îã®Ïñ¥)
                                    </h2>
                                    <div style={{ 
                                        fontSize: '0.9rem', 
                                        color: '#27ae60', 
                                        marginBottom: '1rem', 
                                        padding: '0.8rem',
                                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                                        borderRadius: '8px',
                                        border: '1px solid rgba(46, 204, 113, 0.3)'
                                    }}>
                                        üíæ ÌòÑÏû¨ '{setNames[currentSetId]}' Îã®Ïñ¥Ïû•Ïù¥ ÏÑ†ÌÉùÎêòÏñ¥ ÏûàÏäµÎãàÎã§. Î™®Îì† ÏÑ∏Ìä∏Îäî Î∏åÎùºÏö∞Ï†ÄÏóê ÏûêÎèô Ï†ÄÏû•Îê©ÎãàÎã§!
                                    </div>
                                    
                                    <div style={{
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        marginBottom: '1rem',
                                        padding: '0.5rem',
                                        background: 'rgba(52, 152, 219, 0.1)',
                                        borderRadius: '8px',
                                        border: '1px solid rgba(52, 152, 219, 0.3)'
                                    }}>
                                        <div style={{ fontSize: '0.9rem', color: '#2c3e50' }}>
                                            üìä Ï†ÑÏ≤¥ ÏÑ∏Ìä∏: {Object.keys(setNames).length}Í∞ú | 
                                            Ï†ÑÏ≤¥ Îã®Ïñ¥: {Object.values(wordSets).reduce((total, set) => total + Object.keys(set).length, 0)}Í∞ú |
                                            ÌëúÏãúÎêú Îã®Ïñ¥: {Object.keys(getCurrentSetFavorites()).length}Í∞ú
                                        </div>
                                        <button
                                            className="btn"
                                            onClick={() => setShowFavoritesOnly(!showFavoritesOnly)}
                                            style={{
                                                padding: '0.3rem 0.8rem',
                                                fontSize: '0.8rem',
                                                background: showFavoritesOnly ? 'linear-gradient(45deg, #f39c12, #e67e22)' : 'linear-gradient(45deg, #bdc3c7, #95a5a6)',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '6px'
                                            }}
                                            title={showFavoritesOnly ? "Î™®Îì† Îã®Ïñ¥ Î≥¥Í∏∞" : "ÌëúÏãúÎêú Îã®Ïñ¥Îßå Î≥¥Í∏∞"}
                                        >
                                            {showFavoritesOnly ? 'üìã Ï†ÑÏ≤¥ Î≥¥Í∏∞' : '‚≠ê ÌëúÏãúÎßå Î≥¥Í∏∞'}
                                        </button>
                                    </div>
                                    <div className="word-list">
                                        {Object.entries(getFilteredWords()).map(([hiragana, data]) => {
                                            const isFavorite = getCurrentSetFavorites()[hiragana];
                                            return (
                                                <div key={hiragana} className="word-item slide-in" style={{
                                                    border: isFavorite ? '2px solid #f39c12' : '1px solid #e1e8ed',
                                                    backgroundColor: isFavorite ? 'rgba(241, 196, 15, 0.05)' : 'transparent'
                                                }}>
                                                    <div>
                                                        <strong style={{ color: isFavorite ? '#f39c12' : 'inherit' }}>
                                                            {isFavorite ? '‚≠ê ' : ''}{hiragana}
                                                        </strong>
                                                        {data.kanji && <span> ({data.kanji})</span>}
                                                        <span> - {data.korean}</span>
                                                    </div>
                                                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                                                        <button 
                                                            className="btn"
                                                            style={{ 
                                                                padding: '0.5rem 1rem', 
                                                                fontSize: '0.9rem',
                                                                background: isFavorite ? 'linear-gradient(45deg, #f39c12, #e67e22)' : 'linear-gradient(45deg, #bdc3c7, #95a5a6)',
                                                                color: 'white'
                                                            }}
                                                            onClick={() => toggleWordFavorite(hiragana)}
                                                            title={isFavorite ? "Ï¶êÍ≤®Ï∞æÍ∏∞ Ìï¥Ï†ú" : "Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä"}
                                                        >
                                                            {isFavorite ? '‚≠ê ÌëúÏãúÎê®' : '‚òÜ ÌëúÏãú'}
                                                        </button>
                                                        <button 
                                                            className="btn btn-primary"
                                                            style={{ 
                                                                padding: '0.5rem 1rem', 
                                                                fontSize: '0.9rem',
                                                                background: 'linear-gradient(45deg, #3498db, #2980b9)'
                                                            }}
                                                            onClick={() => startEditWord(hiragana)}
                                                            title="Îã®Ïñ¥ ÏàòÏ†ïÌïòÍ∏∞"
                                                        >
                                                            ‚úèÔ∏è ÏàòÏ†ï
                                                        </button>
                                                        <button 
                                                            className="btn btn-danger"
                                                            style={{ padding: '0.5rem 1rem', fontSize: '0.9rem' }}
                                                            onClick={async () => await deleteWord(hiragana)}
                                                            title="ÌÅ¥Î¶≠ÌïòÎ©¥ ÌôïÏù∏ ÌåùÏóÖÏù¥ ÎÇòÌÉÄÎÇ©ÎãàÎã§"
                                                        >
                                                            üóëÔ∏è ÏÇ≠Ï†ú
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}

                            {currentTab === 'add' && (
                                <div className="card fade-in">
                                    <h2 style={{ marginBottom: '2rem', color: '#2c3e50' }}>
                                        {isEditMode ? `üìù Îã®Ïñ¥ ÏàòÏ†ï: ${editingWordKey}` : '‚ûï ÏÉà Îã®Ïñ¥ Ï∂îÍ∞Ä'}
                                    </h2>
                                    
                                    {isEditMode && (
                                        <div style={{
                                            background: 'rgba(241, 196, 15, 0.1)',
                                            border: '2px solid rgba(241, 196, 15, 0.3)',
                                            borderRadius: '12px',
                                            padding: '1rem',
                                            marginBottom: '2rem'
                                        }}>
                                            <div style={{ color: '#f39c12', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                üîÑ ÏàòÏ†ï Î™®Îìú ÌôúÏÑ±Ìôî
                                            </div>
                                            <div style={{ color: '#2c3e50', fontSize: '0.9rem', marginBottom: '1rem' }}>
                                                '{editingWordKey}' Îã®Ïñ¥Î•º ÏàòÏ†ïÌïòÍ≥† ÏûàÏäµÎãàÎã§. Î™®Îì† ÌïÑÎìúÎ•º ÏûêÏú†Î°≠Í≤å Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§.
                                            </div>
                                            <button 
                                                className="btn btn-secondary"
                                                onClick={cancelEdit}
                                                style={{ 
                                                    padding: '0.5rem 1rem', 
                                                    fontSize: '0.9rem',
                                                    background: '#95a5a6'
                                                }}
                                            >
                                                ‚ùå ÏàòÏ†ï Ï∑®ÏÜå
                                            </button>
                                        </div>
                                    )}
                                    
                                    <div className="hangul-converter">
                                        <div className="input-group">
                                            <label className="input-label">ÌïúÍ∏Ä Î∞úÏùå (ÏûêÎèôÎ≥ÄÌôò):</label>
                                            <input
                                                type="text"
                                                className="input-field"
                                                value={hangulInput}
                                                onChange={(e) => setHangulInput(e.target.value)}
                                                placeholder="Ïòà: Í∞ìÏΩîÏö∞, ÏÑºÏÑ∏Ïù¥, Í∞∏Ïø†"
                                            />
                                            <div style={{ fontSize: '0.9rem', color: '#666', marginTop: '0.5rem' }}>
                                                üí° Î≥µÏû°Ìïú Î∞úÏùåÎèÑ ÏßÄÏõê: "Í∞ì" („Å§), "ÏÉ§" („Åó„ÇÉ), "ÌÅê" („Åç„ÇÖ) Îì±
                                            </div>
                                        </div>
                                        {convertedHiragana && (
                                            <div style={{ marginTop: '1rem', padding: '1rem', backgroundColor: 'rgba(52, 152, 219, 0.1)', borderRadius: '8px' }}>
                                                <div style={{ color: '#3498db', fontWeight: 'bold', fontSize: '1.2rem' }}>
                                                    üéå Î≥ÄÌôò Í≤∞Í≥º: {convertedHiragana}
                                                </div>
                                                <button 
                                                    className="btn btn-primary" 
                                                    style={{ marginTop: '0.5rem', padding: '0.5rem 1rem', fontSize: '0.9rem' }}
                                                    onClick={useConvertedWord}
                                                >
                                                    ‚ú® ÌûàÎùºÍ∞ÄÎÇò ÎûÄÏóê Ï†ÅÏö©
                                                </button>
                                            </div>
                                        )}
                                    </div>

                                    <div className="input-group">
                                        <label className="input-label">ÌûàÎùºÍ∞ÄÎÇò/Í∞ÄÌÉÄÏπ¥ÎÇò:</label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            value={newHiragana}
                                            onChange={(e) => setNewHiragana(e.target.value)}
                                            placeholder="Ïòà: „Åå„Å£„Åì„ÅÜ (ÏûÖÎ†•ÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú APIÏóêÏÑú ÌïúÏûê Í≤ÄÏÉâ)"
                                        />
                                    </div>

                                    <div className="input-group">
                                        <label className="input-label">ÌïúÏûê (üåê API ÏûêÎèôÍ≤ÄÏÉâ):</label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            value={newKanji}
                                            onChange={(e) => setNewKanji(e.target.value)}
                                            placeholder="Ïòà: Â≠¶Ê†°"
                                        />
                                        {kanjiStatus && (
                                            <div className={`status-indicator ${kanjiStatus.includes('‚úÖ') || kanjiStatus.includes('üîç') ? 'status-success' : 'status-error'}`}>
                                                {kanjiStatus}
                                            </div>
                                        )}
                                        
                                        {/* ÌïúÏûê ÌõÑÎ≥¥ Î™©Î°ù */}
                                        {kanjiCandidates.length > 0 && (
                                            <div style={{ 
                                                marginTop: '1rem', 
                                                border: '2px solid #3498db', 
                                                borderRadius: '8px', 
                                                padding: '1rem',
                                                backgroundColor: 'rgba(52, 152, 219, 0.05)'
                                            }}>
                                                <div style={{ marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                    üéØ ÌïúÏûê ÌõÑÎ≥¥ Î™©Î°ù (ÌÅ¥Î¶≠Ìï¥ÏÑú ÏÑ†ÌÉù):
                                                </div>
                                                <div style={{ display: 'grid', gap: '0.5rem' }}>
                                                    {kanjiCandidates.map((candidate, index) => (
                                                        <div 
                                                            key={index}
                                                            onClick={() => selectKanjiCandidate(candidate)}
                                                            style={{
                                                                padding: '0.8rem',
                                                                border: '1px solid #bdc3c7',
                                                                borderRadius: '6px',
                                                                cursor: 'pointer',
                                                                transition: 'all 0.2s ease',
                                                                backgroundColor: newKanji === candidate.kanji ? 'rgba(46, 204, 113, 0.1)' : 'white'
                                                            }}
                                                            onMouseEnter={(e) => e.target.style.backgroundColor = 'rgba(52, 152, 219, 0.1)'}
                                                            onMouseLeave={(e) => e.target.style.backgroundColor = newKanji === candidate.kanji ? 'rgba(46, 204, 113, 0.1)' : 'white'}
                                                        >
                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                <div>
                                                                    <span style={{ fontSize: '1.4rem', fontWeight: 'bold', marginRight: '0.5rem' }}>
                                                                        {candidate.kanji}
                                                                    </span>
                                                                    <span style={{ color: '#7f8c8d', fontSize: '0.9rem' }}>
                                                                        ({candidate.reading})
                                                                    </span>
                                                                </div>
                                                                {candidate.meanings && (
                                                                    <div style={{ fontSize: '0.9rem', color: '#34495e', textAlign: 'right', maxWidth: '200px' }}>
                                                                        {candidate.meanings}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        <div style={{ fontSize: '0.9rem', color: '#666', marginTop: '0.5rem' }}>
                                            üåê Jisho.org APIÎ•º ÌÜµÌï¥ Ïã§ÏãúÍ∞Ñ ÌïúÏûê Í≤ÄÏÉâ
                                        </div>
                                    </div>

                                    <div className="input-group">
                                        <label className="input-label">ÌïúÍµ≠Ïñ¥ Îúª:</label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            value={newKorean}
                                            onChange={(e) => setNewKorean(e.target.value)}
                                            placeholder="Ïòà: ÌïôÍµê"
                                        />
                                    </div>

                                    <div className="btn-group">
                                        <button className="btn btn-success" onClick={async () => await addNewWord()}>
                                            {isEditMode ? '‚úÖ ÏàòÏ†ï ÏôÑÎ£å' : '‚ûï Îã®Ïñ¥ Ï∂îÍ∞Ä'}
                                        </button>
                                        
                                        {/* Ïª§Ïä§ÌÖÄ ÌåùÏóÖ ÌÖåÏä§Ìä∏ Î≤ÑÌäº */}
                                        <button 
                                            className="btn btn-warning" 
                                            onClick={async () => {
                                                console.log('ÌÖåÏä§Ìä∏ Î≤ÑÌäº ÌÅ¥Î¶≠');
                                                await showCustomPopup('üß™ Ïù¥Í≤ÉÏùÄ Ïª§Ïä§ÌÖÄ ÌåùÏóÖ ÌÖåÏä§Ìä∏ÏûÖÎãàÎã§!\n\nÎ∏åÎùºÏö∞Ï†Ä Í∏∞Î≥∏ alert ÎåÄÏã† Ïù¥ ÏòàÏÅú ÌåùÏóÖÏù¥ ÌëúÏãúÎê©ÎãàÎã§! ‚ú®', 'Ïª§Ïä§ÌÖÄ ÌåùÏóÖ ÌÖåÏä§Ìä∏', 'info');
                                            }}
                                        >
                                            üé® Ïª§Ïä§ÌÖÄ ÌåùÏóÖ ÌÖåÏä§Ìä∏
                                        </button>
                                    </div>
                                </div>
                            )}

                            {currentTab === 'data' && (
                                <div className="card fade-in">
                                    <h2 style={{ marginBottom: '2rem', color: '#2c3e50' }}>üíæ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h2>
                                    
                                    {/* ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞ ÏÑπÏÖò */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{ 
                                            color: '#34495e', 
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #3498db',
                                            paddingBottom: '0.5rem'
                                        }}>üìÅ ÌååÏùº ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞</h3>
                                        
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1rem', marginBottom: '2rem' }}>
                                            {/* JSON ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞ */}
                                            <div style={{
                                                background: 'rgba(52, 152, 219, 0.1)',
                                                padding: '1.5rem',
                                                borderRadius: '12px',
                                                border: '1px solid rgba(52, 152, 219, 0.3)'
                                            }}>
                                                <h4 style={{ color: '#3498db', marginBottom: '1rem' }}>üóÇÔ∏è JSON ÌòïÏãù</h4>
                                                <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                                                    Î™®Îì† Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ÏôÄ ÏÑ§Ï†ïÏùÑ ÏôÑÏ†ÑÌûà Î∞±ÏóÖ/Î≥µÏõêÌï©ÎãàÎã§. Îã§Î•∏ Í∏∞Í∏∞Î°ú ÏôÑÏ†ÑÌûà Ïù¥Ï†ÑÌï† Îïå Í∂åÏû•Ìï©ÎãàÎã§.
                                                </p>
                                                <div className="btn-group">
                                                    <button className="btn btn-primary" onClick={exportToJSON}>
                                                        üì• JSON ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                                                    </button>
                                                    <label className="btn btn-success" style={{ cursor: 'pointer' }}>
                                                        üì§ JSON Í∞ÄÏ†∏Ïò§Í∏∞
                                                        <input
                                                            type="file"
                                                            accept=".json"
                                                            onChange={importFromJSON}
                                                            style={{ display: 'none' }}
                                                        />
                                                    </label>
                                                </div>
                                            </div>

                                            {/* CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞ */}
                                            <div style={{
                                                background: 'rgba(46, 204, 113, 0.1)',
                                                padding: '1.5rem',
                                                borderRadius: '12px',
                                                border: '1px solid rgba(46, 204, 113, 0.3)'
                                            }}>
                                                <h4 style={{ color: '#2ecc71', marginBottom: '1rem' }}>üìä CSV ÌòïÏãù</h4>
                                                <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                                                    ÏóëÏÖÄ, Íµ¨Í∏Ä Ïä§ÌîÑÎ†àÎìúÏãúÌä∏ Îì±ÏóêÏÑú Ìé∏Ïßë Í∞ÄÎä•Ìïú ÌòïÏãùÏûÖÎãàÎã§. ÎåÄÎüâ Ìé∏ÏßëÏù¥ ÌïÑÏöîÌï† Îïå Ïú†Ïö©Ìï©ÎãàÎã§.
                                                </p>
                                                <div className="btn-group">
                                                    <button className="btn btn-success" onClick={exportToCSV}>
                                                        üì• CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                                                    </button>
                                                    <label className="btn btn-warning" style={{ cursor: 'pointer' }}>
                                                        üì§ CSV Í∞ÄÏ†∏Ïò§Í∏∞
                                                        <input
                                                            type="file"
                                                            accept=".csv"
                                                            onChange={importFromCSV}
                                                            style={{ display: 'none' }}
                                                        />
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Î∞±ÏóÖ/Î≥µÏõê ÏÑπÏÖò */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{ 
                                            color: '#34495e', 
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #e67e22',
                                            paddingBottom: '0.5rem'
                                        }}>üîÑ Î∞±ÏóÖ Î∞è Î≥µÏõê</h3>
                                        
                                        <div style={{
                                            background: 'rgba(230, 126, 34, 0.1)',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(230, 126, 34, 0.3)',
                                            marginBottom: '1rem'
                                        }}>
                                            <h4 style={{ color: '#e67e22', marginBottom: '1rem' }}>‚ö° ÏûêÎèô Î∞±ÏóÖ</h4>
                                            <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                                                Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Í±∞ÎÇò ÏÇ≠Ï†úÌï† Îïå ÏûêÎèôÏúºÎ°ú Î∞±ÏóÖÏù¥ ÏÉùÏÑ±Îê©ÎãàÎã§. Î∞±ÏóÖÏùÄ Î∏åÎùºÏö∞Ï†ÄÏóê Ï†ÄÏû•ÎêòÎ©∞ Ïñ∏Ï†úÎì†ÏßÄ Î≥µÏõêÌï† Ïàò ÏûàÏäµÎãàÎã§.
                                            </p>
                                            <button className="btn btn-warning" onClick={restoreBackup}>
                                                üîô ÎßàÏßÄÎßâ Î∞±ÏóÖ Î≥µÏõê
                                            </button>
                                        </div>
                                    </div>

                                    {/* Îç∞Ïù¥ÌÑ∞ Ï†ïÎ≥¥ ÏÑπÏÖò */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{ 
                                            color: '#34495e', 
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #9b59b6',
                                            paddingBottom: '0.5rem'
                                        }}>üìä ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞ Ï†ïÎ≥¥</h3>
                                        
                                        <div style={{
                                            background: 'rgba(155, 89, 182, 0.1)',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(155, 89, 182, 0.3)'
                                        }}>
                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>
                                                <div>
                                                    <h4 style={{ color: '#9b59b6' }}>üìö Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏</h4>
                                                    <p style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                        {Object.keys(wordSets).length}Í∞ú
                                                    </p>
                                                </div>
                                                <div>
                                                    <h4 style={{ color: '#9b59b6' }}>üìù Ï¥ù Îã®Ïñ¥ Ïàò</h4>
                                                    <p style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                        {Object.values(wordSets).reduce((total, set) => total + Object.keys(set).length, 0)}Í∞ú
                                                    </p>
                                                </div>
                                                <div>
                                                    <h4 style={{ color: '#9b59b6' }}>‚≠ê ÌëúÏãúÎêú Îã®Ïñ¥</h4>
                                                    <p style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                        {Object.values(wordSets).reduce((total, set) => 
                                                            total + Object.values(set).filter(word => word.favorite).length, 0
                                                        )}Í∞ú
                                                    </p>
                                                </div>
                                                <div>
                                                    <h4 style={{ color: '#9b59b6' }}>üìñ ÌòÑÏû¨ ÏÑ∏Ìä∏</h4>
                                                    <p style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                        {setNames[currentSetId]}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* ÏúÑÌóòÌïú ÏûëÏóÖ ÏÑπÏÖò */}
                                    <div>
                                        <h3 style={{ 
                                            color: '#e74c3c', 
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #e74c3c',
                                            paddingBottom: '0.5rem'
                                        }}>‚ö†Ô∏è ÏúÑÌóòÌïú ÏûëÏóÖ</h3>
                                        
                                        <div style={{
                                            background: 'rgba(231, 76, 60, 0.1)',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(231, 76, 60, 0.3)'
                                        }}>
                                            <h4 style={{ color: '#e74c3c', marginBottom: '1rem' }}>üóëÔ∏è Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú</h4>
                                            <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                                                Î™®Îì† Îã®Ïñ¥Ïû•, ÏÑ∏Ìä∏, ÏÑ§Ï†ïÏùÑ ÏôÑÏ†ÑÌûà ÏÇ≠Ï†úÌï©ÎãàÎã§. ÏÇ≠Ï†úÌïòÍ∏∞ Ï†ÑÏóê Î∞òÎìúÏãú Î∞±ÏóÖÏùÑ ÎßåÎìúÏÑ∏Ïöî!
                                            </p>
                                            <button 
                                                className="btn btn-danger" 
                                                onClick={clearAllData}
                                                style={{ 
                                                    background: '#e74c3c',
                                                    border: '2px solid #c0392b'
                                                }}
                                            >
                                                ‚ö†Ô∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                                            </button>
                                        </div>
                                    </div>

                                    {/* ÎèÑÏõÄÎßê ÏÑπÏÖò */}
                                    <div style={{ 
                                        marginTop: '3rem',
                                        background: 'rgba(52, 73, 94, 0.1)',
                                        padding: '1.5rem',
                                        borderRadius: '12px',
                                        border: '1px solid rgba(52, 73, 94, 0.3)'
                                    }}>
                                        <h4 style={{ color: '#34495e', marginBottom: '1rem' }}>üí° ÏÇ¨Ïö© ÌåÅ</h4>
                                        <ul style={{ color: '#666', paddingLeft: '1.5rem' }}>
                                            <li>Ï†ïÍ∏∞Ï†ÅÏúºÎ°ú JSON Î∞±ÏóÖÏùÑ ÎßåÎì§Ïñ¥ Îã§Î•∏ Í≥≥Ïóê Ï†ÄÏû•ÌïòÏÑ∏Ïöî</li>
                                            <li>CSV ÌòïÏãùÏùÄ ExcelÏóêÏÑú Îã®Ïñ¥Î•º ÎåÄÎüâ Ìé∏ÏßëÌïú ÌõÑ Îã§Ïãú Í∞ÄÏ†∏Ïò¨ Îïå Ïú†Ïö©Ìï©ÎãàÎã§</li>
                                            <li>Î∏åÎùºÏö∞Ï†Ä Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÍ∏∞ Ï†ÑÏóê Î∞òÎìúÏãú Î∞±ÏóÖÏùÑ ÎßåÎìúÏÑ∏Ïöî</li>
                                            <li>Îã§Î•∏ Í∏∞Í∏∞ÏóêÏÑú ÏÇ¨Ïö©ÌïòÎ†§Î©¥ JSON ÌååÏùºÏùÑ ÎÇ¥Î≥¥ÎÇ∏ ÌõÑ ÏÉà Í∏∞Í∏∞ÏóêÏÑú Í∞ÄÏ†∏Ïò§ÏÑ∏Ïöî</li>
                                        </ul>
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<JapaneseStudyApp />);
    </script>
    
    <!-- PWA ÏÑúÎπÑÏä§ ÏõåÏª§ Îì±Î°ù -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker Îì±Î°ù ÏÑ±Í≥µ: ', registration.scope);
                    }, function(err) {
                        console.log('ServiceWorker Îì±Î°ù Ïã§Ìå®: ', err);
                    });
            });
        }
        
        // PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA ÏÑ§Ïπò Í∞ÄÎä•!');
            e.preventDefault();
            deferredPrompt = e;
            
            // ÏÑ§Ïπò ÏïàÎÇ¥ ÌëúÏãú (3Ï¥à ÌõÑ)
            setTimeout(() => {
                if (confirm('üì± Ïù¥ Ïï±ÏùÑ Ìôà ÌôîÎ©¥Ïóê ÏÑ§ÏπòÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÑ§ÏπòÌïòÎ©¥ Îçî Îπ†Î•¥Í≥† Ìé∏Î¶¨ÌïòÍ≤å ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏñ¥Ïöî!')) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('ÏÇ¨Ïö©ÏûêÍ∞Ä PWA ÏÑ§ÏπòÎ•º ÌóàÏö©ÌñàÏäµÎãàÎã§');
                        } else {
                            console.log('ÏÇ¨Ïö©ÏûêÍ∞Ä PWA ÏÑ§ÏπòÎ•º Í±∞Î∂ÄÌñàÏäµÎãàÎã§');
                        }
                        deferredPrompt = null;
                    });
                }
            }, 3000);
        });
    </script>
</body>
</html>