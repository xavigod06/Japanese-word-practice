<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üóæ ÏùºÎ≥∏Ïñ¥ Îã®Ïñ¥ Í≥µÎ∂Ä</title>
    
    <!-- PWA Î©îÌÉÄ ÌÉúÍ∑∏Îì§ -->
    <meta name="description" content="ÏùºÎ≥∏Ïñ¥ Îã®Ïñ¥ÏôÄ ÌûàÎùºÍ∞ÄÎÇòÎ•º ÏâΩÍ≤å Í≥µÎ∂ÄÌï† Ïàò ÏûàÎäî Ïï± ^_^">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ÏùºÎ≥∏Ïñ¥Í≥µÎ∂Ä">
    <meta name="msapplication-TileColor" content="#667eea">
    <link rel="manifest" href="./manifest.json">
    
    <!-- ÏïÑÏù¥ÏΩòÎì§ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjNjY3ZWVhIiByeD0iMjQiLz4KPHA+8J+Yr/CfmLDwn5iy8J+Ys+CfmLfwn5i78J+YvvCfmL88L3A+DQo8L3N2Zz4=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjNjY3ZWVhIiByeD0iMjQiLz4KPHA+8J+Yr/CfmLDwn5iy8J+Ys+CfmLfwn5i78J+YvvCfmL88L3A+DQo8L3N2Zz4=">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav {
            display: flex;
            gap: 1rem;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .main {
            flex: 1;
            padding: 2rem;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .quiz-word {
            text-align: center;
            margin: 2rem 0;
        }

        .kanji {
            font-size: 4rem;
            color: #9b59b6;
            margin-bottom: 1rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .hiragana {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .input-group {
            margin: 1.5rem 0;
        }

        .input-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .input-field {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .input-field:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .score {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 2rem;
        }

        .result {
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 12px;
            animation: fadeIn 0.5s ease;
        }

        .result.correct {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }

        .result.incorrect {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .result.partial {
            background: rgba(243, 156, 18, 0.1);
            color: #d68910;
            border-left: 4px solid #f39c12;
        }

        .word-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e1e8ed;
            border-radius: 12px;
            padding: 1rem;
        }

        .word-item {
            padding: 1rem;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .word-item:hover {
            background: rgba(52, 152, 219, 0.05);
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 1rem 0;
        }

        .status-success {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }

        .status-error {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .hangul-converter {
            background: rgba(52, 152, 219, 0.05);
            border: 2px dashed #3498db;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-weight: 500;
            font-size: 1rem;
            min-width: 300px;
            max-width: 400px;
            animation: slideInFromRight 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification.success {
            background: rgba(46, 204, 113, 0.9);
            color: white;
            border-color: rgba(46, 204, 113, 0.3);
        }

        .notification.error {
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border-color: rgba(231, 76, 60, 0.3);
        }

        .notification.warning {
            background: rgba(241, 196, 15, 0.9);
            color: white;
            border-color: rgba(241, 196, 15, 0.3);
        }

        .notification.info {
            background: rgba(52, 152, 219, 0.9);
            color: white;
            border-color: rgba(52, 152, 219, 0.3);
        }

        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.8;
            margin-left: auto;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-close:hover {
            opacity: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-in {
            animation: slideIn 0.3s ease;
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .header > div:nth-child(2) {
                flex-wrap: wrap;
                justify-content: center;
            }

            .header select {
                min-width: 200px;
            }
            
            .main {
                padding: 1rem;
            }
            
            .kanji {
                font-size: 3rem;
            }
            
            .hiragana {
                font-size: 2rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }

        /* Ïª§Ïä§ÌÖÄ ÌåùÏóÖ Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .custom-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .custom-popup.show {
            opacity: 1;
            visibility: visible;
        }
        
        .popup-content {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.7);
            transition: transform 0.3s ease;
        }
        
        .custom-popup.show .popup-content {
            transform: scale(1);
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f2f6;
        }
        
        .popup-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 0;
        }
        
        .popup-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #7f8c8d;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .popup-close:hover {
            background-color: #f1f2f6;
            color: #e74c3c;
        }
        
        .popup-body {
            margin-bottom: 2rem;
        }
        
        .popup-message {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #34495e;
            margin-bottom: 1.5rem;
        }
        
        .popup-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .popup-btn {
            padding: 0.8rem 1.8rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }
        
        .popup-btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .popup-btn-primary:hover {
            background: linear-gradient(45deg, #2980b9, #1abc9c);
            transform: translateY(-2px);
        }
        
        .popup-btn-secondary {
            background: #ecf0f1;
            color: #34495e;
            border: 2px solid #bdc3c7;
        }
        
        .popup-btn-secondary:hover {
            background: #d5dbdb;
            border-color: #95a5a6;
        }
        
        .popup-btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .popup-btn-success:hover {
            background: linear-gradient(45deg, #229954, #27ae60);
            transform: translateY(-2px);
        }
        
        .popup-btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .popup-btn-danger:hover {
            background: linear-gradient(45deg, #c0392b, #a93226);
            transform: translateY(-2px);
        }

        /* ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶º Ìö®Í≥º */
        .hiragana-container {
            position: relative;
            display: inline-block;
            margin: 2rem 0;
        }

        .hiragana-hidden {
            filter: blur(20px);
            color: transparent;
            text-shadow: none;
            user-select: none;
            pointer-events: none;
        }

        .hiragana-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
            animation: pulse 2s infinite;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            white-space: nowrap;
            z-index: 10;
        }

        .hiragana-toggle-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background: rgba(52, 152, 219, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .hiragana-toggle-btn:hover {
            background: rgba(41, 128, 185, 0.9);
            transform: scale(1.1);
        }

        .quiz-word {
            position: relative;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }

        /* ÌÄ¥Ï¶à ÌôîÎ©¥ Ï¶êÍ≤®Ï∞æÍ∏∞ Î≤ÑÌäº ÏµúÏ†ÅÌôî */
        .quiz-favorite-btn {
            position: absolute;
            top: -10px;
            left: -10px;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 5;
            color: white;
            backdrop-filter: blur(10px);
        }

        .quiz-favorite-btn:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .quiz-favorite-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }

        /* Î≥Ñ Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º */
        @keyframes starPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .quiz-favorite-btn.favorited {
            animation: starPulse 0.6s ease-in-out;
        }
        
        /* Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
                margin: 0;
            }
            
            .card {
                padding: 1rem;
                margin-bottom: 1rem;
                border-radius: 12px;
            }
            
            .quiz-word .kanji {
                font-size: 2.5rem !important;
            }
            
            .quiz-word .hiragana {
                font-size: 1.8rem !important;
            }
            
            .btn-group {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .btn {
                width: 100%;
                min-width: auto !important;
                padding: 1rem;
                font-size: 1rem;
            }
            
            .input-field {
                font-size: 1rem;
                padding: 1rem;
            }
            
            .nav-btn {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
            
            /* 2Îã®Í≥Ñ ÌÄ¥Ï¶à ÏÑ†ÌÉù Î≤ÑÌäºÎì§ */
            div[style*="display: flex"][style*="gap: 1rem"] {
                flex-direction: column !important;
                align-items: stretch !important;
            }
            
            /* Î™®Î∞îÏùºÏóêÏÑú Î≥ÄÌôò ÏïàÎÇ¥ ÌÖçÏä§Ìä∏ ÌÅ¨Í∏∞ Ï°∞Ï†ï */
            div[style*="background: rgba(46, 204, 113, 0.1)"] {
                font-size: 0.8rem !important;
            }
        }
        
        /* ÏïÑÏ£º ÏûëÏùÄ ÌôîÎ©¥ (320px Ïù¥Ìïò) */
        @media (max-width: 320px) {
            .card {
                padding: 0.8rem;
            }
            
            .quiz-word .kanji {
                font-size: 2rem !important;
            }
            
            .quiz-word .hiragana {
                font-size: 1.5rem !important;
            }
            
            .btn {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Ïª§Ïä§ÌÖÄ ÌåùÏóÖ Î™®Îã¨ -->
    <div id="customPopup" class="custom-popup">
        <div class="popup-content">
            <div class="popup-header">
                <h3 id="popupTitle" class="popup-title">ÏïåÎ¶º</h3>
                <button class="popup-close" onclick="closeCustomPopup()">√ó</button>
            </div>
            <div class="popup-body">
                <div id="popupMessage" class="popup-message"></div>
            </div>
            <div class="popup-buttons">
                <button id="popupOkBtn" class="popup-btn popup-btn-primary" onclick="closeCustomPopup()">ÌôïÏù∏</button>
                <button id="popupCancelBtn" class="popup-btn popup-btn-secondary" onclick="closeCustomPopup()" style="display: none;">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>


    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Ïª§Ïä§ÌÖÄ ÌåùÏóÖ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
        function showCustomPopup(message, title = 'ÏïåÎ¶º', type = 'info', showCancel = false) {
            const popup = document.getElementById('customPopup');
            const titleElement = document.getElementById('popupTitle');
            const messageElement = document.getElementById('popupMessage');
            const okBtn = document.getElementById('popupOkBtn');
            const cancelBtn = document.getElementById('popupCancelBtn');
            
            // ÎÇ¥Ïö© ÏÑ§Ï†ï
            titleElement.textContent = title;
            messageElement.textContent = message;
            
            // Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏÑ§Ï†ï
            okBtn.className = 'popup-btn ';
            switch(type) {
                case 'success':
                    okBtn.className += 'popup-btn-success';
                    break;
                case 'error':
                case 'danger':
                    okBtn.className += 'popup-btn-danger';
                    break;
                case 'warning':
                    okBtn.className += 'popup-btn-primary';
                    break;
                default:
                    okBtn.className += 'popup-btn-primary';
            }
            
            // Ï∑®ÏÜå Î≤ÑÌäº ÌëúÏãú/Ïà®ÍπÄ
            if (showCancel) {
                cancelBtn.style.display = 'inline-block';
            } else {
                cancelBtn.style.display = 'none';
            }
            
            // ÌåùÏóÖ ÌëúÏãú
            popup.classList.add('show');
            
            return new Promise((resolve) => {
                // ÌôïÏù∏ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú
                okBtn.onclick = () => {
                    closeCustomPopup();
                    resolve(true);
                };
                
                // Ï∑®ÏÜå Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú
                if (showCancel) {
                    cancelBtn.onclick = () => {
                        closeCustomPopup();
                        resolve(false);
                    };
                }
            });
        }
        
        function closeCustomPopup() {
            const popup = document.getElementById('customPopup');
            popup.classList.remove('show');
        }
        
        // ESC ÌÇ§Î°ú ÌåùÏóÖ Îã´Í∏∞
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeCustomPopup();
            }
        });
        
        // Î∞∞Í≤Ω ÌÅ¥Î¶≠ÏúºÎ°ú ÌåùÏóÖ Îã´Í∏∞
        document.getElementById('customPopup').addEventListener('click', function(event) {
            if (event.target === this) {
                closeCustomPopup();
            }
        });

        // ÌôïÏû•Îêú ÌïúÏûê ÏÇ¨Ï†ÑÏóê „Åä„Å® Ï∂îÍ∞Ä
        const kanjiDict = {
            "„Åå„Å£„Åì„ÅÜ": "Â≠¶Ê†°", "„Åõ„Çì„Åõ„ÅÑ": "ÂÖàÁîü", "„Åå„Åè„Åõ„ÅÑ": "Â≠¶Áîü",
            "„Åü„Åπ„ÇÇ„ÅÆ": "È£ü„ÅπÁâ©", "„Åø„Åö": "Ê∞¥", "„Åò„Åã„Çì": "ÊôÇÈñì",
            "„Å®„ÇÇ„Å†„Å°": "ÂèãÈÅî", "„Åã„Åû„Åè": "ÂÆ∂Êóè", "„Åó„Åî„Å®": "‰ªï‰∫ã",
            "„ÅÑ„Åà": "ÂÆ∂", "„ÅÇ„Åü„Åæ": "È†≠", "„Åì„Åì„Çç": "ÂøÉ",
            "„Å¶„Åå„Åø": "ÊâãÁ¥ô", "„Åß„Çì„Çè": "ÈõªË©±", "„Åè„Çã„Åæ": "Ëªä",
            "„Åà„Åç": "ÈßÖ", "„Å≥„Çá„ÅÜ„ÅÑ„Çì": "ÁóÖÈô¢", "„Åé„Çì„Åì„ÅÜ": "ÈäÄË°å",
            "„Åì„ÅÜ„Åà„Çì": "ÂÖ¨Âúí", "„Å®„Åó„Çá„Åã„Çì": "Âõ≥Êõ∏È§®", "„Åã„ÅÑ„Åó„ÇÉ": "‰ºöÁ§æ",
            "„ÅØ„Å™„Åó": "Ë©±", "„Åπ„Çì„Åç„Çá„ÅÜ": "ÂãâÂº∑", "„Åó„ÇÖ„Åè„Å†„ÅÑ": "ÂÆøÈ°å",
            "„Åß„Çì„Åó„ÇÉ": "ÈõªËªä", "„Åò„Å¶„Çì„Åó„ÇÉ": "Ëá™Ëª¢Ëªä", "„Å≤„Åì„ÅÜ„Åç": "È£õË°åÊ©ü",
            
            // Ï∂îÍ∞ÄÎêú Í∏∞Î≥∏ ÌïúÏûêÎì§
            "„Åä„Å®": "Èü≥", "„Åì„Åà": "Â£∞", "„ÇÅ": "ÁõÆ", "„Å¶": "Êâã", 
            "„ÅÇ„Åó": "Ë∂≥", "„ÅÇ„Åü„Åæ": "È†≠", "„Åã„Çâ„Å†": "‰Ωì", "„Å≤„Å®": "‰∫∫",
            "„ÅÑ„Å°": "‰∏Ä", "„Å´": "‰∫å", "„Åï„Çì": "‰∏â", "„Çà„Çì": "Âõõ", "„Åî": "‰∫î",
            "„Çç„Åè": "ÂÖ≠", "„Å™„Å™": "‰∏É", "„ÅØ„Å°": "ÂÖ´", "„Åç„ÇÖ„ÅÜ": "‰πù", "„Åò„ÇÖ„ÅÜ": "ÂçÅ",
            "„Å≤": "Êó•", "„Å§„Åç": "Êúà", "„Åã": "ÁÅ´", "„Åô„ÅÑ": "Ê∞¥", "„ÇÇ„Åè": "Êú®", 
            "„Åç„Çì": "Èáë", "„Å©": "Âúü", "„Å´„Å°": "Êó•", "„Åí„Å§": "Êúà", "„Åã": "ÁÅ´",
            "„ÅÇ„Åã": "Ëµ§", "„ÅÇ„Åä": "Èùí", "„Åó„Çç": "ÁôΩ", "„Åè„Çç": "Èªí", "„Åç„ÅÑ„Çç": "ÈªÑ"
        };

        // ÌôïÏû•Îêú ÌïúÍ∏Ä-ÌûàÎùºÍ∞ÄÎÇò Î≥ÄÌôò (Î≥µÌï©Ïùå, ÏöîÏùå Ìè¨Ìï®)
        const hangulToHiragana = {
            // Í∏∞Î≥∏ Î™®Ïùå (Ï§ëÏöî!)
            '„Öè': '„ÅÇ', '„Ö£': '„ÅÑ', '„Öú': '„ÅÜ', '„Öì': '„Åà', '„Öó': '„Åä',
            '„Öë': '„ÇÑ', '„Öï': '„Çà', '„Ö†': '„ÇÜ', '„Öõ': '„Çà', '„Öò': '„Çè', '„Öô': '„Çè„ÅÑ', '„Öö': '„ÅÜ„Åá',
            '„Öù': '„ÅÜ„Åâ', '„Öû': '„ÅÜ„Åá', '„Öü': '„ÅÜ„ÅÑ', '„Ö¢': '„ÅÜ„ÅÑ', '„Öî': '„Åà', '„Öê': '„Åà',
            
            // Í∏∞Î≥∏ ÏûêÏùå (Îã®ÎèÖ)
            '„Ñ±': '„Åå', '„Ñ¥': '„Çì', '„Ñ∑': '„Å†', '„Ñπ': '„Çâ', '„ÖÅ': '„Åæ', '„ÖÇ': '„Å∞', 
            '„ÖÖ': '„Åï', '„Öá': '', '„Öà': '„Åò', '„Öä': '„Å°', '„Öã': '„Åã', '„Öå': '„Åü', 
            '„Öç': '„Å±', '„Öé': '„ÅØ',
            
            // ÏÜåÏø†Ïò®(Ï¥âÏùå) „ÖÖ ‚Üí „Å£ Ï≤òÎ¶¨
            '„ÖÖ„ÖÖ': '„Å£', '„Å£': '„Å£',
            
            // ÏôÄÌñâ Ï∂îÍ∞Ä (Ï§ëÏöî!)
            'ÏôÄ': '„Çè', 'Ïôú': '„Çè„ÅÑ', 'Ïô∏': '„ÅÜ„Åá', 'Ïõ®': '„ÅÜ„Åá', 'ÏúÑ': '„ÅÜ„ÅÑ', 'Ïùò': '„ÅÜ„ÅÑ',
            
            // Í∏∞Î≥∏ ÏûêÏùå+Î™®Ïùå
            'Í∞Ä': '„Åå', 'Í∞∏': '„Åé„ÇÉ', 'Í±∞': '„Åí', 'Í≤®': '„Åé„Åá', 'Í≥†': '„Åî', 'Íµê': '„Åé„Çá', 'Íµ¨': '„Åê', 'Í∑ú': '„Åé„ÇÖ', 'Í∑∏': '„Åê', 'Í∏∞': '„Åé', 'Í∞ú': '„Åå„ÅÑ', 'Í≤å': '„Åí',
            'ÎÇò': '„Å™', 'ÎÉê': '„Å´„ÇÉ', 'ÎÑà': '„Å≠', 'ÎÖÄ': '„Å´„Åá', 'ÎÖ∏': '„ÅÆ', 'Îá®': '„Å´„Çá', 'ÎàÑ': '„Å¨', 'Îâ¥': '„Å´„ÇÖ', 'Îäê': '„Å¨', 'Îãà': '„Å´', 'ÎÇ¥': '„Å™„ÅÑ', 'ÎÑ§': '„Å≠',
            'Îã§': '„Å†', 'Îåú': '„Å¢„ÇÉ', 'Îçî': '„Åß', 'Îéå': '„Å¢„Åá', 'ÎèÑ': '„Å©', 'Îê¥': '„Å¢„Çá', 'Îëê': '„Å•', 'ÎìÄ': '„Å¢„ÇÖ', 'Îìú': '„Å•', 'Îîî': '„Å¢', 'ÎåÄ': '„Å†„ÅÑ', 'Îç∞': '„Åß',
            'Îùº': '„Çâ', 'Îû¥': '„Çä„ÇÉ', 'Îü¨': '„Çå', 'Î†§': '„Çä„Åá', 'Î°ú': '„Çç', 'Î£å': '„Çä„Çá', 'Î£®': '„Çã', 'Î•ò': '„Çä„ÇÖ', 'Î•¥': '„Çã', 'Î¶¨': '„Çä', 'Îûò': '„Çâ„ÅÑ', 'Î†à': '„Çå',
            'Îßà': '„Åæ', 'Î®Ä': '„Åø„ÇÉ', 'Î®∏': '„ÇÅ', 'Î©∞': '„Åø„Åá', 'Î™®': '„ÇÇ', 'Î¨ò': '„Åø„Çá', 'Î¨¥': '„ÇÄ', 'ÎÆ§': '„Åø„ÇÖ', 'ÎØÄ': '„ÇÄ', 'ÎØ∏': '„Åø', 'Îß§': '„Åæ„ÅÑ', 'Î©î': '„ÇÅ',
            'Î∞î': '„Å∞', 'Î±å': '„Å≥„ÇÉ', 'Î≤Ñ': '„Åπ', 'Î≤º': '„Å≥„Åá', 'Î≥¥': '„Åº', 'Îµ§': '„Å≥„Çá', 'Î∂Ä': '„Å∂', 'Î∑∞': '„Å≥„ÇÖ', 'Î∏å': '„Å∂', 'ÎπÑ': '„Å≥', 'Î∞∞': '„Å∞„ÅÑ', 'Î≤†': '„Åπ',
            'ÏÇ¨': '„Åï', 'ÏÉ§': '„Åó„ÇÉ', 'ÏÑú': '„Åõ', 'ÏÖî': '„Åó„Åá', 'ÏÜå': '„Åù', 'Ïáº': '„Åó„Çá', 'Ïàò': '„Åô', 'Ïäà': '„Åó„ÇÖ', 'Ïä§': '„Åô', 'Ïãú': '„Åó', 'ÏÉà': '„Åï„ÅÑ', 'ÏÑ∏': '„Åõ',
            'ÏïÑ': '„ÅÇ', 'Ïïº': '„ÇÑ', 'Ïñ¥': '„Åà', 'Ïó¨': '„ÅÑ„Åá', 'Ïò§': '„Åä', 'Ïöî': '„Çà', 'Ïö∞': '„ÅÜ', 'Ïú†': '„ÇÜ', 'Ïúº': '„ÅÜ', 'Ïù¥': '„ÅÑ', 'Ïï†': '„ÅÇ„ÅÑ', 'Ïóê': '„Åà',
            'Ïûê': '„Åñ', 'Ïüà': '„Åò„ÇÉ', 'Ï†Ä': '„Åú', 'Ï†∏': '„Åò„Åá', 'Ï°∞': '„Åû', 'Ï£†': '„Åò„Çá', 'Ï£º': '„Åö', 'Ï•¨': '„Åò„ÇÖ', 'Ï¶à': '„Åö', 'ÏßÄ': '„Åò', 'Ïû¨': '„Åñ„ÅÑ', 'Ï†ú': '„Åú',
            'Ï∞®': '„Å°„ÇÉ', 'Ï±†': '„Å°„ÇÉ', 'Ï≤ò': '„Å°„Åá', 'Ï≥ê': '„Å°„Åá', 'Ï¥à': '„Å°„Çá', 'Ïµ∏': '„Å°„Çá', 'Ï∂î': '„Å°„ÇÖ', 'Ï∏Ñ': '„Å°„ÇÖ', 'Ï∏†': '„Å§', 'Ïπò': '„Å°', 'Ï±Ñ': '„Å°„ÇÉ„ÅÑ', 'Ï≤¥': '„Å°„Åá',
            'Ïπ¥': '„Åã', 'Ï∫¨': '„Åç„ÇÉ', 'Ïª§': '„Åë', 'Ïºú': '„Åç„Åá', 'ÏΩî': '„Åì', 'ÏøÑ': '„Åç„Çá', 'Ïø†': '„Åè', 'ÌÅê': '„Åç„ÇÖ', 'ÌÅ¨': '„Åè', 'ÌÇ§': '„Åç', 'Ï∫ê': '„Åã„ÅÑ', 'ÏºÄ': '„Åë',
            'ÌÉÄ': '„Åü', 'ÌÉ∏': '„Å°„ÇÉ', 'ÌÑ∞': '„Å¶', 'ÌÖ®': '„Å°„Åá', 'ÌÜ†': '„Å®', 'Ìàê': '„Å°„Çá', 'Ìà¨': '„Å§', 'Ìäú': '„Å°„ÇÖ', 'Ìä∏': '„Å§', 'Ìã∞': '„Å°', 'ÌÉú': '„Åü„ÅÑ', 'ÌÖå': '„Å¶',
            'Ìåå': '„Å±', 'ÌçÑ': '„Å¥„ÇÉ', 'Ìçº': '„Å∫', 'Ìé¥': '„Å¥„Åá', 'Ìè¨': '„ÅΩ', 'Ìëú': '„Å¥„Çá', 'Ìë∏': '„Å∑', 'Ìì®': '„Å¥„ÇÖ', 'ÌîÑ': '„Å∑', 'Ìîº': '„Å¥', 'Ìå®': '„Å±„ÅÑ', 'Ìéò': '„Å∫',
            'Ìïò': '„ÅØ', 'Ìñê': '„Å≤„ÇÉ', 'Ìóà': '„Å∏', 'ÌòÄ': '„Å≤„Åá', 'Ìò∏': '„Åª', 'Ìö®': '„Å≤„Çá', 'ÌõÑ': '„Åµ', 'Ìú¥': '„Å≤„ÇÖ', 'Ìùê': '„Åµ', 'Ìûà': '„Å≤', 'Ìï¥': '„ÅØ„ÅÑ', 'Ìó§': '„Å∏',
            
            // Î∞õÏπ® Ï≤òÎ¶¨ + ÏÜåÏø†Ïò®(Ï¥âÏùå)
            'Í∞ì': '„Åå„Å£', 'ÎÇ´': '„Å™„Å£', 'Îåì': '„Å†„Å£', 'Îûè': '„Çâ„Å£', 'Îßõ': '„Åæ„Å£', 'Î∞ß': '„Å∞„Å£', 'ÏÇø': '„Åï„Å£', 'Ïïó': '„ÅÇ„Å£', 'Ïû£': '„Åñ„Å£', 'Ï∞ª': '„Å°„ÇÉ„Å£', 'Ï∫£': '„Åã„Å£', 'ÌÉì': '„Åü„Å£', 'Ìåü': '„Å±„Å£', 'Ìï´': '„ÅØ„Å£',
            'Í∞ñ': '„Åå„Å£', 'ÎÇÆ': '„Å™„Å£', 'Îã´': '„Å†„Å£', 'Îûí': '„Çâ„Å£', 'Îßû': '„Åæ„Å£', 'Î∞≠': '„Å∞„Å£', 'ÏÉ∑': '„Åï„Å£', 'Ïïö': '„ÅÇ„Å£', 'Ïû¶': '„Åñ„Å£', 'Ï≥á': '„Å°„ÇÉ„Å£', 'Ï∫£': '„Åã„Å£', 'ÌÉØ': '„Åü„Å£', 'Ìåü': '„Å±„Å£', 'Ìï´': '„ÅØ„Å£',
            'Í∞Å': '„Åå„Åè', 'ÎÇô': '„Å™„Åè', 'Îã®': '„Å†„Çì', 'ÎûÄ': '„Çâ„Çì', 'Îßå': '„Åæ„Çì', 'Î∞ò': '„Å∞„Çì', 'ÏÇ∞': '„Åï„Çì', 'Ïïà': '„ÅÇ„Çì', 'Ïûî': '„Åñ„Çì', 'Ï∞¨': '„Å°„ÇÉ„Çì', 'Ïπ∏': '„Åã„Çì', 'ÌÉÑ': '„Åü„Çì', 'Ìåê': '„Å±„Çì', 'Ìïú': '„ÅØ„Çì',
            'Í∞ï': '„Åå„Çì', 'ÎÇ≠': '„Å™„Çì', 'Îãπ': '„Å†„Çì', 'Îûë': '„Çâ„Çì', 'Îßù': '„Åæ„Çì', 'Î∞©': '„Å∞„Çì', 'ÏÉÅ': '„Åï„Çì', 'Ïïô': '„ÅÇ„Çì', 'Ïû•': '„Åñ„Çì', 'Ï∞Ω': '„Å°„ÇÉ„Çì', 'Ï∫â': '„Åã„Çì', 'ÌÉï': '„Åü„Çì', 'Ìå°': '„Å±„Çì', 'Ìï≠': '„ÅØ„Çì',
            
            // „Öá Î∞õÏπ®ÎèÑ „ÇìÏúºÎ°ú Î≥ÄÌôò (Ï∂îÍ∞Ä)
            'Í∞ï': '„Åå„Çì', 'Í≤Ω': '„Åí„Çì', 'Í≥µ': '„Åî„Çì', 'Í∂Å': '„Åê„Çì', 'Í∏ç': '„Åê„Çì', 'ÍπÖ': '„Åé„Çì', 'Í∞±': '„Åå„Çì', 'Í≤°': '„Åí„Çì',
            'ÎÇ≠': '„Å™„Çì', 'ÎÑù': '„Å≠„Çì', 'ÎÜç': '„ÅÆ„Çì', 'Îàô': '„Å¨„Çì', 'Îä•': '„Å¨„Çì', 'Îãù': '„Å´„Çì', 'ÎÉ•': '„Å™„Çì', 'ÎÖï': '„Å≠„Çì',
            'Îãπ': '„Å†„Çì', 'Îç©': '„Åß„Çì', 'Îèô': '„Å©„Çì', 'Îë•': '„Å•„Çì', 'Îì±': '„Å•„Çì', 'Îî©': '„Å¢„Çì', 'Îåï': '„Å†„Çì', 'ÎéÖ': '„Åß„Çì',
            'Îûë': '„Çâ„Çì', 'Î†Å': '„Çå„Çì', 'Î°±': '„Çç„Çì', 'Î£Ω': '„Çã„Çì', 'Î¶â': '„Çã„Çì', 'ÎßÅ': '„Çä„Çì', 'Îüâ': '„Çâ„Çì', 'Î†ù': '„Çå„Çì',
            'Îßù': '„Åæ„Çì', 'Î©ç': '„ÇÅ„Çì', 'Î™Ω': '„ÇÇ„Çì', 'Î≠â': '„ÇÄ„Çì', 'ÎØï': '„ÇÄ„Çì', 'Î∞ç': '„Åø„Çì', 'Îßπ': '„Åæ„Çì', 'Î©©': '„ÇÅ„Çì',
            'Î∞©': '„Å∞„Çì', 'Î≤ô': '„Åπ„Çì', 'Î¥â': '„Åº„Çì', 'Î∂ï': '„Å∂„Çì', 'Î∏°': '„Å∂„Çì', 'Îπô': '„Å≥„Çì', 'Î±Ö': '„Å∞„Çì', 'Î≤µ': '„Åπ„Çì',
            'ÏÉÅ': '„Åï„Çì', 'ÏÑ±': '„Åõ„Çì', 'ÏÜ°': '„Åù„Çì', 'Ïà≠': '„Åô„Çì', 'Ïäπ': '„Åô„Çì', 'Ïã±': '„Åó„Çì', 'ÏÉπ': '„Åï„Çì', 'ÏÖç': '„Åõ„Çì',
            'Ïïô': '„ÅÇ„Çì', 'ÏòÅ': '„Åà„Çì', 'Ïòπ': '„Åä„Çì', 'ÏõÖ': '„ÅÜ„Çì', 'Ïùë': '„ÅÜ„Çì', 'Ïûâ': '„ÅÑ„Çì', 'Ïñë': '„ÅÇ„Çì', 'Ïó°': '„Åà„Çì',
            'Ïû•': '„Åñ„Çì', 'Ï†ï': '„Åú„Çì', 'Ï¢Ö': '„Åû„Çì', 'Ï§ë': '„Åö„Çì', 'Ï¶ù': '„Åö„Çì', 'Ïßï': '„Åò„Çì', 'ÏüÅ': '„Åñ„Çì', 'Ï†±': '„Åú„Çì',
            'Ï∞Ω': '„Å°„ÇÉ„Çì', 'Ï≤≠': '„Å°„Åá„Çì', 'Ï¥ù': '„Å°„Çá„Çì', 'Ï∂©': '„Å°„ÇÖ„Çì', 'Ï∏µ': '„Å°„ÇÖ„Çì', 'Ïπ≠': '„Å°„Çì', 'Ï±ô': '„Å°„ÇÉ„Çì', 'Ï≥•': '„Å°„Åá„Çì',
            'Ï∫â': '„Åã„Çì', 'Ïªπ': '„Åë„Çì', 'ÏΩ©': '„Åì„Çì', 'Ïøµ': '„Åè„Çì', 'ÌÇÅ': '„Åè„Çì', 'ÌÇπ': '„Åç„Çì', 'Ï∫•': '„Åã„Çì', 'Ïº±': '„Åë„Çì',
            'ÌÉï': '„Åü„Çì', 'ÌÖ°': '„Å¶„Çì', 'ÌÜµ': '„Å®„Çì', 'ÌâÅ': '„Å§„Çì', 'Ìãç': '„Å§„Çì', 'ÌåÖ': '„Å°„Çì', 'ÌÉ±': '„Åü„Çì', 'ÌÖ°': '„Å¶„Çì',
            'Ìå°': '„Å±„Çì', 'Ìéë': '„Å∫„Çì', 'ÌêÅ': '„ÅΩ„Çì', 'Ìíç': '„Å∑„Çì', 'Ìîô': '„Å∑„Çì', 'Ìïë': '„Å¥„Çì', 'ÌåΩ': '„Å±„Çì', 'Ìé≠': '„Å∫„Çì',
            'Ìï≠': '„ÅØ„Çì', 'Ìóù': '„Å∏„Çì', 'Ìôç': '„Åª„Çì', 'Ìõô': '„Åµ„Çì', 'Ìù•': '„Åµ„Çì', 'Ìûù': '„Å≤„Çì', 'Ìñâ': '„ÅØ„Çì', 'Ìóπ': '„Å∏„Çì',
            
            // „Ñ¥ Î∞õÏπ® ÌôïÏû• (Îçî ÎßéÏùÄ Ï°∞Ìï©)
            'Í∞Ñ': '„Åå„Çì', 'Í±¥': '„Åí„Çì', 'Í≥§': '„Åî„Çì', 'Íµ∞': '„Åê„Çì', 'Í∑º': '„Åê„Çì', 'Í∏¥': '„Åé„Çì', 'Í∞†': '„Åå„Çì', 'Í≤ê': '„Åí„Çì',
            'ÎÇú': '„Å™„Çì', 'ÎÑå': '„Å≠„Çì', 'ÎÖº': '„ÅÆ„Çì', 'Îàà': '„Å¨„Çì', 'Îäî': '„Å¨„Çì', 'Îãå': '„Å´„Çì', 'ÎÇ∏': '„Å™„Çì', 'ÎÑ®': '„Å≠„Çì',
            'Îã®': '„Å†„Çì', 'Îçò': '„Åß„Çì', 'Îèà': '„Å©„Çì', 'Îëî': '„Å•„Çì', 'Îì†': '„Å•„Çì', 'Îîò': '„Å¢„Çì', 'ÎåÑ': '„Å†„Çì', 'Îç¥': '„Åß„Çì',
            'ÎûÄ': '„Çâ„Çì', 'Îü∞': '„Çå„Çì', 'Î°†': '„Çç„Çì', 'Î£¨': '„Çã„Çì', 'Î•∏': '„Çã„Çì', 'Î¶∞': '„Çä„Çì', 'Îûú': '„Çâ„Çì', 'Î†å': '„Çå„Çì',
            'Îßå': '„Åæ„Çì', 'Î®º': '„ÇÅ„Çì', 'Î™¨': '„ÇÇ„Çì', 'Î¨∏': '„ÇÄ„Çì', 'ÎØÑ': '„ÇÄ„Çì', 'ÎØº': '„Åø„Çì', 'Îß®': '„Åæ„Çì', 'Î©ò': '„ÇÅ„Çì',
            'Î∞ò': '„Å∞„Çì', 'Î≤à': '„Åπ„Çì', 'Î≥∏': '„Åº„Çì', 'Î∂Ñ': '„Å∂„Çì', 'Î∏ê': '„Å∂„Çì', 'Îπà': '„Å≥„Çì', 'Î∞¥': '„Å∞„Çì', 'Î≤§': '„Åπ„Çì',
            'ÏÇ∞': '„Åï„Çì', 'ÏÑ†': '„Åõ„Çì', 'ÏÜê': '„Åù„Çì', 'Ïàú': '„Åô„Çì', 'Ïä®': '„Åô„Çì', 'Ïã†': '„Åó„Çì', 'ÏÉå': '„Åï„Çì', 'ÏÑº': '„Åõ„Çì',
            'Ïïà': '„ÅÇ„Çì', 'Ïñ∏': '„Åà„Çì', 'Ïò®': '„Åä„Çì', 'Ïö¥': '„ÅÜ„Çì', 'ÏùÄ': '„ÅÜ„Çì', 'Ïù∏': '„ÅÑ„Çì', 'Ïï§': '„ÅÇ„Çì', 'Ïóî': '„Åà„Çì',
            'Ïûî': '„Åñ„Çì', 'Ï†Ñ': '„Åú„Çì', 'Ï°¥': '„Åû„Çì', 'Ï§Ä': '„Åö„Çì', 'Ï¶å': '„Åö„Çì', 'ÏßÑ': '„Åò„Çì', 'Ïû∞': '„Åñ„Çì', 'Ï††': '„Åú„Çì',
            'Ï∞¨': '„Å°„ÇÉ„Çì', 'Ï≤ú': '„Å°„Åá„Çì', 'Ï¥å': '„Å°„Çá„Çì', 'Ï∂ò': '„Å°„ÇÖ„Çì', 'Ï∏§': '„Å°„ÇÖ„Çì', 'Ïπú': '„Å°„Çì', 'Ï±à': '„Å°„ÇÉ„Çì', 'Ï≤∏': '„Å°„Åá„Çì',
            'Ïπ∏': '„Åã„Çì', 'Ïª®': '„Åë„Çì', 'ÏΩò': '„Åì„Çì', 'Ïø§': '„Åè„Çì', 'ÌÅ∞': '„Åè„Çì', 'ÌÇ®': '„Åç„Çì', 'Ï∫î': '„Åã„Çì', 'ÏºÑ': '„Åë„Çì',
            'ÌÉÑ': '„Åü„Çì', 'ÌÑ¥': '„Å¶„Çì', 'ÌÜ§': '„Å®„Çì', 'Ìà∞': '„Å§„Çì', 'Ìäº': '„Å§„Çì', 'Ìã¥': '„Å°„Çì', 'ÌÉ†': '„Åü„Çì', 'ÌÖê': '„Å¶„Çì',
            'Ìåê': '„Å±„Çì', 'ÌéÄ': '„Å∫„Çì', 'Ìè∞': '„ÅΩ„Çì', 'Ìëº': '„Å∑„Çì', 'Ìîà': '„Å∑„Çì', 'ÌïÄ': '„Å¥„Çì', 'Ìå¨': '„Å±„Çì', 'Ìéú': '„Å∫„Çì',
            'Ìïú': '„ÅØ„Çì', 'Ìóå': '„Å∏„Çì', 'Ìòº': '„Åª„Çì', 'Ìõà': '„Åµ„Çì', 'Ìùî': '„Åµ„Çì', 'Ìûå': '„Å≤„Çì', 'Ìï∏': '„ÅØ„Çì', 'Ìó®': '„Å∏„Çì',
            
            // „ÖÅ Î∞õÏπ®ÎèÑ „ÇìÏúºÎ°ú Î≥ÄÌôòÎêòÎäî Í≤ΩÏö∞Îì§
            'Í∞ê': '„Åå„Çì', 'Í≤Ä': '„Åí„Çì', 'Í≥∞': '„Åî„Çì', 'Íµº': '„Åê„Çì', 'Í∏à': '„Åê„Çì', 'ÍπÄ': '„Åé„Çì', 'Í∞¨': '„Åå„Çì', 'Í≤ú': '„Åí„Çì',
            'ÎÇ®': '„Å™„Çì', 'ÎÑò': '„Å≠„Çì', 'ÎÜà': '„ÅÆ„Çì', 'Îàî': '„Å¨„Çì', 'Îä†': '„Å¨„Çì', 'Îãò': '„Å´„Çì', 'ÎÉ†': '„Å™„Çì', 'ÎÑ¥': '„Å≠„Çì',
            'Îã¥': '„Å†„Çì', 'Îç§': '„Åß„Çì', 'Îèî': '„Å©„Çì', 'Îë†': '„Å•„Çì', 'Îì¨': '„Å•„Çì', 'Îî§': '„Å¢„Çì', 'Îåê': '„Å†„Çì', 'ÎéÄ': '„Åß„Çì',
            'Îûå': '„Çâ„Çì', 'Îüº': '„Çå„Çì', 'Î°¨': '„Çç„Çì', 'Î£∏': '„Çã„Çì', 'Î¶Ñ': '„Çã„Çì', 'Î¶º': '„Çä„Çì', 'Îû®': '„Çâ„Çì', 'Î†ò': '„Çå„Çì',
            'Îßò': '„Åæ„Çì', 'Î©à': '„ÇÅ„Çì', 'Î™∏': '„ÇÇ„Çì', 'Î≠Ñ': '„ÇÄ„Çì', 'ÎØê': '„ÇÄ„Çì', 'Î∞à': '„Åø„Çì', 'Îß¥': '„Åæ„Çì', 'Î©§': '„ÇÅ„Çì',
            'Î∞§': '„Å∞„Çì', 'Î≤î': '„Åπ„Çì', 'Î¥Ñ': '„Åº„Çì', 'Î∂ê': '„Å∂„Çì', 'Î∏Ä': '„Å∂„Çì', 'Îπî': '„Å≥„Çì', 'Î∞§': '„Å∞„Çì', 'Î∞¥': '„Åπ„Çì',
            'ÏÇº': '„Åï„Çì', 'ÏÑ¨': '„Åõ„Çì', 'ÏÜú': '„Åù„Çì', 'Ïà®': '„Åô„Çì', 'Ïä¥': '„Åô„Çì', 'Ïã¨': '„Åó„Çì', 'ÏÉò': '„Åï„Çì', 'ÏÖà': '„Åõ„Çì',
            'Ïïî': '„ÅÇ„Çì', 'ÏóÑ': '„Åà„Çì', 'Ïò¥': '„Åä„Çì', 'ÏõÄ': '„ÅÜ„Çì', 'Ïùå': '„ÅÜ„Çì', 'ÏûÑ': '„ÅÑ„Çì', 'Ïñå': '„ÅÇ„Çì', 'Ïó†': '„Åà„Çì',
            'Ïû†': '„Åñ„Çì', 'Ï†ê': '„Åú„Çì', 'Ï¢Ä': '„Åû„Çì', 'Ï§å': '„Åö„Çì', 'Ï¶ò': '„Åö„Çì', 'Ïßê': '„Åò„Çì', 'Ïûº': '„Åñ„Çì', 'Ï†¨': '„Åú„Çì',
            'Ï∞∏': '„Å°„ÇÉ„Çì', 'Ï≤®': '„Å°„Åá„Çì', 'Ï¥ò': '„Å°„Çá„Çì', 'Ï∂§': '„Å°„ÇÖ„Çì', 'Ï∏∞': '„Å°„ÇÖ„Çì', 'Ïπ®': '„Å°„Çì', 'Ï±î': '„Å°„ÇÉ„Çì', 'Ï≥Ñ': '„Å°„Åá„Çì',
            'Ï∫Ñ': '„Åã„Çì', 'Ïª¥': '„Åë„Çì', 'ÏΩ§': '„Åì„Çì', 'Ïø∞': '„Åè„Çì', 'ÌÅº': '„Åè„Çì', 'ÌÇ¥': '„Åç„Çì', 'Ï∫†': '„Åã„Çì', 'Ïºê': '„Åë„Çì',
            'ÌÉê': '„Åü„Çì', 'ÌÖÄ': '„Å¶„Çì', 'ÌÜ∞': '„Å®„Çì', 'Ìàº': '„Å§„Çì', 'Ìãà': '„Å§„Çì', 'ÌåÄ': '„Å°„Çì', 'ÌÉ¨': '„Åü„Çì', 'ÌÖú': '„Å¶„Çì',
            'Ìåú': '„Å±„Çì', 'Ìéå': '„Å∫„Çì', 'Ìèº': '„ÅΩ„Çì', 'Ìíà': '„Å∑„Çì', 'Ìîî': '„Å∑„Çì', 'Ìïå': '„Å¥„Çì', 'Ìå∏': '„Å±„Çì', 'Ìé®': '„Å∫„Çì',
            'Ìï®': '„ÅØ„Çì', 'Ìóò': '„Å∏„Çì', 'Ìôà': '„Åª„Çì', 'Ìõî': '„Åµ„Çì', 'Ìù†': '„Åµ„Çì', 'Ìûò': '„Å≤„Çì', 'ÌñÑ': '„ÅØ„Çì', 'Ìó¥': '„Å∏„Çì',
            
            // ÏÜåÏø†Ïò® Ï°∞Ìï©Îì§ (Ï§ëÏöî!)
            'ÌÇ∑': '„Åç„Å£', 'ÍπÉ': '„Åé„Å£', 'Îãõ': '„Å´„Å£', 'Îîß': '„Å¢„Å£', 'Î¶ø': '„Çä„Å£', 'Î∞ë': '„Åø„Å£', 'Îπó': '„Å≥„Å£', 'ÏãØ': '„Åó„Å£', 'Ïûá': '„ÅÑ„Å£', 'Ïßì': '„Åò„Å£', 
            'Ïπ´': '„Å°„Å£', 'ÌÇ∑': '„Åç„Å£', 'Ìã±': '„Å°„Å£', 'Ìïè': '„Å¥„Å£', 'Ìûõ': '„Å≤„Å£', 'Ïöß': '„Çà„Å£', 'Ïú≥': '„ÇÜ„Å£',
            'Ïºì': '„Åë„Å£', 'Í≤ü': '„Åí„Å£', 'ÎÑ∑': '„Å≠„Å£', 'ÎéÉ': '„Åß„Å£', 'Î†õ': '„Çå„Å£', 'Î©ß': '„ÇÅ„Å£', 'Î≤≥': '„Åπ„Å£', 'ÏÖã': '„Åõ„Å£', 'Ïó£': '„Åà„Å£', 'Ï†Ø': '„Åú„Å£',
            'Ï≥á': '„Å°„Åá„Å£', 'Ïºì': '„Åë„Å£', 'ÌÖü': '„Å¶„Å£', 'Ìé´': '„Å∫„Å£', 'Ìó∑': '„Å∏„Å£',
            'ÏΩß': '„Åì„Å£', 'Í≥≥': '„Åî„Å£', 'ÎÜã': '„ÅÆ„Å£', 'Îèó': '„Å©„Å£', 'Î°Ø': '„Çç„Å£', 'Î™ª': '„ÇÇ„Å£', 'Î¥á': '„Åº„Å£', 'ÏÜü': '„Åù„Å£', 'Ïò∑': '„Åä„Å£', 'Ï¢É': '„Åû„Å£',
            'Ï¥õ': '„Å°„Çá„Å£', 'ÏΩß': '„Åì„Å£', 'ÌÜ≥': '„Å®„Å£', 'Ìèø': '„ÅΩ„Å£', 'Ìôã': '„Åª„Å£',
            'Ïø≥': '„Åè„Å£', 'Íµø': '„Åê„Å£', 'Îàó': '„Å¨„Å£', 'Îë£': '„Å•„Å£', 'Î£ª': '„Çã„Å£', 'Î≠á': '„ÇÄ„Å£', 'Î∂ì': '„Å∂„Å£', 'ÏàØ': '„Åô„Å£', 'ÏõÉ': '„ÅÜ„Å£', 'Ï§è': '„Åö„Å£',
            'Ï∂ß': '„Å°„ÇÖ„Å£', 'Ïø≥': '„Åè„Å£', 'ÎúØ': '„Å§„Å£', 'Ìíã': '„Å∑„Å£', 'Ìõó': '„Åµ„Å£',
            
            // ÏöîÏùå („Çá) Ï≤òÎ¶¨
            'Í∞∏': '„Åé„ÇÉ', 'ÎÉê': '„Å´„ÇÉ', 'Îåú': '„Å¢„ÇÉ', 'Îû¥': '„Çä„ÇÉ', 'Î®Ä': '„Åø„ÇÉ', 'Î±å': '„Å≥„ÇÉ', 'ÏÉ§': '„Åó„ÇÉ', 'Ïïº': '„ÇÑ', 'Ïüà': '„Åò„ÇÉ', 'Ï±†': '„Å°„ÇÉ', 'Ï∫¨': '„Åç„ÇÉ', 'ÌÉ∏': '„Å°„ÇÉ', 'ÌçÑ': '„Å¥„ÇÉ', 'Ìñê': '„Å≤„ÇÉ',
            'Í≤®': '„Åé„Åá', 'ÎÖÄ': '„Å´„Åá', 'Îéå': '„Å¢„Åá', 'Î†§': '„Çä„Åá', 'Î©∞': '„Åø„Åá', 'Î≤º': '„Å≥„Åá', 'ÏÖî': '„Åó„Åá', 'Ïó¨': '„ÅÑ„Åá', 'Ï†∏': '„Åò„Åá', 'Ï≥ê': '„Å°„Åá', 'Ïºú': '„Åç„Åá', 'ÌÖ®': '„Å°„Åá', 'Ìé¥': '„Å¥„Åá', 'ÌòÄ': '„Å≤„Åá',
            'Íµê': '„Åé„Çá', 'Îá®': '„Å´„Çá', 'Îê¥': '„Å¢„Çá', 'Î£å': '„Çä„Çá', 'Î¨ò': '„Åø„Çá', 'Îµ§': '„Å≥„Çá', 'Ïáº': '„Åó„Çá', 'Ïöî': '„Çà', 'Ï£†': '„Åò„Çá', 'Ïµ∏': '„Å°„Çá', 'ÏøÑ': '„Åç„Çá', 'Ìàê': '„Å°„Çá', 'Ìëú': '„Å¥„Çá', 'Ìö®': '„Å≤„Çá',
            'Í∑ú': '„Åé„ÇÖ', 'Îâ¥': '„Å´„ÇÖ', 'ÎìÄ': '„Å¢„ÇÖ', 'Î•ò': '„Çä„ÇÖ', 'ÎÆ§': '„Åø„ÇÖ', 'Î∑∞': '„Å≥„ÇÖ', 'Ïäà': '„Åó„ÇÖ', 'Ïú†': '„ÇÜ', 'Ï•¨': '„Åò„ÇÖ', 'Ï∏Ñ': '„Å°„ÇÖ', 'ÌÅê': '„Åç„ÇÖ', 'Ìäú': '„Å°„ÇÖ', 'Ìì®': '„Å¥„ÇÖ', 'Ìú¥': '„Å≤„ÇÖ',
            
            // Ïû•Ïùå Ï≤òÎ¶¨
            'Í∞ÄÏïÑ': '„Åå„ÅÇ', 'ÎÇòÏïÑ': '„Å™„ÅÇ', 'Îã§ÏïÑ': '„Å†„ÅÇ', 'ÎùºÏïÑ': '„Çâ„ÅÇ', 'ÎßàÏïÑ': '„Åæ„ÅÇ', 'Î∞îÏïÑ': '„Å∞„ÅÇ', 'ÏÇ¨ÏïÑ': '„Åï„ÅÇ', 'ÏïÑÏïÑ': '„ÅÇ„ÅÇ', 'ÏûêÏïÑ': '„Åñ„ÅÇ', 'Ï∞®ÏïÑ': '„Å°„ÇÉ„ÅÇ', 'Ïπ¥ÏïÑ': '„Åã„ÅÇ', 'ÌÉÄÏïÑ': '„Åü„ÅÇ', 'ÌååÏïÑ': '„Å±„ÅÇ', 'ÌïòÏïÑ': '„ÅØ„ÅÇ',
            'Í∏∞Ïù¥': '„Åé„ÅÑ', 'ÎãàÏù¥': '„Å´„ÅÑ', 'ÎîîÏù¥': '„Å¢„ÅÑ', 'Î¶¨Ïù¥': '„Çä„ÅÑ', 'ÎØ∏Ïù¥': '„Åø„ÅÑ', 'ÎπÑÏù¥': '„Å≥„ÅÑ', 'ÏãúÏù¥': '„Åó„ÅÑ', 'Ïù¥Ïù¥': '„ÅÑ„ÅÑ', 'ÏßÄÏù¥': '„Åò„ÅÑ', 'ÏπòÏù¥': '„Å°„ÅÑ', 'ÌÇ§Ïù¥': '„Åç„ÅÑ', 'Ìã∞Ïù¥': '„Å°„ÅÑ', 'ÌîºÏù¥': '„Å¥„ÅÑ', 'ÌûàÏù¥': '„Å≤„ÅÑ',
            'Íµ¨Ïö∞': '„Åê„ÅÜ', 'ÎàÑÏö∞': '„Å¨„ÅÜ', 'ÎëêÏö∞': '„Å•„ÅÜ', 'Î£®Ïö∞': '„Çã„ÅÜ', 'Î¨¥Ïö∞': '„ÇÄ„ÅÜ', 'Î∂ÄÏö∞': '„Å∂„ÅÜ', 'ÏàòÏö∞': '„Åô„ÅÜ', 'Ïö∞Ïö∞': '„ÅÜ„ÅÜ', 'Ï£ºÏö∞': '„Åö„ÅÜ', 'Ï∂îÏö∞': '„Å°„ÇÖ„ÅÜ', 'Ïø†Ïö∞': '„Åè„ÅÜ', 'Ìà¨Ïö∞': '„Å§„ÅÜ', 'Ìë∏Ïö∞': '„Å∑„ÅÜ', 'ÌõÑÏö∞': '„Åµ„ÅÜ',
            'Í≤åÏóê': '„Åí„Åà', 'ÎÑ§Ïóê': '„Å≠„Åà', 'Îç∞Ïóê': '„Åß„Åà', 'Î†àÏóê': '„Çå„Åà', 'Î©îÏóê': '„ÇÅ„Åà', 'Î≤†Ïóê': '„Åπ„Åà', 'ÏÑ∏Ïóê': '„Åõ„Åà', 'ÏóêÏóê': '„Åà„Åà', 'Ï†úÏóê': '„Åú„Åà', 'Ï≤¥Ïóê': '„Å°„Åá„Åà', 'ÏºÄÏóê': '„Åë„Åà', 'ÌÖåÏóê': '„Å¶„Åà', 'ÌéòÏóê': '„Å∫„Åà', 'Ìó§Ïóê': '„Å∏„Åà',
            'Í≥†Ïò§': '„Åî„Åä', 'ÎÖ∏Ïò§': '„ÅÆ„Åä', 'ÎèÑÏò§': '„Å©„Åä', 'Î°úÏò§': '„Çç„Åä', 'Î™®Ïò§': '„ÇÇ„Åä', 'Î≥¥Ïò§': '„Åº„Åä', 'ÏÜåÏò§': '„Åù„Åä', 'Ïò§Ïò§': '„Åä„Åä', 'Ï°∞Ïò§': '„Åû„Åä', 'Ï¥àÏò§': '„Å°„Çá„Åä', 'ÏΩîÏò§': '„Åì„Åä', 'ÌÜ†Ïò§': '„Å®„Åä', 'Ìè¨Ïò§': '„ÅΩ„Åä', 'Ìò∏Ïò§': '„Åª„Åä'
        };

        function JapaneseStudyApp() {
            const [currentTab, setCurrentTab] = useState('quiz');
            const [words, setWords] = useState({});
            const [currentWord, setCurrentWord] = useState(null);
            const [userAnswer, setUserAnswer] = useState('');
            const [score, setScore] = useState(0);
            const [totalQuestions, setTotalQuestions] = useState(0);
            const [result, setResult] = useState(null);
            const [isAnswerSubmitted, setIsAnswerSubmitted] = useState(false); // ÎãµÏïà Ï†úÏ∂ú ÏÉÅÌÉú
            const [quizStarted, setQuizStarted] = useState(false);
            const [usedWords, setUsedWords] = useState(new Set()); // Ïù¥ÎØ∏ Ï∂úÏ†úÎêú Î¨∏Ï†úÎì§
            const [quizCompleted, setQuizCompleted] = useState(false); // ÌÄ¥Ï¶à ÏôÑÎ£å Ïó¨Î∂Ä
            const [hideHiragana, setHideHiragana] = useState(false); // ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶º Ïó¨Î∂Ä
            
            // Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ Í¥ÄÎ¶¨
            const [wordSets, setWordSets] = useState({}); // Î™®Îì† Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏Îì§
            const [currentSetId, setCurrentSetId] = useState('default'); // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÏÑ∏Ìä∏
            const [setNames, setSetNames] = useState({ default: 'Í∏∞Î≥∏ Îã®Ïñ¥Ïû•' }); // ÏÑ∏Ìä∏ Ïù¥Î¶ÑÎì§
            
            // Îã®Ïñ¥ Ï∂îÍ∞Ä Ìèº
            const [newKanji, setNewKanji] = useState('');
            const [newHiragana, setNewHiragana] = useState('');
            const [newKorean, setNewKorean] = useState('');
            const [hangulInput, setHangulInput] = useState('');
            const [convertedHiragana, setConvertedHiragana] = useState('');
            const [kanjiStatus, setKanjiStatus] = useState('');
            const [kanjiCandidates, setKanjiCandidates] = useState([]);
            const [showNotification, setShowNotification] = useState(false);
            const [notificationMessage, setNotificationMessage] = useState('');
            const [notificationType, setNotificationType] = useState('success'); // success, error, warning, info
            
            // ÏàòÏ†ï Î™®Îìú Í¥ÄÎ†® ÏÉÅÌÉú
            const [isEditMode, setIsEditMode] = useState(false); // ÏàòÏ†ï Î™®ÎìúÏù∏ÏßÄ Ïó¨Î∂Ä
            const [editingWordKey, setEditingWordKey] = useState(null); // ÏàòÏ†ï Ï§ëÏù∏ Îã®Ïñ¥Ïùò ÏõêÎûò ÌÇ§
            
            // Ï¶êÍ≤®Ï∞æÍ∏∞/ÌëúÏãú Í¥ÄÎ†® ÏÉÅÌÉú
            const [favoriteWords, setFavoriteWords] = useState({}); // ÏÑ∏Ìä∏Î≥Ñ Ï¶êÍ≤®Ï∞æÍ∏∞ Îã®Ïñ¥Îì§
            const [showFavoritesOnly, setShowFavoritesOnly] = useState(false); // Ï¶êÍ≤®Ï∞æÍ∏∞Îßå ÌëúÏãú
            const [quizMode, setQuizMode] = useState('all'); // 'all' | 'favorites'
            const [quizType, setQuizType] = useState('korean'); // 'korean' | 'hiragana' | 'both'
            const [convertedQuizAnswer, setConvertedQuizAnswer] = useState(''); // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÏö© Î≥ÄÌôòÎêú ÎãµÏïà
            
            // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏö© ÏÉÅÌÉúÎì§
            const [userKoreanAnswer, setUserKoreanAnswer] = useState(''); // ÌïúÍµ≠Ïñ¥ ÎãµÏïà
            const [userHiraganaAnswer, setUserHiraganaAnswer] = useState(''); // ÌûàÎùºÍ∞ÄÎÇò ÎãµÏïà
            const [convertedHiraganaAnswer, setConvertedHiraganaAnswer] = useState(''); // Î≥ÄÌôòÎêú ÌûàÎùºÍ∞ÄÎÇò
            const [bothQuizResult, setBothQuizResult] = useState({ korean: null, hiragana: null }); // Í∞ÅÍ∞ÅÏùò Ï†ïÎãµ Ïó¨Î∂Ä
            
            // ÌÄ¥Ï¶à ÏÑ†ÌÉù UI ÏÉÅÌÉú
            const [selectedRange, setSelectedRange] = useState('all'); // 'all' | 'favorites'
            const [selectedType, setSelectedType] = useState('korean'); // 'korean' | 'hiragana' | 'both' | 'japanese'
            
            // ÌÄ¥Ï¶à ÏßÑÌñâ ÏÉÅÌÉú
            const [isLoadingNextQuestion, setIsLoadingNextQuestion] = useState(false);
            const [wrongAnswers, setWrongAnswers] = useState([]); // ÌãÄÎ¶∞ Î¨∏Ï†úÎì§ Ï†ÄÏû•
            const [showWrongAnswers, setShowWrongAnswers] = useState(false); // ÌãÄÎ¶∞ Î¨∏Ï†ú Î≥¥Í∏∞ Î™®Îìú
            const [wrongAnswerFavorites, setWrongAnswerFavorites] = useState({}); // ÌãÄÎ¶∞ Î¨∏Ï†ú Ï¶êÍ≤®Ï∞æÍ∏∞
            
            // Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏÉùÏÑ± Í¥ÄÎ†® ÏÉÅÌÉú
            const [selectedSetsForCombined, setSelectedSetsForCombined] = useState({}); // Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•Ïóê Ìè¨Ìï®Ìï† ÏÑ∏Ìä∏Îì§
            const [showSetSelector, setShowSetSelector] = useState(false); // ÏÑ∏Ìä∏ ÏÑ†ÌÉù UI ÌëúÏãú

            // Îã®Ïñ¥Ïû• Ìï©ÏπòÍ∏∞ Í¥ÄÎ†® ÏÉÅÌÉú
            const [selectedSetsForMerge, setSelectedSetsForMerge] = useState({}); // Ìï©Ïπ† Îã®Ïñ¥Ïû•Îì§ ÏÑ†ÌÉù
            const [showMergeSelector, setShowMergeSelector] = useState(false); // Ìï©ÏπòÍ∏∞ UI ÌëúÏãú
            const [newMergedSetName, setNewMergedSetName] = useState(''); // ÏÉà Îã®Ïñ¥Ïû• Ïù¥Î¶Ñ

            // Îã®Ïñ¥Ïû• ÏÇ≠Ï†ú Í¥ÄÎ†® ÏÉÅÌÉú
            const [selectedSetsForDelete, setSelectedSetsForDelete] = useState({}); // ÏÇ≠Ï†úÌï† Îã®Ïñ¥Ïû•Îì§ ÏÑ†ÌÉù
            const [showDeleteSelector, setShowDeleteSelector] = useState(false); // ÏÇ≠Ï†ú UI ÌëúÏãú
            
            // Îã®Ïñ¥ Í≤ÄÏÉâ Í¥ÄÎ†® ÏÉÅÌÉú
            const [searchQuery, setSearchQuery] = useState(''); // Í≤ÄÏÉâÏñ¥

            // ÌïúÏûê Î∞úÏùå Ï°∞Ìöå Í¥ÄÎ†® ÏÉÅÌÉú
            const [kanjiInput, setKanjiInput] = useState(''); // ÏûÖÎ†•Ìïú ÌïúÏûê
            const [kanjiResult, setKanjiResult] = useState(null); // Ï°∞Ìöå Í≤∞Í≥º
            const [kanjiError, setKanjiError] = useState(''); // Ïò§Î•ò Î©îÏãúÏßÄ
            const [kanjiLoading, setKanjiLoading] = useState(false); // Î°úÎî© ÏÉÅÌÉú

            // Í∏∞Ï°¥ hangulToHiragana ÏÇ¨Ï†ÑÏùÑ Ïó≠Î∞©Ìñ•ÏúºÎ°ú ÌôúÏö©ÌïòÏó¨ hiraganaToKorean ÏÉùÏÑ±
            const createHiraganaToKoreanMap = () => {
                const reverseMap = {};
                
                // hangulToHiraganaÏùò Î™®Îì† Ìï≠Î™©ÏùÑ Ïó≠Î∞©Ìñ•ÏúºÎ°ú Îß§Ìïë
                Object.entries(hangulToHiragana).forEach(([korean, hiragana]) => {
                    if (hiragana && hiragana.trim() !== '') {
                        reverseMap[hiragana] = korean;
                    }
                });
                
                // Ï∂îÍ∞Ä ÌäπÏàò Î¨∏ÏûêÎì§
                reverseMap['„Éº'] = 'Ïö∞'; // Ïû•Ïùå ÌëúÏãú
                reverseMap['„Éª'] = ''; // Ï§ëÏ†êÏùÄ Î¨¥Ïãú
                
                return reverseMap;
            };
            
            // Ìö®Ïú®Ï†ÅÏù∏ ÌûàÎùºÍ∞ÄÎÇò‚ÜíÌïúÍ∏Ä Î≥ÄÌôò ÏÇ¨Ï†Ñ (Í∏∞Ï°¥ ÏÇ¨Ï†ÑÏùò Ïó≠Î∞©Ìñ• ÌôúÏö©)
            const hiraganaToKorean = createHiraganaToKoreanMap();

            // ÌûàÎùºÍ∞ÄÎÇò Î¨∏ÏûêÏó¥ÏùÑ ÌïúÍ∏Ä Î∞úÏùåÏúºÎ°ú Î≥ÄÌôò (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
            const convertHiraganaToKorean = (hiraganaText) => {
                if (!hiraganaText) return '';
                
                let result = '';
                let i = 0;
                
                while (i < hiraganaText.length) {
                    let matched = false;
                    
                    // Í∏¥ Ï°∞Ìï©Î∂ÄÌÑ∞ ÌôïÏù∏ (4Í∏ÄÏûê ‚Üí 3Í∏ÄÏûê ‚Üí 2Í∏ÄÏûê ‚Üí 1Í∏ÄÏûê)
                    for (let len = Math.min(4, hiraganaText.length - i); len >= 1; len--) {
                        const substr = hiraganaText.substring(i, i + len);
                        if (hiraganaToKorean[substr]) {
                            result += hiraganaToKorean[substr];
                            i += len;
                            matched = true;
                            break;
                        }
                    }
                    
                    // Î≥ÄÌôòÎêòÏßÄ ÏïäÎäî Î¨∏ÏûêÎäî Í∑∏ÎåÄÎ°ú Ï∂îÍ∞Ä
                    if (!matched) {
                        result += hiraganaText.charAt(i);
                        i++;
                    }
                }
                
                return result;
            };

            // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            useEffect(() => {
                loadAllWordSets();
                loadFavoriteWords();
                loadSelectedSets();
            }, []);

            // ÌòÑÏû¨ ÏÑ∏Ìä∏Í∞Ä Î≥ÄÍ≤ΩÎê† Îïå Îã®Ïñ¥ ÏóÖÎç∞Ïù¥Ìä∏
            useEffect(() => {
                if (wordSets[currentSetId]) {
                    setWords(wordSets[currentSetId]);
                }
            }, [currentSetId, wordSets]);

            // Î™®Îì† Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ Î°úÎìú
            const loadAllWordSets = () => {
                const savedSets = localStorage.getItem('japaneseWordSets');
                const savedSetNames = localStorage.getItem('japaneseSetNames');
                
                if (savedSets && savedSetNames) {
                    try {
                        const parsedSets = JSON.parse(savedSets);
                        const parsedNames = JSON.parse(savedSetNames);
                        setWordSets(parsedSets);
                        setSetNames(parsedNames);
                        
                        // ÌòÑÏû¨ ÏÑ∏Ìä∏ ÏÑ§Ï†ï
                        const savedCurrentSet = localStorage.getItem('currentWordSet') || 'default';
                        if (parsedSets[savedCurrentSet]) {
                            setCurrentSetId(savedCurrentSet);
                            setWords(parsedSets[savedCurrentSet]);
                        }
                        console.log('Ï†ÄÏû•Îêú Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏Îì§ÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§:', Object.keys(parsedSets).length + 'Í∞ú ÏÑ∏Ìä∏');
                        
                        // Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏÉùÏÑ±
                        setTimeout(() => updateCombinedWordSet(), 100);
                    } catch (error) {
                        console.error('Ï†ÄÏû•Îêú ÏÑ∏Ìä∏ Î°úÎìú Ïã§Ìå®:', error);
                        // Í∏∞Î≥∏ Îπà ÏÉÅÌÉúÎ°ú Ï¥àÍ∏∞Ìôî
                        setWordSets({});
                        setSetNames({});
                        setWords({});
                        setCurrentSetId('');
                    }
                } else {
                    // Í∏∞Î≥∏ Îπà ÏÉÅÌÉúÎ°ú Ï¥àÍ∏∞Ìôî
                    setWordSets({});
                    setSetNames({});
                    setWords({});
                    setCurrentSetId('');
                }
            };


            // Î™®Îì† Îã®Ïñ¥Ïû•Ïùò Îã®Ïñ¥Î•º Ìï©Ïπú Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏÉùÏÑ±/ÏóÖÎç∞Ïù¥Ìä∏
            const updateCombinedWordSet = () => {
                if (Object.keys(wordSets).length === 0) return;
                
                // ÏÑ†ÌÉùÎêú ÏÑ∏Ìä∏Îì§Ïùò Îã®Ïñ¥Î•º Ìï©Ïπ® (ÏÑ†ÌÉùÏù¥ ÏóÜÏúºÎ©¥ Î™®Îì† ÏÑ∏Ìä∏)
                let combinedWords = {};
                const hasSelection = Object.keys(selectedSetsForCombined).some(setId => selectedSetsForCombined[setId]);
                
                Object.entries(wordSets).forEach(([setId, setWords]) => {
                    if (setId !== 'combined') {
                        // ÏÑ†ÌÉùÏù¥ ÏûàÏúºÎ©¥ ÏÑ†ÌÉùÎêú ÏÑ∏Ìä∏Îßå, ÏóÜÏúºÎ©¥ Î™®Îì† ÏÑ∏Ìä∏
                        if (!hasSelection || selectedSetsForCombined[setId]) {
                            Object.assign(combinedWords, setWords);
                        }
                    }
                });
                
                // Ìï©Ïπú Îã®Ïñ¥Í∞Ä ÏûàÏúºÎ©¥ 'combined' ÏÑ∏Ìä∏ ÏÉùÏÑ±/ÏóÖÎç∞Ïù¥Ìä∏
                if (Object.keys(combinedWords).length > 0) {
                    const updatedSets = { ...wordSets, combined: combinedWords };
                    const updatedNames = { ...setNames, combined: 'Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•' };
                    
                    setWordSets(updatedSets);
                    setSetNames(updatedNames);
                    
                    // ÌòÑÏû¨ ÏÑ∏Ìä∏Í∞Ä ÎπÑÏñ¥ÏûàÏúºÎ©¥ combinedÎ°ú ÏÑ§Ï†ï
                    if (!currentSetId || !updatedSets[currentSetId]) {
                        setCurrentSetId('combined');
                        setWords(combinedWords);
                    }
                    
                    saveAllSets(updatedSets, updatedNames, currentSetId || 'combined');
                    console.log('Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•Ïù¥ ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§:', Object.keys(combinedWords).length + 'Í∞ú Îã®Ïñ¥');
                } else if (wordSets['combined']) {
                    // Îã§Î•∏ Îã®Ïñ¥Ïû•Ïù¥ Î™®Îëê ÏÇ≠Ï†úÎêòÏóàÏúºÎ©¥ combinedÎèÑ ÏÇ≠Ï†ú
                    const updatedSets = { ...wordSets };
                    const updatedNames = { ...setNames };
                    delete updatedSets['combined'];
                    delete updatedNames['combined'];
                    
                    setWordSets(updatedSets);
                    setSetNames(updatedNames);
                    
                    if (currentSetId === 'combined') {
                        const remainingSetIds = Object.keys(updatedSets);
                        const newCurrentSet = remainingSetIds.length > 0 ? remainingSetIds[0] : '';
                        setCurrentSetId(newCurrentSet);
                        setWords(newCurrentSet ? updatedSets[newCurrentSet] : {});
                    }
                    
                    saveAllSets(updatedSets, updatedNames, currentSetId !== 'combined' ? currentSetId : '');
                }
            };
            
            // Î™®Îì† ÏÑ∏Ìä∏ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            const saveAllSets = (sets, names, currentSet) => {
                localStorage.setItem('japaneseWordSets', JSON.stringify(sets));
                localStorage.setItem('japaneseSetNames', JSON.stringify(names));
                localStorage.setItem('currentWordSet', currentSet);
            };

            // Ï¶êÍ≤®Ï∞æÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            const loadFavoriteWords = () => {
                const savedFavorites = localStorage.getItem('japaneseFavoriteWords');
                if (savedFavorites) {
                    try {
                        const parsedFavorites = JSON.parse(savedFavorites);
                        setFavoriteWords(parsedFavorites);
                        console.log('Ï¶êÍ≤®Ï∞æÍ∏∞ Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨ÏôîÏäµÎãàÎã§.');
                    } catch (error) {
                        console.error('Ï¶êÍ≤®Ï∞æÍ∏∞ Î°úÎìú Ïã§Ìå®:', error);
                        setFavoriteWords({});
                    }
                }
            };

            // Ï¶êÍ≤®Ï∞æÍ∏∞ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            const saveFavoriteWords = (favorites) => {
                localStorage.setItem('japaneseFavoriteWords', JSON.stringify(favorites));
                console.log('Ï¶êÍ≤®Ï∞æÍ∏∞ Îç∞Ïù¥ÌÑ∞Í∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
            };

            // Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•Ïóê ÏÑ†ÌÉùÎêú ÏÑ∏Ìä∏Îì§ Î°úÎìú
            const loadSelectedSets = () => {
                const savedSelection = localStorage.getItem('selectedSetsForCombined');
                if (savedSelection) {
                    try {
                        const parsedSelection = JSON.parse(savedSelection);
                        setSelectedSetsForCombined(parsedSelection);
                        console.log('Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ ÏÑ†ÌÉùÏù¥ Î°úÎìúÎêòÏóàÏäµÎãàÎã§.');
                    } catch (error) {
                        console.error('ÏÑ∏Ìä∏ ÏÑ†ÌÉù Î°úÎìú Ïã§Ìå®:', error);
                        setSelectedSetsForCombined({});
                    }
                }
            };

            // Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•Ïóê ÏÑ†ÌÉùÎêú ÏÑ∏Ìä∏Îì§ Ï†ÄÏû•
            const saveSelectedSets = (selection) => {
                localStorage.setItem('selectedSetsForCombined', JSON.stringify(selection));
                console.log('Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ ÏÑ†ÌÉùÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
            };

            // ÏÑ†ÌÉùÎêú Îã®Ïñ¥Ïû•Îì§ÏùÑ Ìï©Ï≥êÏÑú ÏÉà Îã®Ïñ¥Ïû• ÏÉùÏÑ±
            const mergeSelectedSets = () => {
                const selectedSetIds = Object.entries(selectedSetsForMerge)
                    .filter(([_, selected]) => selected)
                    .map(([setId, _]) => setId);

                if (selectedSetIds.length === 0) {
                    showAlert('Ìï©Ïπ† Îã®Ïñ¥Ïû•ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                    return;
                }

                if (!newMergedSetName.trim()) {
                    showAlert('ÏÉà Îã®Ïñ¥Ïû•Ïùò Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                    return;
                }

                // Ïù¥Î¶Ñ Ï§ëÎ≥µ ÌôïÏù∏
                if (setNames[newMergedSetName.trim()] || Object.values(setNames).includes(newMergedSetName.trim())) {
                    showAlert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî Îã®Ïñ¥Ïû• Ïù¥Î¶ÑÏûÖÎãàÎã§. Îã§Î•∏ Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                    return;
                }

                // ÏÑ†ÌÉùÎêú Îã®Ïñ¥Ïû•Îì§Ïùò Îã®Ïñ¥Î•º Ìï©ÏπòÍ∏∞
                let mergedWords = {};
                selectedSetIds.forEach(setId => {
                    if (wordSets[setId]) {
                        Object.assign(mergedWords, wordSets[setId]);
                    }
                });

                if (Object.keys(mergedWords).length === 0) {
                    showAlert('ÏÑ†ÌÉùÎêú Îã®Ïñ¥Ïû•Îì§Ïóê Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§.', 'warning');
                    return;
                }

                // ÏÉà ID ÏÉùÏÑ±
                const newSetId = 'merged_' + Date.now();

                // ÏÉà Îã®Ïñ¥Ïû• Ï∂îÍ∞Ä
                const updatedSets = { ...wordSets, [newSetId]: mergedWords };
                const updatedNames = { ...setNames, [newSetId]: newMergedSetName.trim() };

                setWordSets(updatedSets);
                setSetNames(updatedNames);

                // ÌòÑÏû¨ ÏÑ∏Ìä∏Î•º ÏÉàÎ°ú ÎßåÎì† Îã®Ïñ¥Ïû•ÏúºÎ°ú Î≥ÄÍ≤Ω
                setCurrentSetId(newSetId);
                setWords(mergedWords);

                // Ï†ÄÏû•
                saveAllSets(updatedSets, updatedNames, newSetId);

                // ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                setSelectedSetsForMerge({});
                setNewMergedSetName('');
                setShowMergeSelector(false);

                showAlert(`üéâ '${newMergedSetName.trim()}' Îã®Ïñ¥Ïû•Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§! (${Object.keys(mergedWords).length}Í∞ú Îã®Ïñ¥)`, 'success');
            };

            // ÏÑ†ÌÉùÎêú Îã®Ïñ¥Ïû•Îì§ÏùÑ ÏùºÍ¥Ñ ÏÇ≠Ï†ú
            const deleteSelectedSets = async () => {
                const selectedSetIds = Object.entries(selectedSetsForDelete)
                    .filter(([_, selected]) => selected)
                    .map(([setId, _]) => setId);

                if (selectedSetIds.length === 0) {
                    showAlert('ÏÇ≠Ï†úÌï† Îã®Ïñ¥Ïû•ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                    return;
                }

                // Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•(combined) ÏÇ≠Ï†ú Î∞©ÏßÄ
                const filteredSetIds = selectedSetIds.filter(setId => setId !== 'combined');
                if (filteredSetIds.length !== selectedSetIds.length) {
                    showAlert('Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•ÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.', 'warning');
                }

                if (filteredSetIds.length === 0) {
                    return;
                }

                const setNamesToDelete = filteredSetIds.map(setId => setNames[setId]).join(', ');
                const confirmed = await showCustomPopup(
                    `Ï†ïÎßêÎ°ú Îã§Ïùå Îã®Ïñ¥Ïû•Îì§ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n${setNamesToDelete}\n\nÏÇ≠Ï†úÎêú Îã®Ïñ¥Ïû•ÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.`,
                    'Îã®Ïñ¥Ïû• ÏùºÍ¥Ñ ÏÇ≠Ï†ú ÌôïÏù∏',
                    'danger',
                    true
                );

                if (confirmed) {
                    const updatedSets = { ...wordSets };
                    const updatedNames = { ...setNames };

                    // ÏÑ†ÌÉùÎêú ÏÑ∏Ìä∏Îì§ ÏÇ≠Ï†ú
                    filteredSetIds.forEach(setId => {
                        delete updatedSets[setId];
                        delete updatedNames[setId];
                    });

                    // ÌòÑÏû¨ ÏÑ∏Ìä∏Í∞Ä ÏÇ≠Ï†úÎêòÎäî Í≤ΩÏö∞ Îã§Î•∏ ÏÑ∏Ìä∏Î°ú Ï†ÑÌôò
                    let newCurrentSet = currentSetId;
                    if (filteredSetIds.includes(currentSetId)) {
                        const remainingSetIds = Object.keys(updatedSets);
                        newCurrentSet = remainingSetIds.length > 0 ? remainingSetIds[0] : '';
                    }

                    setWordSets(updatedSets);
                    setSetNames(updatedNames);
                    if (newCurrentSet !== currentSetId) {
                        setCurrentSetId(newCurrentSet);
                        setWords(newCurrentSet ? updatedSets[newCurrentSet] : {});
                    }

                    // ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                    setSelectedSetsForDelete({});
                    setShowDeleteSelector(false);

                    saveAllSets(updatedSets, updatedNames, newCurrentSet);
                    showAlert(`üóëÔ∏è ${filteredSetIds.length}Í∞úÏùò Îã®Ïñ¥Ïû•Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'info');
                }
            };

            // Îã®Ïñ¥ Ï¶êÍ≤®Ï∞æÍ∏∞ ÌÜ†Í∏Ä
            const toggleWordFavorite = (wordKey) => {
                const currentSetFavorites = favoriteWords[currentSetId] || {};
                const isCurrentlyFavorite = currentSetFavorites[wordKey];

                const updatedFavorites = {
                    ...favoriteWords,
                    [currentSetId]: {
                        ...currentSetFavorites,
                        [wordKey]: !isCurrentlyFavorite
                    }
                };

                // falseÏù∏ Ìï≠Î™©Îì§ÏùÄ Ï†úÍ±∞ (Ï†ïÎ¶¨)
                if (!updatedFavorites[currentSetId][wordKey]) {
                    delete updatedFavorites[currentSetId][wordKey];
                }

                setFavoriteWords(updatedFavorites);
                saveFavoriteWords(updatedFavorites);

                const action = !isCurrentlyFavorite ? 'ÌëúÏãú' : 'Ìï¥Ï†ú';
                showAlert(`‚≠ê '${wordKey}' Îã®Ïñ¥Î•º ${action}ÌñàÏäµÎãàÎã§.`, 'info');
            };

            // ÌòÑÏû¨ ÏÑ∏Ìä∏Ïùò Ï¶êÍ≤®Ï∞æÍ∏∞ Îã®Ïñ¥Îì§ Í∞ÄÏ†∏Ïò§Í∏∞
            const getCurrentSetFavorites = () => {
                return favoriteWords[currentSetId] || {};
            };

            // ÌòÑÏû¨ ÏÑ∏Ìä∏Ïùò Î™®Îì† ÌëúÏãú Ìï¥Ï†ú
            const clearAllFavorites = async () => {
                const currentFavorites = getCurrentSetFavorites();
                const favoriteCount = Object.keys(currentFavorites).length;

                if (favoriteCount === 0) {
                    showAlert('ÌëúÏãúÎêú Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§.', 'info');
                    return;
                }

                const confirmed = await showCustomPopup(
                    `ÌòÑÏû¨ ÏÑ∏Ìä∏Ïùò ÌëúÏãúÎêú Îã®Ïñ¥ ${favoriteCount}Í∞úÎ•º Î™®Îëê Ìï¥Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`,
                    'Ï†ÑÏ≤¥ ÌëúÏãú Ìï¥Ï†ú',
                    'Ìï¥Ï†ú',
                    'Ï∑®ÏÜå'
                );

                if (confirmed) {
                    const updatedFavorites = { ...favoriteWords };
                    updatedFavorites[currentSetId] = {};

                    setFavoriteWords(updatedFavorites);
                    saveFavoriteWords(updatedFavorites);

                    showAlert(`‚≠ê ${favoriteCount}Í∞ú Îã®Ïñ¥Ïùò ÌëúÏãúÎ•º Î™®Îëê Ìï¥Ï†úÌñàÏäµÎãàÎã§.`, 'success');
                }
            };

            // Ï¶êÍ≤®Ï∞æÍ∏∞ Î∞è Í≤ÄÏÉâÏñ¥Î°ú Îã®Ïñ¥ ÌïÑÌÑ∞ÎßÅ
            const getFilteredWords = () => {
                let filteredWords = words;
                
                // 1. Ï¶êÍ≤®Ï∞æÍ∏∞ ÌïÑÌÑ∞ÎßÅ
                if (showFavoritesOnly) {
                    const currentFavorites = getCurrentSetFavorites();
                    const favoriteWords = {};
                    
                    Object.keys(words).forEach(wordKey => {
                        if (currentFavorites[wordKey]) {
                            favoriteWords[wordKey] = words[wordKey];
                        }
                    });
                    filteredWords = favoriteWords;
                }
                
                // 2. Í≤ÄÏÉâÏñ¥ ÌïÑÌÑ∞ÎßÅ
                if (searchQuery.trim()) {
                    const query = searchQuery.toLowerCase().trim();
                    const searchedWords = {};
                    
                    Object.entries(filteredWords).forEach(([hiragana, data]) => {
                        // ÌûàÎùºÍ∞ÄÎÇò, ÌïúÏûê, ÌïúÍµ≠Ïñ¥ Îúª, ÌûàÎùºÍ∞ÄÎÇòÏùò ÌïúÍ∏Ä Î∞úÏùåÏóêÏÑú Í≤ÄÏÉâ
                        const koreanPronunciation = convertHiraganaToKorean(hiragana);
                        const searchTargets = [
                            hiragana,                           // ÌûàÎùºÍ∞ÄÎÇò
                            data.kanji || '',                  // ÌïúÏûê
                            data.korean || '',                 // ÌïúÍµ≠Ïñ¥ Îúª
                            koreanPronunciation,               // ÌûàÎùºÍ∞ÄÎÇòÏùò ÌïúÍ∏Ä Î∞úÏùå
                        ].map(text => text.toLowerCase());
                        
                        // Í≤ÄÏÉâÏñ¥Í∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏
                        const isMatch = searchTargets.some(target => target.includes(query));
                        
                        if (isMatch) {
                            searchedWords[hiragana] = data;
                        }
                    });
                    filteredWords = searchedWords;
                }
                
                return filteredWords;
            };

            // ÌòÑÏû¨ ÏÑ∏Ìä∏Ïùò Îã®Ïñ¥Í∞Ä Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ Ï†ÄÏû• Î∞è Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏóÖÎç∞Ïù¥Ìä∏
            useEffect(() => {
                if (Object.keys(words).length > 0 && wordSets[currentSetId] && currentSetId !== 'combined') {
                    const updatedSets = {
                        ...wordSets,
                        [currentSetId]: words
                    };
                    setWordSets(updatedSets);
                    saveAllSets(updatedSets, setNames, currentSetId);
                    console.log(`'${setNames[currentSetId]}' ÏÑ∏Ìä∏Í∞Ä ÏûêÎèô Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§:`, Object.keys(words).length + 'Í∞ú Îã®Ïñ¥');
                }
            }, [words]);
            
            // wordSetsÍ∞Ä Î≥ÄÍ≤ΩÎê† ÎïåÎßàÎã§ Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏóÖÎç∞Ïù¥Ìä∏
            useEffect(() => {
                updateCombinedWordSet();
            }, [wordSets, setNames, currentSetId]);

            // ÌûàÎùºÍ∞ÄÎÇò ÏûÖÎ†• Ïãú ÌïúÏûê ÏûêÎèô Í≤ÄÏÉâ (API ÏÇ¨Ïö©)
            useEffect(() => {
                const searchKanji = async () => {
                    if (newHiragana) {
                        const foundKanji = await findKanjiForWord(newHiragana);
                        if (foundKanji) {
                            setNewKanji(foundKanji);
                        }
                    } else {
                        setNewKanji('');
                        setKanjiStatus('');
                    }
                };
                
                // ÎîîÎ∞îÏö¥Ïä§ Ï≤òÎ¶¨ (500ms ÌõÑÏóê Í≤ÄÏÉâ)
                const timeoutId = setTimeout(searchKanji, 500);
                return () => clearTimeout(timeoutId);
            }, [newHiragana]);

            // Î≥µÏû°Ìïú ÌïúÍ∏Ä ‚Üí ÌûàÎùºÍ∞ÄÎÇò Î≥ÄÌôò (ÏÜåÏø†Ïò® Ï≤òÎ¶¨ Í∞úÏÑ†)
            const convertHangulToHiragana = useCallback((hangul) => {
                let result = '';
                let i = 0;
                
                while (i < hangul.length) {
                    let found = false;
                    
                    // 4Í∏ÄÏûê Ï°∞Ìï© ÌôïÏù∏ (Ïòà: "ÌÇ§ÌÜ†")
                    if (i + 3 < hangul.length) {
                        const four = hangul.substr(i, 4);
                        if (hangulToHiragana[four]) {
                            result += hangulToHiragana[four];
                            i += 4;
                            found = true;
                        }
                    }
                    
                    // 3Í∏ÄÏûê Ï°∞Ìï© ÌôïÏù∏ (Ïòà: "ÌÇ∑ÌÜ†", "Ïµ∏ÌÜ†")
                    if (!found && i + 2 < hangul.length) {
                        const three = hangul.substr(i, 3);
                        if (hangulToHiragana[three]) {
                            result += hangulToHiragana[three];
                            i += 3;
                            found = true;
                        }
                    }
                    
                    // 2Í∏ÄÏûê Ï°∞Ìï© ÌôïÏù∏ (Ïòà: "ÌÇ∑", "ÏöîÏùå")
                    if (!found && i + 1 < hangul.length) {
                        const two = hangul.substr(i, 2);
                        if (hangulToHiragana[two]) {
                            result += hangulToHiragana[two];
                            i += 2;
                            found = true;
                        }
                    }
                    
                    // 1Í∏ÄÏûê ÌôïÏù∏
                    if (!found) {
                        const one = hangul[i];
                        if (hangulToHiragana[one]) {
                            result += hangulToHiragana[one];
                        } else {
                            // ÏÜåÏø†Ïò® ÌäπÎ≥Ñ Ï≤òÎ¶¨: „ÖÖÍ∞Ä ÏûêÏùå ÏïûÏóê Ïò§Î©¥ „Å£Î°ú Î≥ÄÌôò
                            if (one === '„ÖÖ' && i + 1 < hangul.length) {
                                const nextChar = hangul[i + 1];
                                // Îã§Ïùå Í∏ÄÏûêÍ∞Ä ÏûêÏùåÏúºÎ°ú ÏãúÏûëÌïòÎäî Í∏ÄÏûêÎ©¥ ÏÜåÏø†Ïò®
                                if (['„Ñ±', '„Ñ¥', '„Ñ∑', '„Ñπ', '„ÖÅ', '„ÖÇ', '„ÖÖ', '„Öà', '„Öä', '„Öã', '„Öå', '„Öç', '„Öé',
                                     '„Ñ≤', '„Ñ∏', '„ÖÉ', '„ÖÜ', '„Öâ'].includes(nextChar) ||
                                    ['Í∞Ä', 'ÎÇò', 'Îã§', 'Îùº', 'Îßà', 'Î∞î', 'ÏÇ¨', 'Ïûê', 'Ï∞®', 'Ïπ¥', 'ÌÉÄ', 'Ìåå', 'Ìïò',
                                     'Í∏∞', 'Îãà', 'Îîî', 'Î¶¨', 'ÎØ∏', 'ÎπÑ', 'Ïãú', 'ÏßÄ', 'Ïπò', 'ÌÇ§', 'Ìã∞', 'Ìîº', 'Ìûà',
                                     'Íµ¨', 'ÎàÑ', 'Îëê', 'Î£®', 'Î¨¥', 'Î∂Ä', 'Ïàò', 'Ï£º', 'Ï∂î', 'Ïø†', 'Ìà¨', 'Ìë∏', 'ÌõÑ',
                                     'Í≤å', 'ÎÑ§', 'Îç∞', 'Î†à', 'Î©î', 'Î≤†', 'ÏÑ∏', 'Ï†ú', 'Ï≤¥', 'ÏºÄ', 'ÌÖå', 'Ìéò', 'Ìó§',
                                     'Í≥†', 'ÎÖ∏', 'ÎèÑ', 'Î°ú', 'Î™®', 'Î≥¥', 'ÏÜå', 'Ï°∞', 'Ï¥à', 'ÏΩî', 'ÌÜ†', 'Ìè¨', 'Ìò∏'].some(char => nextChar.startsWith(char))) {
                                    result += '„Å£';
                                } else {
                                    result += one; // Î≥ÄÌôòÌï† Ïàò ÏóÜÎäî Î¨∏ÏûêÎäî Í∑∏ÎåÄÎ°ú
                                }
                            } else {
                                result += one; // Î≥ÄÌôòÌï† Ïàò ÏóÜÎäî Î¨∏ÏûêÎäî Í∑∏ÎåÄÎ°ú
                            }
                        }
                        i += 1;
                    }
                }
                
                return result;
            }, []);

            // ÌïúÍ∏Ä ÏûÖÎ†• Ïãú ÏûêÎèô Î≥ÄÌôò
            useEffect(() => {
                if (hangulInput) {
                    const converted = convertHangulToHiragana(hangulInput);
                    setConvertedHiragana(converted);
                } else {
                    setConvertedHiragana('');
                }
            }, [hangulInput, convertHangulToHiragana]);

            // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÏö© Ïã§ÏãúÍ∞Ñ ÌïúÍ∏Ä Î≥ÄÌôò
            useEffect(() => {
                if (quizType === 'hiragana' && userAnswer) {
                    const converted = convertHangulToHiragana(userAnswer);
                    setConvertedQuizAnswer(converted);
                } else {
                    setConvertedQuizAnswer('');
                }
            }, [userAnswer, quizType, convertHangulToHiragana]);

            // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏö© ÌûàÎùºÍ∞ÄÎÇò Ïã§ÏãúÍ∞Ñ Î≥ÄÌôò
            useEffect(() => {
                if (quizType === 'both' && userHiraganaAnswer) {
                    const converted = convertHangulToHiragana(userHiraganaAnswer);
                    setConvertedHiraganaAnswer(converted);
                } else {
                    setConvertedHiraganaAnswer('');
                }
            }, [userHiraganaAnswer, quizType, convertHangulToHiragana]);

            // APIÎ•º ÌÜµÌïú ÌïúÏûê Í≤ÄÏÉâ (Ïó¨Îü¨ ÌõÑÎ≥¥ Î∞òÌôò)
            const searchKanjiAPI = async (hiragana) => {
                try {
                    setKanjiStatus('üîç ÌïúÏûê ÌõÑÎ≥¥ Í≤ÄÏÉâ Ï§ë...');
                    setKanjiCandidates([]);
                    
                    // Ïó¨Îü¨ CORS ÌîÑÎ°ùÏãú ÏÑúÎπÑÏä§Î•º ÏàúÏ∞®Ï†ÅÏúºÎ°ú ÏãúÎèÑ
                    const proxies = [
                        'https://api.codetabs.com/v1/proxy?quest=',
                        'https://cors-proxy.htmldriven.com/?url=',
                        'https://cors.bridged.cc/',
                        'https://api.allorigins.win/raw?url='
                    ];
                    
                    const jishoUrl = `https://jisho.org/api/v1/search/words?keyword=${encodeURIComponent(hiragana)}`;
                    let data = null;
                    
                    // Í∞Å ÌîÑÎ°ùÏãúÎ•º ÏàúÏ∞®Ï†ÅÏúºÎ°ú ÏãúÎèÑ
                    for (const proxy of proxies) {
                        try {
                            console.log(`ÌîÑÎ°ùÏãú ÏãúÎèÑ: ${proxy}`);
                            const response = await fetch(proxy + encodeURIComponent(jishoUrl), {
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json',
                                },
                                timeout: 10000 // 10Ï¥à ÌÉÄÏûÑÏïÑÏõÉ
                            });
                            
                            if (response.ok) {
                                const responseText = await response.text();
                                // JSONÏù∏ÏßÄ ÌôïÏù∏
                                if (responseText.trim().startsWith('{')) {
                                    data = JSON.parse(responseText);
                                    if (data.data) {
                                        console.log(`ÏÑ±Í≥µÌïú ÌîÑÎ°ùÏãú: ${proxy}`);
                                        break;
                                    }
                                }
                            }
                        } catch (proxyError) {
                            console.log(`ÌîÑÎ°ùÏãú ${proxy} Ïã§Ìå®:`, proxyError.message);
                            continue;
                        }
                    }
                    
                    console.log('API ÏùëÎãµ:', data); // ÎîîÎ≤ÑÍπÖÏö©
                    
                    if (data && data.data && data.data.length > 0) {
                        const candidates = [];
                        
                        // Î™®Îì† Í≤∞Í≥ºÏóêÏÑú ÌïúÏûê ÌõÑÎ≥¥Îì§ ÏàòÏßë
                        for (let entry of data.data.slice(0, 8)) { // ÏµúÎåÄ 8Í∞úÎßå
                            if (entry.japanese && entry.japanese.length > 0) {
                                for (let japanese of entry.japanese) {
                                    // ÌïúÏûêÍ∞Ä ÏûàÍ≥†, ÌûàÎùºÍ∞ÄÎÇòÏôÄ Îã§Î•∏ Í≤ΩÏö∞Îßå
                                    if (japanese.word && 
                                        japanese.word !== hiragana && 
                                        /[\u4e00-\u9faf]/.test(japanese.word) &&
                                        !candidates.some(c => c.kanji === japanese.word)) {
                                        
                                        // ÏòÅÏñ¥ Îúª Ï∂îÍ∞Ä
                                        const meanings = entry.senses && entry.senses[0] && entry.senses[0].english_definitions
                                            ? entry.senses[0].english_definitions.slice(0, 3).join(', ')
                                            : '';
                                        
                                        candidates.push({
                                            kanji: japanese.word,
                                            reading: japanese.reading || hiragana,
                                            meanings: meanings
                                        });
                                    }
                                }
                            }
                        }
                        
                        if (candidates.length > 0) {
                            setKanjiCandidates(candidates);
                            setKanjiStatus(`‚úÖ ${candidates.length}Í∞úÏùò ÌïúÏûê ÌõÑÎ≥¥Î•º Ï∞æÏïòÏäµÎãàÎã§`);
                            return candidates[0].kanji; // Ï≤´ Î≤àÏß∏Î•º Í∏∞Î≥∏Í∞íÏúºÎ°ú
                        }
                    }
                    
                    // Î™®Îì† ÌîÑÎ°ùÏãúÍ∞Ä Ïã§Ìå®Ìïú Í≤ΩÏö∞ ÏßÅÏ†ë API Ìò∏Ï∂ú ÏãúÎèÑ (CORS ÏóêÎü¨Í∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÏßÄÎßå ÏãúÎèÑÌï¥Î≥º Í∞ÄÏπòÍ∞Ä ÏûàÏùå)
                    console.log('Î™®Îì† ÌîÑÎ°ùÏãú Ïã§Ìå®, ÏßÅÏ†ë API Ìò∏Ï∂ú ÏãúÎèÑ Ï§ë...');
                    try {
                        const directResponse = await fetch(`https://jisho.org/api/v1/search/words?keyword=${encodeURIComponent(hiragana)}`, {
                            mode: 'cors',
                            headers: {
                                'Accept': 'application/json',
                            }
                        });
                        
                        if (directResponse.ok) {
                            const directData = await directResponse.json();
                            if (directData.data && directData.data.length > 0) {
                                const candidates = [];
                                
                                for (let entry of directData.data.slice(0, 8)) {
                                    if (entry.japanese && entry.japanese.length > 0) {
                                        for (let japanese of entry.japanese) {
                                            if (japanese.word && 
                                                japanese.word !== hiragana && 
                                                /[\u4e00-\u9faf]/.test(japanese.word) &&
                                                !candidates.some(c => c.kanji === japanese.word)) {
                                                
                                                const meanings = entry.senses && entry.senses[0] && entry.senses[0].english_definitions
                                                    ? entry.senses[0].english_definitions.slice(0, 3).join(', ')
                                                    : '';
                                                
                                                candidates.push({
                                                    kanji: japanese.word,
                                                    reading: japanese.reading || hiragana,
                                                    meanings: meanings
                                                });
                                            }
                                        }
                                    }
                                }
                                
                                if (candidates.length > 0) {
                                    setKanjiCandidates(candidates);
                                    setKanjiStatus(`‚úÖ ÏßÅÏ†ë API ÏÑ±Í≥µ: ${candidates.length}Í∞ú ÌïúÏûê Î∞úÍ≤¨`);
                                    return candidates[0].kanji;
                                }
                            }
                        }
                    } catch (directError) {
                        console.error('ÏßÅÏ†ë API Ìò∏Ï∂úÎèÑ Ïã§Ìå®:', directError);
                    }
                    
                    setKanjiStatus('‚ùå APIÏóêÏÑú ÌïúÏûê ÌõÑÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§');
                    return '';
                } catch (error) {
                    console.error('API Í≤ÄÏÉâ Ï†ÑÏ≤¥ Ïò§Î•ò:', error);
                    setKanjiStatus('‚ö†Ô∏è API Ïó∞Í≤∞ Ïã§Ìå® - ÎÇ¥Ïû• ÏÇ¨Ï†Ñ ÏÇ¨Ïö©');
                    return '';
                }
            };

            // Í∞úÏÑ†Îêú ÌïúÏûê Í≤ÄÏÉâ (API + ÎÇ¥Ïû• ÏÇ¨Ï†Ñ)
            const findKanjiForWord = async (hiragana) => {
                // 1ÏàúÏúÑ: ÎÇ¥Ïû• ÏÇ¨Ï†ÑÏóêÏÑú Îπ†Î•∏ Í≤ÄÏÉâ
                if (kanjiDict[hiragana]) {
                    setKanjiStatus(`‚úÖ ÎÇ¥Ïû• ÏÇ¨Ï†ÑÏóêÏÑú Î∞úÍ≤¨: ${kanjiDict[hiragana]}`);
                    setKanjiCandidates([{ kanji: kanjiDict[hiragana], reading: hiragana, meanings: 'ÎÇ¥Ïû• ÏÇ¨Ï†Ñ' }]);
                    return kanjiDict[hiragana];
                }
                
                // 2ÏàúÏúÑ: API Í≤ÄÏÉâ (Ïó¨Îü¨ ÌõÑÎ≥¥ Î∞òÌôò)
                const apiResult = await searchKanjiAPI(hiragana);
                if (apiResult) {
                    // API Í≤∞Í≥ºÎ•º ÎÇ¥Ïû• ÏÇ¨Ï†ÑÏóê Ï†ÄÏû•Ìï¥ÏÑú Îã§ÏùåÎ≤àÏóêÎäî Îçî Îπ®Î¶¨
                    kanjiDict[hiragana] = apiResult;
                    return apiResult;
                }
                
                return '';
            };

            // ÌïúÏûê ÌõÑÎ≥¥ ÏÑ†ÌÉù Ìï®Ïàò
            const selectKanjiCandidate = (candidate) => {
                setNewKanji(candidate.kanji);
                setKanjiStatus(`‚úÖ ÏÑ†ÌÉùÎê®: ${candidate.kanji} (${candidate.meanings})`);
                // ÏÑ†ÌÉùÎêú Í≤∞Í≥ºÎ•º ÎÇ¥Ïû• ÏÇ¨Ï†ÑÏóê Ï†ÄÏû•
                kanjiDict[newHiragana] = candidate.kanji;
            };

            // ÏÑ∏Ìä∏ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
            const createNewSet = async () => {
                // Í∞ÑÎã®Ìïú prompt ÏÇ¨Ïö©
                const setName = prompt('ÏÉà Îã®Ïñ¥Ïû•Ïùò Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî:');
                
                if (setName && setName.trim()) {
                    const newSetId = Date.now().toString();
                    const updatedSets = { ...wordSets, [newSetId]: {} };
                    const updatedNames = { ...setNames, [newSetId]: setName.trim() };
                    
                    setWordSets(updatedSets);
                    setSetNames(updatedNames);
                    saveAllSets(updatedSets, updatedNames, currentSetId);
                    
                    showAlert(`üìö '${setName.trim()}' Îã®Ïñ¥Ïû•Ïù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!`, 'success');
                }
            };

            const switchToSet = (setId) => {
                if (wordSets[setId]) {
                    setCurrentSetId(setId);
                    setWords(wordSets[setId]);
                    localStorage.setItem('currentWordSet', setId);
                    showAlert(`üìñ '${setNames[setId]}' Îã®Ïñ¥Ïû•ÏúºÎ°ú Ï†ÑÌôòÌñàÏäµÎãàÎã§.`, 'info');
                }
            };

            const deleteSet = async (setId) => {
                if (setId === 'combined') {
                    showAlert('Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•ÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§. (ÏûêÎèô ÏÉùÏÑ±ÎêòÎäî Îã®Ïñ¥Ïû•ÏûÖÎãàÎã§)', 'warning');
                    return;
                }

                const confirmed = await showCustomPopup(
                    `Ï†ïÎßêÎ°ú '${setNames[setId]}' Îã®Ïñ¥Ïû•ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÇ≠Ï†úÎêú Îã®Ïñ¥Ïû•ÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.`,
                    'Îã®Ïñ¥Ïû• ÏÇ≠Ï†ú ÌôïÏù∏',
                    'danger',
                    true
                );

                if (confirmed) {
                    const updatedSets = { ...wordSets };
                    const updatedNames = { ...setNames };
                    delete updatedSets[setId];
                    delete updatedNames[setId];

                    // ÌòÑÏû¨ ÏÑ∏Ìä∏Í∞Ä ÏÇ≠Ï†úÎêòÎäî Í≤ΩÏö∞ Îã§Î•∏ ÏÑ∏Ìä∏Î°ú Ï†ÑÌôò
                    let newCurrentSet = currentSetId;
                    if (setId === currentSetId) {
                        const remainingSetIds = Object.keys(updatedSets);
                        newCurrentSet = remainingSetIds.length > 0 ? remainingSetIds[0] : '';
                    }
                    
                    setWordSets(updatedSets);
                    setSetNames(updatedNames);
                    if (newCurrentSet !== currentSetId) {
                        setCurrentSetId(newCurrentSet);
                        setWords(newCurrentSet ? updatedSets[newCurrentSet] : {});
                    }
                    
                    saveAllSets(updatedSets, updatedNames, newCurrentSet);
                    showAlert(`üóëÔ∏è '${setNames[setId]}' Îã®Ïñ¥Ïû•Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'info');
                }
            };

            // Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ/Î≥µÏõê Í∏∞Îä•Îì§
            const exportToJSON = () => {
                const dataToExport = {
                    wordSets: wordSets,
                    setNames: setNames,
                    currentSetId: currentSetId,
                    exportDate: new Date().toISOString(),
                    version: "1.0"
                };
                
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `japanese_vocabulary_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showAlert('üìÅ Îã®Ïñ¥Ïû•Ïù¥ JSON ÌååÏùºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Ï°åÏäµÎãàÎã§!', 'success');
            };

            const importFromJSON = async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const importedData = JSON.parse(text);
                    
                    if (!importedData.wordSets || !importedData.setNames) {
                        throw new Error('Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùÄ ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§.');
                    }
                    
                    const confirmed = await showCustomPopup(
                        'Îã®Ïñ¥Ïû•ÏùÑ Í∞ÄÏ†∏Ïò§ÏãúÍ≤†ÏäµÎãàÍπå?\n\nÍ∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Îäî Î∞±ÏóÖÎêú ÌõÑ ÏÉà Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥Îê©ÎãàÎã§.',
                        'Îã®Ïñ¥Ïû• Í∞ÄÏ†∏Ïò§Í∏∞ ÌôïÏù∏',
                        'warning',
                        true
                    );
                    
                    if (confirmed) {
                        // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ
                        const backupData = {
                            wordSets: wordSets,
                            setNames: setNames,
                            currentSetId: currentSetId,
                            backupDate: new Date().toISOString()
                        };
                        localStorage.setItem('japaneseWordSetsBackup', JSON.stringify(backupData));
                        
                        // ÏÉà Îç∞Ïù¥ÌÑ∞ Ï†ÅÏö©
                        setWordSets(importedData.wordSets);
                        setSetNames(importedData.setNames);
                        
                        const firstSetId = importedData.currentSetId || Object.keys(importedData.wordSets)[0];
                        setCurrentSetId(firstSetId);
                        setWords(importedData.wordSets[firstSetId]);
                        
                        saveAllSets(importedData.wordSets, importedData.setNames, firstSetId);
                        
                        showAlert(`üéâ Îã®Ïñ¥Ïû•ÏùÑ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Í∞ÄÏ†∏ÏôîÏäµÎãàÎã§! (${Object.keys(importedData.wordSets).length}Í∞ú ÏÑ∏Ìä∏)`, 'success');
                    }
                } catch (error) {
                    showAlert('‚ùå ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
                }
                
                // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî
                event.target.value = '';
            };

            const exportToCSV = () => {
                let csvContent = 'Set Name,Kanji,Hiragana,Korean,Favorite\n';
                
                Object.entries(wordSets).forEach(([setId, words]) => {
                    const setName = setNames[setId] || setId;
                    Object.entries(words).forEach(([kanji, data]) => {
                        const row = [
                            `"${setName}"`,
                            `"${kanji}"`,
                            `"${data.hiragana || ''}"`,
                            `"${data.korean || ''}"`,
                            data.favorite ? 'true' : 'false'
                        ].join(',');
                        csvContent += row + '\n';
                    });
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `japanese_vocabulary_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showAlert('üìä Îã®Ïñ¥Ïû•Ïù¥ CSV ÌååÏùºÎ°ú ÎÇ¥Î≥¥ÎÇ¥Ï°åÏäµÎãàÎã§!', 'success');
            };

            const importFromCSV = async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const lines = text.split('\n').filter(line => line.trim());
                    
                    if (lines.length < 2) {
                        throw new Error('CSV ÌååÏùºÏù¥ ÎπÑÏñ¥ÏûàÍ±∞ÎÇò ÌòïÏãùÏù¥ ÏûòÎ™ªÎêòÏóàÏäµÎãàÎã§.');
                    }
                    
                    const confirmed = await showCustomPopup(
                        'CSV ÌååÏùºÏóêÏÑú Îã®Ïñ¥Ïû•ÏùÑ Í∞ÄÏ†∏Ïò§ÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÉàÎ°úÏö¥ ÏÑ∏Ìä∏Î°ú Ï∂îÍ∞ÄÎêòÎ©∞ Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Îäî Ïú†ÏßÄÎê©ÎãàÎã§.',
                        'CSV Í∞ÄÏ†∏Ïò§Í∏∞ ÌôïÏù∏',
                        'info',
                        true
                    );
                    
                    if (!confirmed) return;
                    
                    const headers = lines[0].split(',');
                    const newSets = {};
                    const newSetNames = {};
                    
                    for (let i = 1; i < lines.length; i++) {
                        const values = lines[i].split(',').map(v => v.replace(/"/g, '').trim());
                        if (values.length < 4) continue;
                        
                        const [setName, kanji, hiragana, korean, favorite] = values;
                        if (!setName || !kanji) continue;
                        
                        const setId = `imported_${setName.toLowerCase().replace(/[^a-z0-9]/g, '_')}_${Date.now()}`;
                        
                        if (!newSets[setId]) {
                            newSets[setId] = {};
                            newSetNames[setId] = `${setName} (Í∞ÄÏ†∏Ïò¥)`;
                        }
                        
                        newSets[setId][kanji] = {
                            hiragana: hiragana || '',
                            korean: korean || '',
                            favorite: favorite === 'true'
                        };
                    }
                    
                    if (Object.keys(newSets).length === 0) {
                        throw new Error('Ïú†Ìö®Ìïú Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }
                    
                    const updatedSets = { ...wordSets, ...newSets };
                    const updatedNames = { ...setNames, ...newSetNames };
                    
                    setWordSets(updatedSets);
                    setSetNames(updatedNames);
                    saveAllSets(updatedSets, updatedNames, currentSetId);
                    
                    showAlert(`üìä CSVÏóêÏÑú ${Object.keys(newSets).length}Í∞ú ÏÑ∏Ìä∏Î•º Í∞ÄÏ†∏ÏôîÏäµÎãàÎã§!`, 'success');
                } catch (error) {
                    showAlert('‚ùå CSV ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
                }
                
                event.target.value = '';
            };

            const clearAllData = async () => {
                const confirmed = await showCustomPopup(
                    'Ï†ïÎßêÎ°ú Î™®Îì† Îã®Ïñ¥Ïû• Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÇ≠Ï†úÎêú Îç∞Ïù¥ÌÑ∞Îäî Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.\n\nÏÇ≠Ï†ú Ï†ÑÏóê Î∞±ÏóÖÏùÑ Í∂åÏû•Ìï©ÎãàÎã§!',
                    'Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú',
                    'danger',
                    true
                );
                
                if (confirmed) {
                    // Î∞±ÏóÖ ÏÉùÏÑ±
                    const backupData = {
                        wordSets: wordSets,
                        setNames: setNames,
                        currentSetId: currentSetId,
                        deletedDate: new Date().toISOString()
                    };
                    localStorage.setItem('japaneseWordSetsBackup', JSON.stringify(backupData));
                    
                    // Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                    localStorage.removeItem('japaneseWordSets');
                    localStorage.removeItem('japaneseSetNames');
                    localStorage.removeItem('currentWordSet');
                    
                    // Í∏∞Î≥∏ Îπà ÏÉÅÌÉúÎ°ú Ï¥àÍ∏∞Ìôî
                    setWordSets({});
                    setSetNames({});
                    setWords({});
                    setCurrentSetId('');
                    showAlert('üóëÔ∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§. (Î∞±ÏóÖ Ï†ÄÏû•Îê®)', 'info');
                }
            };

            // ÌïúÏûê Î∞úÏùå Ï°∞Ìöå Ìï®ÏàòÎì§
            const lookupKanjiPronunciation = async () => {
                if (!kanjiInput.trim()) {
                    setKanjiError('ÌïúÏûêÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                setKanjiError('');
                setKanjiResult(null);
                setKanjiLoading(true);

                try {
                    // 1. Î®ºÏ†Ä ÎÇ¥Ïû• ÏÇ¨Ï†ÑÏóêÏÑú Í≤ÄÏÉâ
                    const hiraganaReverse = Object.keys(kanjiDict).find(hiragana => kanjiDict[hiragana] === kanjiInput.trim());

                    if (hiraganaReverse) {
                        const result = {
                            kanji: kanjiInput.trim(),
                            hiragana: hiraganaReverse,
                            romaji: convertHiraganaToRomaji(hiraganaReverse),
                            meaning: '',
                            source: 'ÎÇ¥Ïû• ÏÇ¨Ï†Ñ'
                        };
                        setKanjiResult(result);
                        return;
                    }

                    // 2. Í∏∞Ï°¥ Îã®Ïñ¥Ïû•ÏóêÏÑú Í≤ÄÏÉâ
                    const allWords = getAllWords();
                    for (const [hiragana, wordData] of Object.entries(allWords)) {
                        if (wordData.kanji === kanjiInput.trim()) {
                            const result = {
                                kanji: kanjiInput.trim(),
                                hiragana: hiragana,
                                romaji: convertHiraganaToRomaji(hiragana),
                                meaning: wordData.korean || '',
                                source: 'Îã®Ïñ¥Ïû•'
                            };
                            setKanjiResult(result);
                            return;
                        }
                    }

                    // 3. Jisho APIÎ°ú Í≤ÄÏÉâ
                    const jishoResult = await searchWithJishoAPI(kanjiInput.trim());
                    if (jishoResult) {
                        setKanjiResult(jishoResult);
                        return;
                    }

                    // 4. Í∞ÑÎã®Ìïú ÌïúÏûê Î≥ÄÌôò (Í∏∞Î≥∏Ï†ÅÏù∏ Î≥ÄÌôòÎßå)
                    let hiraganaAttempt = '';
                    for (let char of kanjiInput.trim()) {
                        const found = Object.keys(kanjiDict).find(hiragana => kanjiDict[hiragana] === char);
                        if (found) {
                            hiraganaAttempt += found;
                        } else {
                            hiraganaAttempt += char;
                        }
                    }

                    if (hiraganaAttempt !== kanjiInput.trim()) {
                        const result = {
                            kanji: kanjiInput.trim(),
                            hiragana: hiraganaAttempt,
                            romaji: convertHiraganaToRomaji(hiraganaAttempt),
                            meaning: '',
                            source: 'Ï∂îÏ†ï'
                        };
                        setKanjiResult(result);
                    } else {
                        setKanjiError('Ìï¥Îãπ ÌïúÏûêÏùò Î∞úÏùåÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                    }

                } catch (error) {
                    console.error('ÌïúÏûê Î∞úÏùå Ï°∞Ìöå Ïò§Î•ò:', error);
                    setKanjiError('Î∞úÏùå Ï°∞Ìöå Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                } finally {
                    setKanjiLoading(false);
                }
            };

            // Jisho APIÎ•º ÌÜµÌïú ÌïúÏûê Í≤ÄÏÉâ
            const searchWithJishoAPI = async (kanji) => {
                try {
                    // Ïó¨Îü¨ ÌîÑÎ°ùÏãú ÏãúÎèÑ
                    const proxies = [
                        'https://api.allorigins.win/get?url=',
                        'https://corsproxy.io/?',
                        'https://cors-anywhere.herokuapp.com/',
                        'https://api.codetabs.com/v1/proxy?quest='
                    ];

                    for (const proxy of proxies) {
                        try {
                            const apiUrl = `https://jisho.org/api/v1/search/words?keyword=${encodeURIComponent(kanji)}`;
                            const response = await fetch(`${proxy}${encodeURIComponent(apiUrl)}`, {
                                method: 'GET',
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            });

                            if (!response.ok) continue;

                            let data;
                            if (proxy.includes('allorigins')) {
                                const result = await response.json();
                                data = JSON.parse(result.contents);
                            } else {
                                data = await response.json();
                            }

                            if (data && data.data && data.data.length > 0) {
                                const entry = data.data[0];

                                // ÏùΩÍ∏∞ Ï†ïÎ≥¥ Ï∂îÏ∂ú
                                let hiragana = '';
                                let meaning = '';

                                if (entry.japanese && entry.japanese.length > 0) {
                                    const japaneseEntry = entry.japanese[0];
                                    hiragana = japaneseEntry.reading || japaneseEntry.word || '';
                                }

                                if (entry.senses && entry.senses.length > 0) {
                                    const englishMeanings = entry.senses[0].english_definitions || [];
                                    meaning = englishMeanings.slice(0, 3).join(', '); // Ï≤òÏùå 3Í∞ú ÎúªÎßå
                                }

                                if (hiragana) {
                                    return {
                                        kanji: kanji,
                                        hiragana: hiragana,
                                        romaji: convertHiraganaToRomaji(hiragana),
                                        meaning: meaning,
                                        source: 'Jisho API'
                                    };
                                }
                            }
                        } catch (proxyError) {
                            console.log(`ÌîÑÎ°ùÏãú ${proxy} Ïã§Ìå®:`, proxyError);
                            continue;
                        }
                    }

                    return null;
                } catch (error) {
                    console.error('Jisho API Í≤ÄÏÉâ Ïò§Î•ò:', error);
                    return null;
                }
            };

            // Î™®Îì† Îã®Ïñ¥Ïû•Ïùò Îã®Ïñ¥Îì§ÏùÑ Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò
            const getAllWords = () => {
                let allWords = {};
                Object.values(wordSets).forEach(wordSet => {
                    Object.assign(allWords, wordSet);
                });
                return allWords;
            };

            // ÌûàÎùºÍ∞ÄÎÇòÎ•º Î°úÎßàÏûêÎ°ú Î≥ÄÌôò
            const convertHiraganaToRomaji = (hiragana) => {
                const hiraganaToRomaji = {
                    '„ÅÇ': 'a', '„ÅÑ': 'i', '„ÅÜ': 'u', '„Åà': 'e', '„Åä': 'o',
                    '„Åã': 'ka', '„Åç': 'ki', '„Åè': 'ku', '„Åë': 'ke', '„Åì': 'ko',
                    '„Åå': 'ga', '„Åé': 'gi', '„Åê': 'gu', '„Åí': 'ge', '„Åî': 'go',
                    '„Åï': 'sa', '„Åó': 'shi', '„Åô': 'su', '„Åõ': 'se', '„Åù': 'so',
                    '„Åñ': 'za', '„Åò': 'ji', '„Åö': 'zu', '„Åú': 'ze', '„Åû': 'zo',
                    '„Åü': 'ta', '„Å°': 'chi', '„Å§': 'tsu', '„Å¶': 'te', '„Å®': 'to',
                    '„Å†': 'da', '„Å¢': 'ji', '„Å•': 'zu', '„Åß': 'de', '„Å©': 'do',
                    '„Å™': 'na', '„Å´': 'ni', '„Å¨': 'nu', '„Å≠': 'ne', '„ÅÆ': 'no',
                    '„ÅØ': 'ha', '„Å≤': 'hi', '„Åµ': 'fu', '„Å∏': 'he', '„Åª': 'ho',
                    '„Å∞': 'ba', '„Å≥': 'bi', '„Å∂': 'bu', '„Åπ': 'be', '„Åº': 'bo',
                    '„Å±': 'pa', '„Å¥': 'pi', '„Å∑': 'pu', '„Å∫': 'pe', '„ÅΩ': 'po',
                    '„Åæ': 'ma', '„Åø': 'mi', '„ÇÄ': 'mu', '„ÇÅ': 'me', '„ÇÇ': 'mo',
                    '„ÇÑ': 'ya', '„ÇÜ': 'yu', '„Çà': 'yo',
                    '„Çâ': 'ra', '„Çä': 'ri', '„Çã': 'ru', '„Çå': 're', '„Çç': 'ro',
                    '„Çè': 'wa', '„Çê': 'wi', '„Çë': 'we', '„Çí': 'wo', '„Çì': 'n',
                    '„Å£': '',
                    // ÏöîÏùå
                    '„Åç„ÇÉ': 'kya', '„Åç„ÇÖ': 'kyu', '„Åç„Çá': 'kyo',
                    '„Åó„ÇÉ': 'sha', '„Åó„ÇÖ': 'shu', '„Åó„Çá': 'sho',
                    '„Å°„ÇÉ': 'cha', '„Å°„ÇÖ': 'chu', '„Å°„Çá': 'cho',
                    '„Å´„ÇÉ': 'nya', '„Å´„ÇÖ': 'nyu', '„Å´„Çá': 'nyo',
                    '„Å≤„ÇÉ': 'hya', '„Å≤„ÇÖ': 'hyu', '„Å≤„Çá': 'hyo',
                    '„Åø„ÇÉ': 'mya', '„Åø„ÇÖ': 'myu', '„Åø„Çá': 'myo',
                    '„Çä„ÇÉ': 'rya', '„Çä„ÇÖ': 'ryu', '„Çä„Çá': 'ryo',
                    '„Åé„ÇÉ': 'gya', '„Åé„ÇÖ': 'gyu', '„Åé„Çá': 'gyo',
                    '„Åò„ÇÉ': 'ja', '„Åò„ÇÖ': 'ju', '„Åò„Çá': 'jo',
                    '„Å≥„ÇÉ': 'bya', '„Å≥„ÇÖ': 'byu', '„Å≥„Çá': 'byo',
                    '„Å¥„ÇÉ': 'pya', '„Å¥„ÇÖ': 'pyu', '„Å¥„Çá': 'pyo'
                };

                let result = '';
                let i = 0;
                while (i < hiragana.length) {
                    let matched = false;
                    // 3Í∏ÄÏûê Ï°∞Ìï©Î∂ÄÌÑ∞ ÌôïÏù∏
                    for (let len = 3; len >= 1; len--) {
                        if (i + len <= hiragana.length) {
                            const substr = hiragana.substr(i, len);
                            if (hiraganaToRomaji[substr]) {
                                // „Å£ Ï≤òÎ¶¨ - Îã§Ïùå ÏûêÏùåÏùÑ Ï§ëÎ≥µ
                                if (substr === '„Å£' && i + 1 < hiragana.length) {
                                    const nextChar = hiragana[i + 1];
                                    const nextRomaji = hiraganaToRomaji[nextChar] || nextChar;
                                    if (nextRomaji && nextRomaji[0]) {
                                        result += nextRomaji[0];
                                    }
                                } else {
                                    result += hiraganaToRomaji[substr];
                                }
                                i += len;
                                matched = true;
                                break;
                            }
                        }
                    }
                    if (!matched) {
                        result += hiragana[i];
                        i++;
                    }
                }
                return result;
            };

            // Î∞úÏùå Îì£Í∏∞ (Web Speech API ÏÇ¨Ïö©)
            const playPronunciation = (text) => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ja-JP';
                    utterance.rate = 0.8;
                    speechSynthesis.speak(utterance);
                } else {
                    showAlert('ÏùåÏÑ± Ïû¨ÏÉùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Î∏åÎùºÏö∞Ï†ÄÏûÖÎãàÎã§.', 'warning');
                }
            };

            // ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨
            const copyToClipboard = (text) => {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        showAlert('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!', 'success');
                    }).catch(() => {
                        showAlert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
                    });
                } else {
                    // Íµ¨Ìòï Î∏åÎùºÏö∞Ï†Ä ÏßÄÏõê
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        showAlert('ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!', 'success');
                    } catch (err) {
                        showAlert('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
                    }
                    document.body.removeChild(textArea);
                }
            };

            // ÌïúÏûê Îã®Ïñ¥Î•º Îã®Ïñ¥Ïû•Ïóê Ï∂îÍ∞Ä
            const addKanjiToWordlist = (kanjiData) => {
                if (!kanjiData) return;

                // Í∏∞Ï°¥Ïóê ÏûàÎäîÏßÄ ÌôïÏù∏
                if (words[kanjiData.hiragana]) {
                    showAlert('Ïù¥ÎØ∏ Îã®Ïñ¥Ïû•Ïóê ÏûàÎäî Îã®Ïñ¥ÏûÖÎãàÎã§.', 'warning');
                    return;
                }

                // ÌòÑÏû¨ Îã®Ïñ¥Ïû•Ïóê Ï∂îÍ∞Ä
                const newWords = {
                    ...words,
                    [kanjiData.hiragana]: {
                        kanji: kanjiData.kanji,
                        korean: kanjiData.meaning || '(Îúª ÏóÜÏùå)'
                    }
                };

                setWords(newWords);

                // Ìï¥Îãπ ÏÑ∏Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
                const updatedSets = {
                    ...wordSets,
                    [currentSetId]: newWords
                };
                setWordSets(updatedSets);

                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
                localStorage.setItem('japaneseWordSets', JSON.stringify(updatedSets));

                showAlert('Îã®Ïñ¥Ïû•Ïóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!', 'success');

                // Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏóÖÎç∞Ïù¥Ìä∏
                setTimeout(() => updateCombinedWordSet(), 100);
            };

            const restoreBackup = async () => {
                try {
                    const backupData = localStorage.getItem('japaneseWordSetsBackup');
                    if (!backupData) {
                        showAlert('‚ùå Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.', 'warning');
                        return;
                    }
                    
                    const parsedBackup = JSON.parse(backupData);
                    
                    const confirmed = await showCustomPopup(
                        `Î∞±ÏóÖ Îç∞Ïù¥ÌÑ∞Î•º Î≥µÏõêÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÎ∞±ÏóÖ ÎÇ†Ïßú: ${new Date(parsedBackup.backupDate || parsedBackup.deletedDate).toLocaleString()}\n\nÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Îäî ÎçÆÏñ¥Ïì∞Ïó¨ÏßëÎãàÎã§.`,
                        'Î∞±ÏóÖ Î≥µÏõê ÌôïÏù∏',
                        'warning',
                        true
                    );
                    
                    if (confirmed) {
                        setWordSets(parsedBackup.wordSets);
                        setSetNames(parsedBackup.setNames);
                        setCurrentSetId(parsedBackup.currentSetId);
                        setWords(parsedBackup.wordSets[parsedBackup.currentSetId]);
                        
                        saveAllSets(parsedBackup.wordSets, parsedBackup.setNames, parsedBackup.currentSetId);
                        
                        showAlert('üîÑ Î∞±ÏóÖÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î≥µÏõêÎêòÏóàÏäµÎãàÎã§!', 'success');
                    }
                } catch (error) {
                    showAlert('‚ùå Î∞±ÏóÖ Î≥µÏõê Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message, 'error');
                }
            };

            // ÏïåÎ¶º ÌëúÏãú Ìï®Ïàò (ÎîîÎ≤ÑÍπÖ Ï∂îÍ∞Ä)
            const showAlert = (message, type = 'success') => {
                console.log('ÏïåÎ¶º ÌëúÏãú ÏãúÎèÑ:', { message, type }); // ÎîîÎ≤ÑÍπÖ
                setNotificationMessage(message);
                setNotificationType(type);
                setShowNotification(true);
                
                console.log('ÏïåÎ¶º ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏Îê®:', { showNotification: true, message, type }); // ÎîîÎ≤ÑÍπÖ
                
                // 3Ï¥à ÌõÑ ÏûêÎèôÏúºÎ°ú ÏÇ¨ÎùºÏßê
                setTimeout(() => {
                    setShowNotification(false);
                    console.log('ÏïåÎ¶º ÏûêÎèô Îã´Ìûò'); // ÎîîÎ≤ÑÍπÖ
                }, 3000);
            };

            // ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä ÏûàÎäîÏßÄ ÌôïÏù∏ÌïòÎäî Ìó¨Ìçº Ìï®Ïàò
            const hasHiraganaData = (wordKey, targetWords) => {
                if (!targetWords || !targetWords[wordKey]) return false;
                return (targetWords[wordKey]?.hiragana && targetWords[wordKey].hiragana.trim() !== '') || 
                       /^[\u3041-\u3096]+$/.test(wordKey);
            };

            // ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä ÏûàÎäî Îã®Ïñ¥Ïùò Í∞úÏàòÎ•º ÏÑ∏Îäî Ìó¨Ìçº Ìï®Ïàò
            const countHiraganaWords = (targetWords) => {
                if (!targetWords) return 0;
                return Object.keys(targetWords).filter(key => hasHiraganaData(key, targetWords)).length;
            };

            const startQuiz = (mode = 'all', type = 'korean') => {
                let targetWords;
                if (mode === 'favorites') {
                    const currentFavorites = getCurrentSetFavorites();
                    targetWords = {};
                    Object.keys(words).forEach(wordKey => {
                        if (currentFavorites[wordKey]) {
                            targetWords[wordKey] = words[wordKey];
                        }
                    });
                } else {
                    targetWords = words;
                }
                
                // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÎÇò Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏùò Í≤ΩÏö∞ ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä ÏûàÎäî Îã®Ïñ¥Îßå ÌïÑÌÑ∞ÎßÅ
                if (type === 'hiragana' || type === 'both') {
                    const filteredWords = {};
                    Object.keys(targetWords).forEach(key => {
                        if (hasHiraganaData(key, targetWords)) {
                            filteredWords[key] = targetWords[key];
                        }
                    });
                    targetWords = filteredWords;
                }
                
                if (Object.keys(targetWords).length === 0) {
                    if (type === 'hiragana' || type === 'both') {
                        showAlert('ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä Îì±Î°ùÎêú Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§! Î®ºÏ†Ä Îã®Ïñ¥Ïóê ÌûàÎùºÍ∞ÄÎÇòÎ•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî. üà∂', 'warning');
                    } else if (mode === 'favorites') {
                        showAlert('ÌëúÏãúÎêú Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§! Î®ºÏ†Ä Îã®Ïñ¥Ïû•ÏóêÏÑú Îã®Ïñ¥Î•º ÌëúÏãúÌï¥Ï£ºÏÑ∏Ïöî. ‚≠ê', 'warning');
                    } else {
                        showAlert('ÌòÑÏû¨ Îã®Ïñ¥Ïû•Ïù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§! Î®ºÏ†Ä Îã®Ïñ¥Î•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî. üìö', 'warning');
                    }
                    return;
                }
                
                setQuizMode(mode);
                setQuizType(type);
                setQuizStarted(true);
                setScore(0);
                setTotalQuestions(0);
                setUsedWords(new Set()); // Ï∂úÏ†úÎêú Î¨∏Ï†ú Ï¥àÍ∏∞Ìôî
                setQuizCompleted(false);
                setHideHiragana(true); // ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶º ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî (Í∏∞Î≥∏ÏúºÎ°ú Í∞ÄÎ¶º)
                setConvertedQuizAnswer(''); // Î≥ÄÌôòÎêú ÎãµÏïà Ï¥àÍ∏∞Ìôî
                setIsLoadingNextQuestion(false); // Î°úÎî© ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                setWrongAnswers([]); // ÌãÄÎ¶∞ ÎãµÏïà Î™©Î°ù Ï¥àÍ∏∞Ìôî
                
                // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶à ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                setUserKoreanAnswer('');
                setUserHiraganaAnswer('');
                setConvertedHiraganaAnswer('');
                setBothQuizResult({ korean: null, hiragana: null });
                
                const modeText = mode === 'favorites' ? 'ÌëúÏãúÎêú Îã®Ïñ¥Îßå' : 'Ï†ÑÏ≤¥ Îã®Ïñ¥';
                const typeText = type === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò' : type === 'both' ? 'Îëò Îã§ ÎßûÏ∂îÍ∏∞' : type === 'japanese' ? 'ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'ÌïúÍµ≠Ïñ¥';
                showAlert(`${modeText} ${typeText} ÌÄ¥Ï¶à ÏãúÏûë! ÌôîÏù¥ÌåÖ! üéå`, 'info');
                nextQuestion();
                
                // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏùº Îïå ÌïúÍµ≠Ïñ¥ ÏûÖÎ†• ÌïÑÎìúÏóê ÏûêÎèô Ìè¨Ïª§Ïä§ (ÏßÄÏó∞ Ïã§Ìñâ)
                if (type === 'both') {
                    setTimeout(() => {
                        const koreanInput = document.querySelector('input[placeholder*="ÌïúÍµ≠Ïñ¥"]');
                        if (koreanInput) {
                            koreanInput.focus();
                        }
                    }, 500); // nextQuestion ÏàòÌñâ ÌõÑ Ï∂©Î∂ÑÌûà Í∏∞Îã§Î¶¨Í∏∞
                }
            };


            // ÌÄ¥Ï¶à ÎåÄÏÉÅ Îã®Ïñ¥ Í∞ÄÏ†∏Ïò§Í∏∞
            const getQuizTargetWords = () => {
                let targetWords = {};
                
                if (quizMode === 'favorites') {
                    const currentFavorites = getCurrentSetFavorites();
                    Object.keys(words).forEach(wordKey => {
                        if (currentFavorites[wordKey]) {
                            targetWords[wordKey] = words[wordKey];
                        }
                    });
                } else {
                    targetWords = words;
                }
                
                // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÎÇò Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏùò Í≤ΩÏö∞ ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä ÏûàÎäî Îã®Ïñ¥Îßå ÌïÑÌÑ∞ÎßÅ
                if (quizType === 'hiragana' || quizType === 'both') {
                    const filteredWords = {};
                    Object.keys(targetWords).forEach(key => {
                        // hiragana ÏÜçÏÑ±Ïù¥ ÏûàÍ±∞ÎÇò, ÌÇ§ ÏûêÏ≤¥Í∞Ä ÌûàÎùºÍ∞ÄÎÇòÏù∏ Í≤ΩÏö∞ Ìè¨Ìï®
                        const hasHiragana = (targetWords[key].hiragana && targetWords[key].hiragana.trim() !== '') || 
                                           /^[\u3041-\u3096]+$/.test(key); // ÌûàÎùºÍ∞ÄÎÇò Î¨∏Ïûê Ï≤¥ÌÅ¨
                        if (hasHiragana) {
                            filteredWords[key] = targetWords[key];
                        }
                    });
                    return filteredWords;
                }
                
                return targetWords;
            };

            const nextQuestion = () => {
                // Ïù¥ÎØ∏ Î°úÎî© Ï§ëÏù¥Î©¥ Ï§ëÎ≥µ Ïã§Ìñâ Î∞©ÏßÄ
                if (isLoadingNextQuestion) return;
                
                setIsLoadingNextQuestion(true);
                
                const targetWords = getQuizTargetWords();
                const wordKeys = Object.keys(targetWords);
                
                // Îã®Ïñ¥Í∞Ä ÏóÜÏúºÎ©¥ ÌÄ¥Ï¶àÎ•º ÏãúÏûëÌï† Ïàò ÏóÜÏùå
                if (wordKeys.length === 0) {
                    setQuizCompleted(true);
                    setCurrentWord(null);
                    setIsLoadingNextQuestion(false);
                    return;
                }
                
                // ÌòÑÏû¨ usedWords ÏÉÅÌÉúÎ•º ÏµúÏã†ÏúºÎ°ú Í∞ÄÏ†∏Ïò§Í∏∞
                setUsedWords(currentUsedWords => {
                    const availableWords = wordKeys.filter(key => !currentUsedWords.has(key));
                    
                    // Î™®Îì† Îã®Ïñ¥Î•º Îã§ Ìëº Í≤ΩÏö∞
                    if (availableWords.length === 0) {
                        setQuizCompleted(true);
                        setCurrentWord(null);
                        const accuracy = totalQuestions > 0 ? Math.round((score / totalQuestions) * 100) : 0;
                        const modeText = quizMode === 'favorites' ? 'ÌëúÏãúÎêú Îã®Ïñ¥' : 'Ï†ÑÏ≤¥ Îã®Ïñ¥';
                        const typeText = quizType === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò' : quizType === 'both' ? 'Îëò Îã§ ÎßûÏ∂îÍ∏∞' : quizType === 'japanese' ? 'ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'ÌïúÍµ≠Ïñ¥';
                        const scoreDisplay = quizType === 'both' ? `${score}Ï†ê` : `${score}Î¨∏Ï†ú Ï†ïÎãµ`;
                        
                        const wrongCount = wrongAnswers.length;
                        const wrongText = wrongCount > 0 ? `\n\nÌãÄÎ¶∞ Î¨∏Ï†ú: ${wrongCount}Í∞ú` : '';
                        
                        showCustomPopup(
                            `üéâ Ï∂ïÌïòÌï©ÎãàÎã§! ${modeText} ${typeText} ÌÄ¥Ï¶àÎ•º ÏôÑÎ£åÌñàÏäµÎãàÎã§!\n\nÏ¥ù ${totalQuestions}Î¨∏Ï†ú Ï§ë ${scoreDisplay}\nÏ†ïÎãµÎ•†: ${accuracy}%${wrongText}\n\nÌÄ¥Ï¶àÎ•º Îã§Ïãú ÏãúÏûëÌïòÎ†§Î©¥ 'ÌÄ¥Ï¶à Ïû¨ÏãúÏûë' Î≤ÑÌäºÏùÑ ÎàåÎü¨Ï£ºÏÑ∏Ïöî.`,
                            'ÌÄ¥Ï¶à ÏôÑÎ£å!',
                            'success'
                        );
                        setIsLoadingNextQuestion(false);
                        return currentUsedWords;
                    }
                    
                    // ÏïÑÏßÅ Ï∂úÏ†úÎêòÏßÄ ÏïäÏùÄ Î¨∏Ï†ú Ï§ëÏóêÏÑú ÎûúÎç§ ÏÑ†ÌÉù
                    const randomKey = availableWords[Math.floor(Math.random() * availableWords.length)];
                    
                    // Ï§ëÎ≥µ Î∞©ÏßÄÎ•º ÏúÑÌïú Ï∂îÍ∞Ä Í≤ÄÏ¶ù
                    if (currentUsedWords.has(randomKey)) {
                        console.warn('Ï§ëÎ≥µ Î¨∏Ï†ú ÏÑ†ÌÉù Í∞êÏßÄ:', randomKey);
                        // Ïû¨Í∑ÄÏ†ÅÏúºÎ°ú Îã§Ïãú ÏÑ†ÌÉù (Î¨¥ÌïúÎ£®ÌîÑ Î∞©ÏßÄÎ•º ÏúÑÌï¥ availableWords ÏÇ¨Ïö©)
                        const alternativeWords = availableWords.filter(key => !currentUsedWords.has(key));
                        if (alternativeWords.length > 0) {
                            const alternativeKey = alternativeWords[0]; // Ï≤´ Î≤àÏß∏ ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Îã®Ïñ¥ ÏÑ†ÌÉù
                            setCurrentWord(alternativeKey);
                        } else {
                            setCurrentWord(randomKey); // fallback
                        }
                    } else {
                        setCurrentWord(randomKey);
                    }
                    
                    setUserAnswer('');
                    setResult(null);
                    setConvertedQuizAnswer(''); // Î≥ÄÌôòÎêú ÎãµÏïà Ï¥àÍ∏∞Ìôî
                    setIsAnswerSubmitted(false); // ÎãµÏïà Ï†úÏ∂ú ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                    
                    // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶à ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                    setUserKoreanAnswer('');
                    setUserHiraganaAnswer('');
                    setConvertedHiraganaAnswer('');
                    setBothQuizResult({ korean: null, hiragana: null });
                    
                    // Î°úÎî© ÏÉÅÌÉú Ìï¥Ï†ú Î∞è Ìè¨Ïª§Ïä§ ÏÑ§Ï†ï
                    setTimeout(() => {
                        setIsLoadingNextQuestion(false);
                        // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏùº Îïå ÌïúÍµ≠Ïñ¥ ÏûÖÎ†• ÌïÑÎìúÏóê ÏûêÎèô Ìè¨Ïª§Ïä§
                        if (quizType === 'both') {
                            const koreanInput = document.querySelector('input[placeholder*="ÌïúÍµ≠Ïñ¥"]');
                            if (koreanInput) {
                                koreanInput.focus();
                            }
                        }
                    }, 100);
                    
                    return currentUsedWords;
                });
            };

            const checkAnswer = () => {
                if (!currentWord || isAnswerSubmitted) return;
                
                setIsAnswerSubmitted(true); // ÎãµÏïà Ï†úÏ∂ú ÏÉÅÌÉúÎ°ú ÏÑ§Ï†ï
                
                if (quizType === 'both') {
                    // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶à Î°úÏßÅ
                    checkBothAnswers();
                } else {
                    // Í∏∞Ï°¥ Îã®Ïùº ÎãµÏïà ÌÄ¥Ï¶à Î°úÏßÅ
                    checkSingleAnswer();
                }
            };

            const checkSingleAnswer = () => {
                let correct, typeText;
                if (quizType === 'hiragana') {
                    // hiragana ÏÜçÏÑ±Ïù¥ ÏûàÏúºÎ©¥ ÏÇ¨Ïö©ÌïòÍ≥†, ÏóÜÏúºÎ©¥ ÌÇ§ ÏûêÏ≤¥Î•º ÌûàÎùºÍ∞ÄÎÇòÎ°ú ÏÇ¨Ïö©
                    correct = words[currentWord].hiragana || currentWord;
                    typeText = 'ÌûàÎùºÍ∞ÄÎÇò';
                } else if (quizType === 'japanese') {
                    // ÏùºÎ≥∏Ïñ¥ ÌÄ¥Ï¶à: ÌûàÎùºÍ∞ÄÎÇò ÌÇ§ ÎòêÎäî ÌïúÏûêÎ•º Ï†ïÎãµÏúºÎ°ú
                    correct = (words[currentWord] && words[currentWord].kanji) || currentWord;
                    typeText = 'ÏùºÎ≥∏Ïñ¥';
                } else {
                    correct = words[currentWord] && words[currentWord].korean;
                    typeText = 'ÌïúÍµ≠Ïñ¥';
                }
                
                setTotalQuestions(prev => prev + 1);
                
                // Ï†ïÎãµ/Ïò§Îãµ Í¥ÄÍ≥ÑÏóÜÏù¥ Ï∂úÏ†úÎêú Î¨∏Ï†úÎ°ú ÌëúÏãú (Ï§ëÎ≥µ Î∞©ÏßÄ)
                setUsedWords(prev => {
                    const newUsedWords = new Set(prev);
                    newUsedWords.add(currentWord);
                    console.log('Î¨∏Ï†ú Ï∂îÍ∞Ä:', currentWord, 'Ï¥ù Ï∂úÏ†ú:', newUsedWords.size);
                    return newUsedWords;
                });
                
                // ÎãµÏïà Ï†ïÎ¶¨ (Í≥µÎ∞± Ï†úÍ±∞)
                let cleanUserAnswer = userAnswer.trim();
                const cleanCorrectAnswer = correct ? correct.trim() : '';
                
                // ÌûàÎùºÍ∞ÄÎÇò ÌÄ¥Ï¶àÏùº Îïå ÌïúÍ∏Ä ÏûÖÎ†•ÏùÑ ÌûàÎùºÍ∞ÄÎÇòÎ°ú Î≥ÄÌôòÌï¥ÏÑú Ï≤¥ÌÅ¨
                if (quizType === 'hiragana') {
                    const convertedAnswer = convertHangulToHiragana(cleanUserAnswer);
                    // ÏõêÎ≥∏ ÏûÖÎ†•Í≥º Î≥ÄÌôòÎêú ÏûÖÎ†• Îëò Îã§ Ï≤¥ÌÅ¨
                    if (cleanUserAnswer === cleanCorrectAnswer || convertedAnswer === cleanCorrectAnswer) {
                        setScore(prev => prev + 1);
                        setResult({ type: 'correct', message: '‚úÖ Ï†ïÎãµ!' });
                        showAlert('üéâ Ï†ïÎãµÏûÖÎãàÎã§!', 'success');
                    } else {
                        // ÌãÄÎ¶∞ ÎãµÏïà Í∏∞Î°ù (hiragana ÌÄ¥Ï¶à)
                        const wrongItem = {
                            question: currentWord,
                            kanji: words[currentWord] && words[currentWord].kanji,
                            hiragana: (words[currentWord] && words[currentWord].hiragana) || currentWord,
                            korean: words[currentWord] && words[currentWord].korean,
                            userAnswer: userAnswer,
                            correctAnswer: correct,
                            quizType: quizType
                        };
                        setWrongAnswers(prev => [...prev, wrongItem]);
                        
                        setResult({ type: 'incorrect', message: `‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§. Ï†ïÎãµ: ${correct}` });
                        showAlert(`‚ùå ÌãÄÎ†∏Ïñ¥Ïöî! Ï†ïÎãµÏùÄ "${correct}" ÏûÖÎãàÎã§.`, 'error');
                    }
                } else if (quizType === 'japanese') {
                    // ÏùºÎ≥∏Ïñ¥ ÌÄ¥Ï¶à: ÌïúÏûêÏôÄ ÌûàÎùºÍ∞ÄÎÇò Îëò Îã§ Ï†ïÎãµÏúºÎ°ú Ïù∏Ï†ï
                    const hiraganaAnswer = (words[currentWord] && words[currentWord].hiragana) || currentWord;
                    const kanjiAnswer = words[currentWord] && words[currentWord].kanji;
                    
                    let isCorrect = false;
                    let correctAnswers = [];
                    
                    // ÌûàÎùºÍ∞ÄÎÇò Ï†ïÎãµ Ï≤¥ÌÅ¨ (ÌïúÍµ≠Ïñ¥ ÏûÖÎ†•ÎèÑ ÌûàÎùºÍ∞ÄÎÇòÎ°ú Î≥ÄÌôòÌï¥ÏÑú Ï≤¥ÌÅ¨)
                    const convertedAnswer = convertHangulToHiragana(cleanUserAnswer);
                    if (cleanUserAnswer === hiraganaAnswer.trim() || convertedAnswer === hiraganaAnswer.trim()) {
                        isCorrect = true;
                    }
                    correctAnswers.push(hiraganaAnswer);
                    
                    // ÌïúÏûê Ï†ïÎãµ Ï≤¥ÌÅ¨ (ÌïúÏûêÍ∞Ä ÏûàÎäî Í≤ΩÏö∞)
                    if (kanjiAnswer && kanjiAnswer.trim() !== '') {
                        if (cleanUserAnswer === kanjiAnswer.trim()) {
                            isCorrect = true;
                        }
                        correctAnswers.push(kanjiAnswer);
                    }
                    
                    if (isCorrect) {
                        setScore(prev => prev + 1);
                        setResult({ type: 'correct', message: '‚úÖ Ï†ïÎãµ!' });
                        showAlert('üéâ Ï†ïÎãµÏûÖÎãàÎã§!', 'success');
                    } else {
                        const answerText = correctAnswers.length > 1 ? correctAnswers.join(' / ') : correctAnswers[0];
                        
                        // ÌãÄÎ¶∞ ÎãµÏïà Í∏∞Î°ù (japanese ÌÄ¥Ï¶à)
                        const wrongItem = {
                            question: currentWord,
                            kanji: words[currentWord] && words[currentWord].kanji,
                            hiragana: (words[currentWord] && words[currentWord].hiragana) || currentWord,
                            korean: words[currentWord] && words[currentWord].korean,
                            userAnswer: userAnswer,
                            correctAnswer: answerText,
                            quizType: quizType
                        };
                        setWrongAnswers(prev => [...prev, wrongItem]);
                        
                        setResult({ type: 'incorrect', message: `‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§. Ï†ïÎãµ: ${answerText}` });
                        showAlert(`‚ùå ÌãÄÎ†∏Ïñ¥Ïöî! Ï†ïÎãµÏùÄ "${answerText}" ÏûÖÎãàÎã§.`, 'error');
                    }
                } else {
                    // ÌïúÍµ≠Ïñ¥ ÌÄ¥Ï¶àÏùº ÎïåÎäî Í∏∞Ï°¥ Î°úÏßÅ
                    if (cleanUserAnswer === cleanCorrectAnswer) {
                        setScore(prev => prev + 1);
                        setResult({ type: 'correct', message: '‚úÖ Ï†ïÎãµ!' });
                        showAlert('üéâ Ï†ïÎãµÏûÖÎãàÎã§!', 'success');
                    } else {
                        // ÌãÄÎ¶∞ ÎãµÏïà Í∏∞Î°ù (korean ÌÄ¥Ï¶à)
                        const wrongItem = {
                            question: currentWord,
                            kanji: words[currentWord] && words[currentWord].kanji,
                            hiragana: (words[currentWord] && words[currentWord].hiragana) || currentWord,
                            korean: words[currentWord] && words[currentWord].korean,
                            userAnswer: userAnswer,
                            correctAnswer: correct,
                            quizType: quizType
                        };
                        setWrongAnswers(prev => [...prev, wrongItem]);
                        
                        setResult({ type: 'incorrect', message: `‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§. Ï†ïÎãµ: ${correct}` });
                        showAlert(`‚ùå ÌãÄÎ†∏Ïñ¥Ïöî! Ï†ïÎãµÏùÄ "${correct}" ÏûÖÎãàÎã§.`, 'error');
                    }
                }
                
                setTimeout(() => {
                    nextQuestion();
                }, 2000);
            };

            const checkBothAnswers = () => {
                const correctKorean = words[currentWord] && words[currentWord].korean;
                const correctHiragana = (words[currentWord] && words[currentWord].hiragana) || currentWord;
                
                setTotalQuestions(prev => prev + 1);
                
                // Ï†ïÎãµ/Ïò§Îãµ Í¥ÄÍ≥ÑÏóÜÏù¥ Ï∂úÏ†úÎêú Î¨∏Ï†úÎ°ú ÌëúÏãú (Ï§ëÎ≥µ Î∞©ÏßÄ)
                setUsedWords(prev => {
                    const newUsedWords = new Set(prev);
                    newUsedWords.add(currentWord);
                    console.log('Î¨∏Ï†ú Ï∂îÍ∞Ä:', currentWord, 'Ï¥ù Ï∂úÏ†ú:', newUsedWords.size);
                    return newUsedWords;
                });
                
                // ÌïúÍµ≠Ïñ¥ ÎãµÏïà Ï≤¥ÌÅ¨
                const cleanKoreanAnswer = userKoreanAnswer.trim();
                const cleanCorrectKorean = correctKorean ? correctKorean.trim() : '';
                const koreanCorrect = cleanKoreanAnswer === cleanCorrectKorean;
                
                // ÌûàÎùºÍ∞ÄÎÇò ÎãµÏïà Ï≤¥ÌÅ¨ (ÌïúÍ∏Ä ÏûÖÎ†•ÎèÑ Î≥ÄÌôòÌï¥ÏÑú Ï≤¥ÌÅ¨)
                const cleanHiraganaAnswer = userHiraganaAnswer.trim();
                const cleanCorrectHiragana = correctHiragana ? correctHiragana.trim() : '';
                const convertedHiraganaInput = convertHangulToHiragana(cleanHiraganaAnswer);
                const hiraganaCorrect = cleanHiraganaAnswer === cleanCorrectHiragana || convertedHiraganaInput === cleanCorrectHiragana;
                
                // Í≤∞Í≥º Ï†ÄÏû•
                setBothQuizResult({
                    korean: koreanCorrect,
                    hiragana: hiraganaCorrect
                });
                
                // Ï†êÏàò Í≥ÑÏÇ∞ (Îëò Îã§ ÎßûÏ∂∞Ïïº 1Ï†ê, ÌïòÎÇòÎßå ÎßûÏ∂îÎ©¥ 0.5Ï†ê)
                if (koreanCorrect && hiraganaCorrect) {
                    setScore(prev => prev + 1);
                    setResult({ type: 'correct', message: 'üéâ ÏôÑÎ≤Ω! ÌïúÍµ≠Ïñ¥ÏôÄ ÌûàÎùºÍ∞ÄÎÇò Î™®Îëê Ï†ïÎãµ!' });
                    showAlert('üéâ ÏôÑÎ≤ΩÌï©ÎãàÎã§! Îëò Îã§ Ï†ïÎãµ!', 'success');
                } else if (koreanCorrect || hiraganaCorrect) {
                    setScore(prev => prev + 0.5);
                    const correctPart = koreanCorrect ? 'ÌïúÍµ≠Ïñ¥' : 'ÌûàÎùºÍ∞ÄÎÇò';
                    const wrongPart = koreanCorrect ? 'ÌûàÎùºÍ∞ÄÎÇò' : 'ÌïúÍµ≠Ïñ¥';
                    const wrongAnswer = koreanCorrect ? correctHiragana : correctKorean;
                    
                    // Î∂ÄÎ∂Ñ Ï†ïÎãµÎèÑ ÌãÄÎ¶∞ ÎãµÏïàÏúºÎ°ú Í∏∞Î°ù (Ï†ÑÏ≤¥ Ï†ïÎãµÏù¥ ÏïÑÎãàÎØÄÎ°ú)
                    const wrongItem = {
                        question: currentWord,
                        kanji: words[currentWord] && words[currentWord].kanji,
                        hiragana: (words[currentWord] && words[currentWord].hiragana) || currentWord,
                        korean: words[currentWord] && words[currentWord].korean,
                        userAnswer: `ÌïúÍµ≠Ïñ¥: ${userKoreanAnswer}, ÌûàÎùºÍ∞ÄÎÇò: ${userHiraganaAnswer}`,
                        correctAnswer: `ÌïúÍµ≠Ïñ¥: ${correctKorean}, ÌûàÎùºÍ∞ÄÎÇò: ${correctHiragana}`,
                        quizType: 'both',
                        result: 'partial'
                    };
                    setWrongAnswers(prev => [...prev, wrongItem]);
                    
                    setResult({ 
                        type: 'partial', 
                        message: `‚ö° Î∂ÄÎ∂Ñ Ï†ïÎãµ! ${correctPart}Îäî ÎßûÍ≥†, ${wrongPart}Îäî "${wrongAnswer}"` 
                    });
                    showAlert(`‚ö° Î∂ÄÎ∂Ñ Ï†ïÎãµ! ${correctPart}Îßå ÎßûÏ∑ÑÏñ¥Ïöî. +0.5Ï†ê`, 'warning');
                } else {
                    // Îëò Îã§ ÌãÄÎ¶∞ Í≤ΩÏö∞ Í∏∞Î°ù
                    const wrongItem = {
                        question: currentWord,
                        kanji: words[currentWord] && words[currentWord].kanji,
                        hiragana: (words[currentWord] && words[currentWord].hiragana) || currentWord,
                        korean: words[currentWord] && words[currentWord].korean,
                        userAnswer: `ÌïúÍµ≠Ïñ¥: ${userKoreanAnswer}, ÌûàÎùºÍ∞ÄÎÇò: ${userHiraganaAnswer}`,
                        correctAnswer: `ÌïúÍµ≠Ïñ¥: ${correctKorean}, ÌûàÎùºÍ∞ÄÎÇò: ${correctHiragana}`,
                        quizType: 'both',
                        result: 'incorrect'
                    };
                    setWrongAnswers(prev => [...prev, wrongItem]);
                    
                    setResult({ 
                        type: 'incorrect', 
                        message: `‚ùå Î™®Îëê ÌãÄÎ†∏ÏäµÎãàÎã§. ÌïúÍµ≠Ïñ¥: ${correctKorean}, ÌûàÎùºÍ∞ÄÎÇò: ${correctHiragana}` 
                    });
                    showAlert('‚ùå Îëò Îã§ ÌãÄÎ†∏Ïñ¥Ïöî. Îã§Ïãú ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî!', 'error');
                }
                
                setTimeout(() => {
                    nextQuestion();
                    // Îã§Ïùå Î¨∏Ï†úÎ°ú ÎÑòÏñ¥Í∞ÄÎ©¥ÏÑú ÌïúÍµ≠Ïñ¥ ÏûÖÎ†• ÌïÑÎìúÏóê Ìè¨Ïª§Ïä§
                    setTimeout(() => {
                        const koreanInput = document.querySelector('input[placeholder*="ÌïúÍµ≠Ïñ¥"]');
                        if (koreanInput) {
                            koreanInput.focus();
                        }
                    }, 200); // nextQuestion ÏàòÌñâ ÌõÑ Ï∂©Î∂ÑÌûà Í∏∞Îã§Î¶¨Í∏∞
                }, 3000); // Îëò Îã§ ÎßûÏ∂îÍ∏∞Îäî Í≤∞Í≥ºÎ•º Îçî Ïò§Îûò Î≥¥Ïó¨Ï§å
            };

            const addNewWord = async () => {
                if (!newHiragana || !newKorean) {
                    await showCustomPopup('ÌûàÎùºÍ∞ÄÎÇòÏôÄ ÌïúÍµ≠Ïñ¥Î•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!', 'ÏûÖÎ†• Ïò§Î•ò', 'warning');
                    return;
                }

                // ÏàòÏ†ï Î™®ÎìúÍ∞Ä ÏïÑÎãê Îïå Ï§ëÎ≥µ ÌôïÏù∏
                if (!isEditMode && words[newHiragana]) {
                    await showCustomPopup(`'${newHiragana}' ÌûàÎùºÍ∞ÄÎÇòÎäî Ïù¥ÎØ∏ Ï°¥Ïû¨Ìï©ÎãàÎã§!`, 'Ï§ëÎ≥µ Ïò§Î•ò', 'error');
                    return;
                }

                // ÏàòÏ†ï Î™®ÎìúÏùº Îïå: ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä Î≥ÄÍ≤ΩÎêòÏóàÍ≥†, ÏÉà ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî Í≤ΩÏö∞
                if (isEditMode && newHiragana !== editingWordKey && words[newHiragana]) {
                    await showCustomPopup(`'${newHiragana}' ÌûàÎùºÍ∞ÄÎÇòÎäî Ïù¥ÎØ∏ Ï°¥Ïû¨Ìï©ÎãàÎã§!`, 'Ï§ëÎ≥µ Ïò§Î•ò', 'error');
                    return;
                }

                const newWordData = {
                    kanji: newKanji.trim(),
                    korean: newKorean.trim()
                };

                setWords(prev => {
                    const updatedWords = { ...prev };
                    
                    // ÏàòÏ†ï Î™®ÎìúÏùº Îïå Í∏∞Ï°¥ Îã®Ïñ¥ ÏÇ≠Ï†ú (ÌûàÎùºÍ∞ÄÎÇòÍ∞Ä Î≥ÄÍ≤ΩÎêú Í≤ΩÏö∞)
                    if (isEditMode && newHiragana !== editingWordKey) {
                        delete updatedWords[editingWordKey];
                    }
                    
                    // ÏÉà Îã®Ïñ¥ Ï∂îÍ∞Ä/ÏàòÏ†ï
                    updatedWords[newHiragana] = newWordData;
                    return updatedWords;
                });

                // Ìèº Ï¥àÍ∏∞Ìôî
                const isEdit = isEditMode;
                setNewKanji('');
                setNewHiragana('');
                setNewKorean('');
                setHangulInput('');
                setKanjiStatus('');
                setKanjiCandidates([]);
                setIsEditMode(false);
                setEditingWordKey(null);
                
                if (isEdit) {
                    showCustomPopup('Îã®Ïñ¥Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§! ‚úÖ', 'ÏàòÏ†ï ÏôÑÎ£å', 'success');
                    setCurrentTab('words'); // Îã®Ïñ¥Ïû•ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                } else {
                    showCustomPopup('Îã®Ïñ¥Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§! üéâ', 'Ï∂îÍ∞Ä ÏôÑÎ£å', 'success');
                }
            };

            const useConvertedWord = () => {
                if (convertedHiragana) {
                    setNewHiragana(convertedHiragana);
                }
            };

            // Îã®Ïñ¥ ÏàòÏ†ï ÏãúÏûë - Îã®Ïñ¥ Ï∂îÍ∞Ä ÌÉ≠ÏúºÎ°ú Ïù¥ÎèôÌïòÏó¨ ÏàòÏ†ï
            const startEditWord = (wordKey) => {
                const wordData = words[wordKey];
                
                // ÏàòÏ†ï Î™®Îìú ÌôúÏÑ±Ìôî
                setIsEditMode(true);
                setEditingWordKey(wordKey);
                
                // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Î•º ÏûÖÎ†• ÌïÑÎìúÏóê ÏÑ§Ï†ï
                setNewHiragana(wordKey);
                setNewKanji(wordData.kanji || '');
                setNewKorean(wordData.korean || '');
                
                // Îã®Ïñ¥ Ï∂îÍ∞Ä ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
                setCurrentTab('add');
                
                showAlert(`üìù '${wordKey}' Îã®Ïñ¥Î•º ÏàòÏ†ï Î™®ÎìúÎ°ú Ï†ÑÌôòÌñàÏäµÎãàÎã§.`, 'info');
            };

            // ÏàòÏ†ï Ï∑®ÏÜå
            const cancelEdit = () => {
                setIsEditMode(false);
                setEditingWordKey(null);
                setNewKanji('');
                setNewHiragana('');
                setNewKorean('');
                setHangulInput('');
                setKanjiStatus('');
                setKanjiCandidates([]);
                
                showAlert('ÏàòÏ†ïÏù¥ Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§.', 'info');
            };

            const deleteWord = async (wordKey) => {
                const confirmed = await showCustomPopup(
                    `Ï†ïÎßêÎ°ú '${wordKey}' Îã®Ïñ¥Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÇ≠Ï†úÎêú Îã®Ïñ¥Îäî Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§.`, 
                    'Îã®Ïñ¥ ÏÇ≠Ï†ú ÌôïÏù∏', 
                    'danger', 
                    true  // Ï∑®ÏÜå Î≤ÑÌäº ÌëúÏãú
                );
                
                if (confirmed) {
                    setWords(prev => {
                        const newWords = { ...prev };
                        delete newWords[wordKey];
                        return newWords;
                    });
                    
                    showAlert(`üóëÔ∏è '${wordKey}' Îã®Ïñ¥Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'info');
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !isAnswerSubmitted) {
                    if (quizType === 'both') {
                        // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏóêÏÑúÎäî Îëò Îã§ ÏûÖÎ†•ÌñàÏùÑ ÎïåÎßå Ï≤¥ÌÅ¨
                        if (userKoreanAnswer.trim() && userHiraganaAnswer.trim()) {
                            checkAnswer();
                        }
                    } else {
                        checkAnswer();
                    }
                }
            };

            const handleBothQuizKeyPress = (e, type) => {
                if (e.key === 'Enter' && !isAnswerSubmitted) {
                    if (type === 'korean' && userKoreanAnswer.trim() && userHiraganaAnswer.trim()) {
                        checkAnswer();
                    } else if (type === 'hiragana' && userKoreanAnswer.trim() && userHiraganaAnswer.trim()) {
                        checkAnswer();
                    }
                }
            };

            return (
                <div className="app">
                    {/* Ïª§Ïä§ÌÖÄ ÏïåÎ¶º ÌåùÏóÖ - ÎîîÎ≤ÑÍπÖ */}
                    {console.log('Î†åÎçîÎßÅ Ïãú ÏïåÎ¶º ÏÉÅÌÉú:', { showNotification, notificationMessage, notificationType })}
                    {showNotification && (
                        <div className={`notification ${notificationType}`}>
                            <span>{notificationMessage}</span>
                            <button 
                                className="notification-close"
                                onClick={() => {
                                    console.log('ÏïåÎ¶º ÏàòÎèô Îã´Í∏∞');
                                    setShowNotification(false);
                                }}
                            >
                                √ó
                            </button>
                        </div>
                    )}

                    <header className="header">
                        <div className="logo">
                            üóæ ÏùºÎ≥∏Ïñ¥ Îã®Ïñ¥ Í≥µÎ∂Ä
                        </div>
                        
                        {/* Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ ÏÑ†ÌÉù */}
                        <div style={{ 
                            display: 'flex', 
                            alignItems: 'center', 
                            gap: '1rem',
                            background: 'rgba(255, 255, 255, 0.1)',
                            padding: '0.5rem 1rem',
                            borderRadius: '15px',
                            border: '1px solid rgba(255, 255, 255, 0.2)'
                        }}>
                            <select
                                value={currentSetId}
                                onChange={(e) => switchToSet(e.target.value)}
                                style={{
                                    background: 'rgba(255, 255, 255, 0.9)',
                                    border: '1px solid rgba(255, 255, 255, 0.3)',
                                    borderRadius: '8px',
                                    padding: '0.3rem 0.8rem',
                                    fontSize: '0.9rem',
                                    color: '#2c3e50',
                                    fontWeight: '500'
                                }}
                            >
                                {Object.entries(setNames).map(([setId, setName]) => (
                                    <option key={setId} value={setId}>
                                        üìö {setName} ({Object.keys(wordSets[setId] || {}).length}Í∞ú)
                                    </option>
                                ))}
                            </select>
                            <button
                                onClick={createNewSet}
                                style={{
                                    background: 'rgba(46, 204, 113, 0.8)',
                                    border: 'none',
                                    color: 'white',
                                    padding: '0.3rem 0.8rem',
                                    borderRadius: '8px',
                                    fontSize: '0.8rem',
                                    fontWeight: '500',
                                    cursor: 'pointer',
                                    transition: 'all 0.3s ease'
                                }}
                                onMouseEnter={(e) => e.target.style.background = 'rgba(46, 204, 113, 1)'}
                                onMouseLeave={(e) => e.target.style.background = 'rgba(46, 204, 113, 0.8)'}
                                title="ÏÉà Îã®Ïñ¥Ïû• ÎßåÎì§Í∏∞"
                            >
                                ‚ûï ÏÉà ÏÑ∏Ìä∏
                            </button>
                            {currentSetId !== 'default' && (
                                <button
                                    onClick={() => deleteSet(currentSetId)}
                                    style={{
                                        background: 'rgba(231, 76, 60, 0.8)',
                                        border: 'none',
                                        color: 'white',
                                        padding: '0.3rem 0.8rem',
                                        borderRadius: '8px',
                                        fontSize: '0.8rem',
                                        fontWeight: '500',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease'
                                    }}
                                    onMouseEnter={(e) => e.target.style.background = 'rgba(231, 76, 60, 1)'}
                                    onMouseLeave={(e) => e.target.style.background = 'rgba(231, 76, 60, 0.8)'}
                                    title="ÌòÑÏû¨ Îã®Ïñ¥Ïû• ÏÇ≠Ï†ú"
                                >
                                    üóëÔ∏è
                                </button>
                            )}
                        </div>

                        <nav className="nav">
                            <button 
                                className={`nav-btn ${currentTab === 'quiz' ? 'active' : ''}`}
                                onClick={() => setCurrentTab('quiz')}
                            >
                                üìù ÌÄ¥Ï¶à
                            </button>
                            <button 
                                className={`nav-btn ${currentTab === 'words' ? 'active' : ''}`}
                                onClick={() => setCurrentTab('words')}
                            >
                                üìö Îã®Ïñ¥Ïû•
                            </button>
                            <button 
                                className={`nav-btn ${currentTab === 'add' ? 'active' : ''}`}
                                onClick={() => setCurrentTab('add')}
                            >
                                ‚ûï Îã®Ïñ¥ Ï∂îÍ∞Ä
                            </button>
                            <button
                                className={`nav-btn ${currentTab === 'data' ? 'active' : ''}`}
                                onClick={() => setCurrentTab('data')}
                            >
                                üíæ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨
                            </button>
                            <button
                                className={`nav-btn ${currentTab === 'kanji' ? 'active' : ''}`}
                                onClick={() => setCurrentTab('kanji')}
                            >
                                üîç ÌïúÏûê Î∞úÏùå
                            </button>
                        </nav>
                    </header>

                    <main className="main">
                        <div className="container">
                            {currentTab === 'quiz' && (
                                <div className="card fade-in">
                                    <div className="score">
                                        Ï†êÏàò: {score}/{totalQuestions}
                                        {quizStarted && !quizCompleted && (
                                            <>
                                                <div style={{ fontSize: '0.9rem', color: '#7f8c8d', marginTop: '0.5rem' }}>
                                                    {quizMode === 'favorites' ? '‚≠ê ÌëúÏãúÎêú Îã®Ïñ¥' : 'üìö Ï†ÑÏ≤¥ Îã®Ïñ¥'} {quizType === 'hiragana' ? 'üà∂ ÌûàÎùºÍ∞ÄÎÇò' : quizType === 'both' ? 'üíØ Îëò Îã§ ÎßûÏ∂îÍ∏∞' : quizType === 'japanese' ? 'üóæ ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'üá∞üá∑ ÌïúÍµ≠Ïñ¥'} - 
                                                    ÏßÑÌñâÎ•†: {usedWords.size}/{Object.keys(getQuizTargetWords()).length} Î¨∏Ï†ú ÏôÑÎ£å
                                                </div>
                                                {currentWord && words[currentWord] && words[currentWord].kanji && words[currentWord].kanji !== currentWord && (
                                                    <div style={{ fontSize: '0.8rem', color: '#3498db', marginTop: '0.3rem' }}>
                                                        üí° Ïö∞Ï∏° ÏÉÅÎã® {hideHiragana ? 'üëÅÔ∏è' : 'üôà'} Î≤ÑÌäºÏúºÎ°ú ÌûàÎùºÍ∞ÄÎÇòÎ•º Í∞ÄÎ¶¨Í±∞ÎÇò Î≥º Ïàò ÏûàÏñ¥Ïöî!
                                                    </div>
                                                )}
                                            </>
                                        )}
                                    </div>
                                    
                                    {!quizStarted || quizCompleted ? (
                                        <div style={{ textAlign: 'center' }}>
                                            <h2 style={{ marginBottom: '2rem', color: '#2c3e50' }}>
                                                {quizCompleted ? 
                                                    `üéâ ${quizMode === 'favorites' ? 'ÌëúÏãúÎêú Îã®Ïñ¥' : 'Ï†ÑÏ≤¥ Îã®Ïñ¥'} ${quizType === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò' : quizType === 'both' ? 'Îëò Îã§ ÎßûÏ∂îÍ∏∞' : quizType === 'japanese' ? 'ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'ÌïúÍµ≠Ïñ¥'} ÌÄ¥Ï¶à ÏôÑÎ£å! Îã§Ïãú ÎèÑÏ†ÑÌï¥Î≥¥ÏÑ∏Ïöî!` : 
                                                    'ÏùºÎ≥∏Ïñ¥ Îã®Ïñ¥ ÌÄ¥Ï¶àÎ•º ÏãúÏûëÌï¥Î≥¥ÏÑ∏Ïöî! üéå'
                                                }
                                            </h2>
                                            {/* ÍπîÎÅîÌïú 2Îã®Í≥Ñ ÌÄ¥Ï¶à ÏÑ†ÌÉù UI */}
                                            <div style={{ background: 'rgba(52, 152, 219, 0.05)', padding: '2rem', borderRadius: '16px', border: '1px solid rgba(52, 152, 219, 0.2)' }}>
                                                {/* 1Îã®Í≥Ñ: ÌÄ¥Ï¶à Î≤îÏúÑ ÏÑ†ÌÉù */}
                                                <div style={{ marginBottom: '2rem' }}>
                                                    <h3 style={{ color: '#2c3e50', marginBottom: '1rem', fontSize: '1.1rem' }}>üìù ÌÄ¥Ï¶à Î≤îÏúÑ</h3>
                                                    <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap', justifyContent: 'center' }}>
                                                        <button 
                                                            className={`btn ${selectedRange === 'all' ? 'btn-primary' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedRange('all')}
                                                            style={{ 
                                                                minWidth: '180px',
                                                                background: selectedRange === 'all' ? '#3498db' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1.2rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease'
                                                            }}
                                                        >
                                                            üìö Ï†ÑÏ≤¥ Îã®Ïñ¥ ({Object.keys(words).length}Í∞ú)
                                                        </button>
                                                        <button 
                                                            className={`btn ${selectedRange === 'favorites' ? 'btn-primary' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedRange('favorites')}
                                                            disabled={Object.keys(getCurrentSetFavorites()).length === 0}
                                                            style={{ 
                                                                minWidth: '180px',
                                                                background: selectedRange === 'favorites' ? '#3498db' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1.2rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease',
                                                                opacity: Object.keys(getCurrentSetFavorites()).length === 0 ? 0.5 : 1
                                                            }}
                                                        >
                                                            ‚≠ê ÌëúÏãúÎêú Îã®Ïñ¥Îßå ({Object.keys(getCurrentSetFavorites()).length}Í∞ú)
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* 2Îã®Í≥Ñ: ÌÄ¥Ï¶à ÌÉÄÏûÖ ÏÑ†ÌÉù */}
                                                <div style={{ marginBottom: '2rem' }}>
                                                    <h3 style={{ color: '#2c3e50', marginBottom: '1rem', fontSize: '1.1rem' }}>üéØ ÌÄ¥Ï¶à ÌÉÄÏûÖ</h3>
                                                    <div style={{ display: 'flex', gap: '1rem', flexWrap: 'wrap', justifyContent: 'center' }}>
                                                        <button 
                                                            className={`btn ${selectedType === 'korean' ? 'btn-success' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedType('korean')}
                                                            style={{ 
                                                                minWidth: '150px',
                                                                background: selectedType === 'korean' ? '#27ae60' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease'
                                                            }}
                                                        >
                                                            üá∞üá∑ ÌïúÍµ≠Ïñ¥ Îúª
                                                        </button>
                                                        <button 
                                                            className={`btn ${selectedType === 'hiragana' ? 'btn-success' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedType('hiragana')}
                                                            disabled={(() => {
                                                                const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                return countHiraganaWords(targetWords) === 0;
                                                            })()}
                                                            style={{ 
                                                                minWidth: '150px',
                                                                background: selectedType === 'hiragana' ? '#27ae60' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease',
                                                                opacity: (() => {
                                                                    const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                    return countHiraganaWords(targetWords) === 0 ? 0.5 : 1;
                                                                })()
                                                            }}
                                                        >
                                                            üà∂ ÌûàÎùºÍ∞ÄÎÇò
                                                        </button>
                                                        <button 
                                                            className={`btn ${selectedType === 'both' ? 'btn-success' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedType('both')}
                                                            disabled={(() => {
                                                                const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                return countHiraganaWords(targetWords) === 0;
                                                            })()}
                                                            style={{ 
                                                                minWidth: '150px',
                                                                background: selectedType === 'both' ? '#27ae60' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease',
                                                                opacity: (() => {
                                                                    const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                    return countHiraganaWords(targetWords) === 0 ? 0.5 : 1;
                                                                })()
                                                            }}
                                                        >
                                                            üíØ Îëò Îã§ ÎßûÏ∂îÍ∏∞
                                                        </button>
                                                        <button 
                                                            className={`btn ${selectedType === 'japanese' ? 'btn-success' : 'btn-secondary'}`}
                                                            onClick={() => setSelectedType('japanese')}
                                                            style={{ 
                                                                minWidth: '150px',
                                                                background: selectedType === 'japanese' ? '#27ae60' : '#bdc3c7',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                padding: '0.8rem 1rem',
                                                                fontWeight: '600',
                                                                transition: 'all 0.2s ease'
                                                            }}
                                                        >
                                                            üóæ ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞
                                                        </button>
                                                    </div>
                                                </div>

                                                {/* 3Îã®Í≥Ñ: ÌÄ¥Ï¶à ÏãúÏûë Î≤ÑÌäº */}
                                                <div style={{ textAlign: 'center' }}>
                                                    <button 
                                                        className="btn btn-primary"
                                                        onClick={() => startQuiz(selectedRange, selectedType)}
                                                        style={{ 
                                                            background: 'linear-gradient(45deg, #e74c3c, #c0392b)',
                                                            border: 'none',
                                                            padding: '1rem 2rem',
                                                            fontSize: '1.1rem',
                                                            fontWeight: 'bold',
                                                            minWidth: '200px'
                                                        }}
                                                        disabled={(() => {
                                                            if (selectedType === 'hiragana' || selectedType === 'both') {
                                                                const targetWords = selectedRange === 'favorites' ? getCurrentSetFavorites() : words;
                                                                return countHiraganaWords(targetWords) === 0;
                                                            }
                                                            if (selectedRange === 'favorites') {
                                                                return Object.keys(getCurrentSetFavorites()).length === 0;
                                                            }
                                                            return Object.keys(words).length === 0;
                                                        })()}
                                                    >
                                                        üöÄ ÌÄ¥Ï¶à ÏãúÏûëÌïòÍ∏∞
                                                    </button>
                                                </div>
                                                {quizCompleted && (
                                                    <div style={{ marginTop: '1rem', display: 'flex', gap: '1rem', flexWrap: 'wrap', justifyContent: 'center' }}>
                                                        <button 
                                                        className="btn btn-success" 
                                                        onClick={() => {
                                                            const targetWords = getQuizTargetWords();
                                                            const accuracy = totalQuestions > 0 ? Math.round((score / totalQuestions) * 100) : 0;
                                                            const modeText = quizMode === 'favorites' ? 'ÌëúÏãúÎêú Îã®Ïñ¥' : 'Ï†ÑÏ≤¥ Îã®Ïñ¥';
                                                            const typeText = quizType === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò' : quizType === 'both' ? 'Îëò Îã§ ÎßûÏ∂îÍ∏∞' : quizType === 'japanese' ? 'ÏùºÎ≥∏Ïñ¥Î°ú Ïì∞Í∏∞' : 'ÌïúÍµ≠Ïñ¥';
                                                            const scoreText = quizType === 'both' ? `Ï†êÏàò: ${score}Ï†ê` : `Ï†ïÎãµÏàò: ${score}Í∞ú`;
                                                            showCustomPopup(
                                                                `üìä ${modeText} ${typeText} ÌÄ¥Ï¶à ÏµúÏ¢Ö Í≤∞Í≥º\n\nÏ¥ù Î¨∏Ï†úÏàò: ${Object.keys(targetWords).length}Í∞ú\n${scoreText}\nÏò§ÎãµÏàò: ${totalQuestions - score}Í∞ú\nÏ†ïÎãµÎ•†: ${accuracy}%\n\n${accuracy >= 90 ? 'üèÜ ÏôÑÎ≤ΩÌï©ÎãàÎã§!' : accuracy >= 70 ? 'üëç ÏûòÌñàÏñ¥Ïöî!' : 'üí™ Îçî Ïó∞ÏäµÌï¥Î≥¥ÏÑ∏Ïöî!'}`,
                                                                'ÏµúÏ¢Ö Ï†êÏàò',
                                                                'info'
                                                            );
                                                        }}
                                                    >
                                                        üìä Í≤∞Í≥º Î≥¥Í∏∞
                                                    </button>
                                                    {wrongAnswers.length > 0 && (
                                                        <button 
                                                            className="btn btn-warning" 
                                                            onClick={() => {
                                                                setCurrentTab('words');
                                                                setShowWrongAnswers(true);
                                                            }}
                                                        >
                                                            ‚ùå ÌãÄÎ¶∞ Î¨∏Ï†ú ÌôïÏù∏ÌïòÍ∏∞ ({wrongAnswers.length}Í∞ú)
                                                        </button>
                                                    )}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            {currentWord && (
                                                <div className="quiz-word">
                                                    {quizType === 'japanese' ? (
                                                        // ÏùºÎ≥∏Ïñ¥ ÌÄ¥Ï¶à: ÌïúÍµ≠Ïñ¥ ÎúªÏùÑ Î¨∏Ï†úÎ°ú ÌëúÏãú
                                                        <div className="korean-question" style={{ 
                                                            fontSize: '2rem', 
                                                            fontWeight: 'bold', 
                                                            color: '#2c3e50',
                                                            textAlign: 'center',
                                                            padding: '2rem'
                                                        }}>
                                                            {words[currentWord] && words[currentWord].korean}
                                                            <div style={{ 
                                                                fontSize: '1rem', 
                                                                color: '#7f8c8d', 
                                                                marginTop: '1rem',
                                                                fontWeight: 'normal'
                                                            }}>
                                                                üëá Ïù¥ ÎúªÏóê Ìï¥ÎãπÌïòÎäî ÏùºÎ≥∏Ïñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        // Í∏∞Ï°¥ ÌÄ¥Ï¶àÎì§: ÏùºÎ≥∏Ïñ¥Î•º Î¨∏Ï†úÎ°ú ÌëúÏãú
                                                        <>
                                                            {words[currentWord] && words[currentWord].kanji && (
                                                                <div className="kanji">{words[currentWord].kanji}</div>
                                                            )}
                                                            <div className="hiragana-container">
                                                                <div className={`hiragana ${hideHiragana ? 'hiragana-hidden' : ''}`}>
                                                                    {currentWord}
                                                                </div>
                                                                {hideHiragana && (
                                                                    <div className="hiragana-overlay">
                                                                        üëÅÔ∏èÌûàÎùºÍ∞ÄÎÇò Î≥¥Í∏∞
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </>
                                                    )}
                                                    {/* ÌïúÏûêÍ∞Ä ÏûàÏùÑ ÎïåÎßå ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶º Î≤ÑÌäº ÌëúÏãú (japanese ÌÄ¥Ï¶àÏóêÏÑúÎäî Ï†úÏô∏) */}
                                                    {quizType !== 'japanese' && words[currentWord] && words[currentWord].kanji && words[currentWord].kanji !== currentWord && (
                                                        <button 
                                                            className="hiragana-toggle-btn"
                                                            onClick={() => setHideHiragana(!hideHiragana)}
                                                            title={hideHiragana ? "ÌûàÎùºÍ∞ÄÎÇò Î≥¥Í∏∞" : "ÌûàÎùºÍ∞ÄÎÇò Í∞ÄÎ¶¨Í∏∞"}
                                                        >
                                                            {hideHiragana ? 'üëÅÔ∏è' : 'üôà'}
                                                        </button>
                                                    )}
                                                    
                                                    {/* Ï¶êÍ≤®Ï∞æÍ∏∞/ÌëúÏãú Î≤ÑÌäº */}
                                                    <button 
                                                        className={`quiz-favorite-btn ${getCurrentSetFavorites()[currentWord] ? 'favorited' : ''}`}
                                                        onClick={() => toggleWordFavorite(currentWord)}
                                                        title={getCurrentSetFavorites()[currentWord] ? "ÌëúÏãú Ìï¥Ï†ú" : "ÌëúÏãú Ï∂îÍ∞Ä"}
                                                        style={{
                                                            background: getCurrentSetFavorites()[currentWord] ? 
                                                                'linear-gradient(45deg, #f39c12, #e67e22)' : 
                                                                'rgba(189, 195, 199, 0.8)'
                                                        }}
                                                        onMouseEnter={(e) => {
                                                            if (getCurrentSetFavorites()[currentWord]) {
                                                                e.target.style.background = 'linear-gradient(45deg, #e67e22, #d35400)';
                                                            } else {
                                                                e.target.style.background = 'rgba(149, 165, 166, 0.9)';
                                                            }
                                                        }}
                                                        onMouseLeave={(e) => {
                                                            if (getCurrentSetFavorites()[currentWord]) {
                                                                e.target.style.background = 'linear-gradient(45deg, #f39c12, #e67e22)';
                                                            } else {
                                                                e.target.style.background = 'rgba(189, 195, 199, 0.8)';
                                                            }
                                                        }}
                                                    >
                                                        {getCurrentSetFavorites()[currentWord] ? '‚≠ê' : '‚òÜ'}
                                                    </button>
                                                </div>
                                            )}
                                            
                                            {quizType === 'both' ? (
                                                // Îëò Îã§ ÎßûÏ∂îÍ∏∞ ÌÄ¥Ï¶àÏö© UI
                                                <div>
                                                    <div className="input-group" style={{ marginBottom: '1.5rem' }}>
                                                        <label className="input-label">ÌïúÍµ≠Ïñ¥ Îúª:</label>
                                                        <input
                                                            type="text"
                                                            className="input-field"
                                                            value={userKoreanAnswer}
                                                            onChange={(e) => setUserKoreanAnswer(e.target.value)}
                                                            onKeyPress={(e) => handleBothQuizKeyPress(e, 'korean')}
                                                            placeholder="ÌïúÍµ≠Ïñ¥ ÎúªÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Ïòà: ÌïôÍµê)"
                                                            style={{
                                                                border: bothQuizResult.korean === true ? '2px solid #27ae60' :
                                                                       bothQuizResult.korean === false ? '2px solid #e74c3c' :
                                                                       '1px solid #bdc3c7'
                                                            }}
                                                        />
                                                        {bothQuizResult.korean === true && (
                                                            <div style={{ color: '#27ae60', fontSize: '0.8rem', marginTop: '0.3rem' }}>
                                                                ‚úÖ ÌïúÍµ≠Ïñ¥ Ï†ïÎãµ!
                                                            </div>
                                                        )}
                                                        {bothQuizResult.korean === false && (
                                                            <div style={{ color: '#e74c3c', fontSize: '0.8rem', marginTop: '0.3rem' }}>
                                                                ‚ùå ÌïúÍµ≠Ïñ¥ Ïò§Îãµ
                                                            </div>
                                                        )}
                                                    </div>
                                                    
                                                    <div className="input-group">
                                                        <label className="input-label">ÌûàÎùºÍ∞ÄÎÇò:</label>
                                                        <input
                                                            type="text"
                                                            className="input-field"
                                                            value={userHiraganaAnswer}
                                                            onChange={(e) => setUserHiraganaAnswer(e.target.value)}
                                                            onKeyPress={(e) => handleBothQuizKeyPress(e, 'hiragana')}
                                                            placeholder="ÌûàÎùºÍ∞ÄÎÇòÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (ÌïúÍ∏ÄÎ°úÎèÑ Í∞ÄÎä•)"
                                                            style={{
                                                                border: bothQuizResult.hiragana === true ? '2px solid #27ae60' :
                                                                       bothQuizResult.hiragana === false ? '2px solid #e74c3c' :
                                                                       '1px solid #bdc3c7'
                                                            }}
                                                        />
                                                        {convertedHiraganaAnswer && userHiraganaAnswer && (
                                                            <div style={{
                                                                marginTop: '0.5rem',
                                                                padding: '0.5rem',
                                                                background: 'rgba(46, 204, 113, 0.1)',
                                                                borderRadius: '8px',
                                                                border: '1px solid rgba(46, 204, 113, 0.3)',
                                                                fontSize: '0.9rem',
                                                                color: '#27ae60'
                                                            }}>
                                                                üîÑ ÌïúÍ∏Ä ‚Üí ÌûàÎùºÍ∞ÄÎÇò Î≥ÄÌôò: <strong>{convertedHiraganaAnswer}</strong>
                                                            </div>
                                                        )}
                                                        {bothQuizResult.hiragana === true && (
                                                            <div style={{ color: '#27ae60', fontSize: '0.8rem', marginTop: '0.3rem' }}>
                                                                ‚úÖ ÌûàÎùºÍ∞ÄÎÇò Ï†ïÎãµ!
                                                            </div>
                                                        )}
                                                        {bothQuizResult.hiragana === false && (
                                                            <div style={{ color: '#e74c3c', fontSize: '0.8rem', marginTop: '0.3rem' }}>
                                                                ‚ùå ÌûàÎùºÍ∞ÄÎÇò Ïò§Îãµ
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            ) : (
                                                // Í∏∞Ï°¥ Îã®Ïùº ÎãµÏïà ÌÄ¥Ï¶àÏö© UI
                                                <div className="input-group">
                                                    <label className="input-label">
                                                        {quizType === 'hiragana' ? 'ÌûàÎùºÍ∞ÄÎÇò:' : 'ÌïúÍµ≠Ïñ¥ Îúª:'}
                                                    </label>
                                                    <input
                                                        type="text"
                                                        className="input-field"
                                                        value={userAnswer}
                                                        onChange={(e) => {
                                                            setUserAnswer(e.target.value);
                                                            // ÌûàÎùºÍ∞ÄÎÇò/ÏùºÎ≥∏Ïñ¥ ÌÄ¥Ï¶àÏùº Îïå Ïã§ÏãúÍ∞Ñ Î≥ÄÌôò ÌëúÏãú
                                                            if (quizType === 'hiragana' || quizType === 'japanese') {
                                                                const converted = convertHangulToHiragana(e.target.value);
                                                                setConvertedQuizAnswer(converted);
                                                            }
                                                        }}
                                                        onKeyPress={handleKeyPress}
                                                        placeholder={
                                                            quizType === 'hiragana' ? "ÌûàÎùºÍ∞ÄÎÇòÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (ÌïúÍ∏ÄÎ°úÎèÑ Í∞ÄÎä•)" : 
                                                            quizType === 'japanese' ? "ÏùºÎ≥∏Ïñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (ÌïúÍ∏ÄÎ°úÎèÑ Í∞ÄÎä•)" :
                                                            "ÌïúÍµ≠Ïñ¥ ÎúªÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Ïòà: Î®πÎã§)"
                                                        }
                                                    />
                                                    {(quizType === 'hiragana' || quizType === 'japanese') && (
                                                        <div style={{
                                                            marginTop: '0.5rem',
                                                            padding: '0.5rem',
                                                            background: 'rgba(46, 204, 113, 0.1)',
                                                            borderRadius: '8px',
                                                            border: '1px solid rgba(46, 204, 113, 0.3)',
                                                            fontSize: '0.9rem',
                                                            color: '#27ae60'
                                                        }}>
                                                            <div style={{ fontSize: '0.8rem', color: '#666', marginBottom: '0.5rem' }}>
                                                                üí° ÌïúÍ∏ÄÎ°ú ÏûÖÎ†•Ìï¥ÎèÑ ÏûêÎèôÏúºÎ°ú ÌûàÎùºÍ∞ÄÎÇòÎ°ú Î≥ÄÌôòÎêòÏñ¥ Ï±ÑÏ†êÎê©ÎãàÎã§!
                                                            </div>
                                                            <div>
                                                                üîÑ ÌïúÍ∏Ä ‚Üí ÌûàÎùºÍ∞ÄÎÇò Î≥ÄÌôò: <strong>
                                                                    {userAnswer ? convertHangulToHiragana(userAnswer) || userAnswer : '(ÏûÖÎ†•ÌïòÎ©¥ Ïó¨Í∏∞Ïóê Î≥ÄÌôò Í≤∞Í≥ºÍ∞Ä ÌëúÏãúÎê©ÎãàÎã§)'}
                                                                </strong>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            {result && (
                                                <div className={`result ${result.type}`}>
                                                    {result.message}
                                                </div>
                                            )}

                                            <div className="btn-group">
                                                <button 
                                                    className="btn btn-success" 
                                                    onClick={checkAnswer}
                                                    disabled={isAnswerSubmitted || (quizType === 'both' && (!userKoreanAnswer.trim() || !userHiraganaAnswer.trim()))}
                                                    title={isAnswerSubmitted ? 'Ïù¥ÎØ∏ ÎãµÏïàÏù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§' : 
                                                           (quizType === 'both' && (!userKoreanAnswer.trim() || !userHiraganaAnswer.trim()) ? 
                                                           'ÌïúÍµ≠Ïñ¥ÏôÄ ÌûàÎùºÍ∞ÄÎÇòÎ•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî' : '')}
                                                >
                                                    {quizType === 'both' ? 'Îëò Îã§ Ï†ïÎãµ ÌôïÏù∏' : 'Ï†ïÎãµ ÌôïÏù∏'}
                                                </button>
                                                <button 
                                                    className="btn btn-warning" 
                                                    onClick={nextQuestion}
                                                    disabled={isLoadingNextQuestion}
                                                >
                                                    {isLoadingNextQuestion ? '‚è≥ Î°úÎî©Ï§ë...' : 'Îã§Ïùå Î¨∏Ï†ú'}
                                                </button>
                                                <button 
                                                    className="btn btn-danger" 
                                                    onClick={async () => {
                                                        const confirmed = await showCustomPopup(
                                                            'ÌÄ¥Ï¶àÎ•º Ï§ëÎã®ÌïòÍ≥† Ï≤òÏùåÎ∂ÄÌÑ∞ Îã§Ïãú ÏãúÏûëÌïòÏãúÍ≤†ÏäµÎãàÍπå?', 
                                                            'ÌÄ¥Ï¶à Ïû¨ÏãúÏûë', 
                                                            'warning', 
                                                            true
                                                        );
                                                        if (confirmed) {
                                                            startQuiz(quizMode, quizType);
                                                        }
                                                    }}
                                                >
                                                    üîÑ Ïû¨ÏãúÏûë
                                                </button>
                                            </div>
                                        </>
                                    )}
                                </div>
                            )}

                            {currentTab === 'words' && (
                                <div className="card fade-in">
                                    {showWrongAnswers ? (
                                        <>
                                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '2rem' }}>
                                                <h2 style={{ color: '#2c3e50', margin: 0 }}>
                                                    ‚ùå ÌãÄÎ¶∞ Î¨∏Ï†ú Î≥µÏäµ ({wrongAnswers.length}Í∞ú)
                                                </h2>
                                                <div style={{ display: 'flex', gap: '0.5rem' }}>
                                                    <button
                                                        className="btn btn-primary"
                                                        onClick={() => {
                                                            // Î™®Îì† ÌãÄÎ¶∞ Î¨∏Ï†úÎì§ÏùÑ Î∂ÅÎßàÌÅ¨Ïóê Ï∂îÍ∞Ä
                                                            const currentFavorites = getCurrentSetFavorites();
                                                            let addedCount = 0;

                                                            // Ìïú Î≤àÏóê Î™®Îì† Îã®Ïñ¥Î•º Ï∂îÍ∞ÄÌïòÍ∏∞ ÏúÑÌïú ÏÉàÎ°úÏö¥ favoriteWords Í∞ùÏ≤¥ ÏÉùÏÑ±
                                                            const updatedCurrentSetFavorites = { ...currentFavorites };

                                                            wrongAnswers.forEach(wrongItem => {
                                                                const wordKey = wrongItem.hiragana || wrongItem.question;
                                                                if (wordKey && !currentFavorites[wordKey]) {
                                                                    updatedCurrentSetFavorites[wordKey] = true;
                                                                    addedCount++;
                                                                }
                                                            });

                                                            // Ìïú Î≤àÏóê Î™®Îì† Î≥ÄÍ≤ΩÏÇ¨Ìï≠ÏùÑ Î∞òÏòÅ
                                                            if (addedCount > 0) {
                                                                const updatedFavorites = {
                                                                    ...favoriteWords,
                                                                    [currentSetId]: updatedCurrentSetFavorites
                                                                };

                                                                setFavoriteWords(updatedFavorites);
                                                                saveFavoriteWords(updatedFavorites);

                                                                // ÏÉÅÌÉú Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏúÑÌï¥ ÏûëÏùÄ ÏßÄÏó∞ ÌõÑ Ïû¨Î†åÎçîÎßÅ Ìä∏Î¶¨Í±∞
                                                                setTimeout(() => {
                                                                    setShowWrongAnswers(false);
                                                                    setShowWrongAnswers(true);
                                                                }, 100);

                                                                showCustomPopup(
                                                                    `‚≠ê ${addedCount}Í∞úÏùò ÌãÄÎ¶∞ Î¨∏Ï†úÍ∞Ä Î∂ÅÎßàÌÅ¨Ïóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!`,
                                                                    'Î∂ÅÎßàÌÅ¨ Ï∂îÍ∞Ä ÏôÑÎ£å'
                                                                );
                                                            } else {
                                                                showCustomPopup(
                                                                    'Î™®Îì† ÌãÄÎ¶∞ Î¨∏Ï†úÍ∞Ä Ïù¥ÎØ∏ Î∂ÅÎßàÌÅ¨ÎêòÏñ¥ ÏûàÏäµÎãàÎã§!',
                                                                    'ÏïåÎ¶º'
                                                                );
                                                            }
                                                        }}
                                                    >
                                                        ‚≠ê Ï†ÑÏ≤¥ ÌëúÏãúÌïòÍ∏∞
                                                    </button>
                                                    <button
                                                        className="btn btn-secondary"
                                                        onClick={() => {
                                                            setShowWrongAnswers(false);
                                                            setWrongAnswerFavorites({});
                                                        }}
                                                    >
                                                        ÎèåÏïÑÍ∞ÄÍ∏∞
                                                    </button>
                                                </div>
                                            </div>
                                            <div style={{
                                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                                padding: '1rem',
                                                borderRadius: '8px',
                                                border: '1px solid rgba(231, 76, 60, 0.3)',
                                                marginBottom: '2rem',
                                                fontSize: '0.9rem',
                                                color: '#c0392b'
                                            }}>
                                                üí° ÌãÄÎ¶∞ Î¨∏Ï†úÎì§ÏùÑ Îã§Ïãú ÌïôÏäµÌï¥Î≥¥ÏÑ∏Ïöî. ‚≠ê Î≤ÑÌäºÏùÑ ÎàåÎü¨ Ï§ëÏöîÌïú Î¨∏Ï†úÎ•º ÌëúÏãúÌï† Ïàò ÏûàÏäµÎãàÎã§.
                                            </div>
                                        </>
                                    ) : (
                                        <h2 style={{ marginBottom: '2rem', color: '#2c3e50' }}>
                                            üìö {setNames[currentSetId]} ({Object.keys(words).length}Í∞ú Îã®Ïñ¥)
                                        </h2>
                                    )}
                                    <div style={{ 
                                        fontSize: '0.9rem', 
                                        color: '#27ae60', 
                                        marginBottom: '1rem', 
                                        padding: '0.8rem',
                                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                                        borderRadius: '8px',
                                        border: '1px solid rgba(46, 204, 113, 0.3)'
                                    }}>
                                        üíæ ÌòÑÏû¨ '{setNames[currentSetId]}' Îã®Ïñ¥Ïû•Ïù¥ ÏÑ†ÌÉùÎêòÏñ¥ ÏûàÏäµÎãàÎã§. Î™®Îì† ÏÑ∏Ìä∏Îäî Î∏åÎùºÏö∞Ï†ÄÏóê ÏûêÎèô Ï†ÄÏû•Îê©ÎãàÎã§!
                                    </div>
                                    
                                    {!showWrongAnswers && (
                                        <div>
                                        {/* Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ Ïª®Ìä∏Î°§ */}
                                        <div style={{
                                            marginBottom: '1rem',
                                            padding: '1rem',
                                            background: 'rgba(52, 152, 219, 0.1)',
                                            borderRadius: '8px',
                                            border: '1px solid rgba(52, 152, 219, 0.3)'
                                        }}>
                                            {/* Í≤ÄÏÉâ ÏûÖÎ†• ÌïÑÎìú */}
                                            <div style={{ marginBottom: '1rem' }}>
                                                <div style={{ 
                                                    display: 'flex', 
                                                    alignItems: 'center', 
                                                    gap: '0.5rem',
                                                    marginBottom: '0.5rem'
                                                }}>
                                                    <span style={{ fontSize: '0.9rem', color: '#2c3e50', fontWeight: 'bold' }}>
                                                        üîç Îã®Ïñ¥ Í≤ÄÏÉâ
                                                    </span>
                                                    {searchQuery && (
                                                        <span style={{ fontSize: '0.8rem', color: '#e74c3c' }}>
                                                            ({Object.keys(getFilteredWords()).length}Í∞ú Í≤∞Í≥º)
                                                        </span>
                                                    )}
                                                </div>
                                                <input
                                                    type="text"
                                                    value={searchQuery}
                                                    onChange={(e) => setSearchQuery(e.target.value)}
                                                    placeholder="ÌûàÎùºÍ∞ÄÎÇò, ÌïúÏûê, ÌïúÍµ≠Ïñ¥ Îúª, Î∞úÏùåÏúºÎ°ú Í≤ÄÏÉâ... (Ïòà: ÌïôÍµê, „Åå„Å£„Åì„ÅÜ, Â≠¶Ê†°, Í∞ìÏΩîÏö∞)"
                                                    style={{
                                                        width: '100%',
                                                        padding: '0.7rem',
                                                        fontSize: '0.9rem',
                                                        border: '1px solid #ddd',
                                                        borderRadius: '6px',
                                                        backgroundColor: 'white'
                                                    }}
                                                />
                                                {searchQuery && (
                                                    <button
                                                        onClick={() => setSearchQuery('')}
                                                        style={{
                                                            position: 'absolute',
                                                            right: '1.5rem',
                                                            marginTop: '-2.2rem',
                                                            background: 'none',
                                                            border: 'none',
                                                            fontSize: '1.2rem',
                                                            color: '#e74c3c',
                                                            cursor: 'pointer'
                                                        }}
                                                        title="Í≤ÄÏÉâÏñ¥ ÏßÄÏö∞Í∏∞"
                                                    >
                                                        ‚úï
                                                    </button>
                                                )}
                                            </div>
                                            
                                            {/* ÌÜµÍ≥Ñ Î∞è ÌïÑÌÑ∞ Î≤ÑÌäº */}
                                            <div style={{
                                                display: 'flex',
                                                justifyContent: 'space-between',
                                                alignItems: 'center'
                                            }}>
                                                <div style={{ fontSize: '0.9rem', color: '#2c3e50' }}>
                                                    üìä Ï†ÑÏ≤¥ ÏÑ∏Ìä∏: {Object.keys(setNames).length}Í∞ú |
                                                    Ï†ÑÏ≤¥ Îã®Ïñ¥: {Object.values(wordSets).reduce((total, set) => total + Object.keys(set).length, 0)}Í∞ú |
                                                    ÌëúÏãúÎêú Îã®Ïñ¥: {Object.keys(getCurrentSetFavorites()).length}Í∞ú
                                                    {searchQuery && ` | Í≤ÄÏÉâ Í≤∞Í≥º: ${Object.keys(getFilteredWords()).length}Í∞ú`}
                                                </div>
                                                <div style={{ display: 'flex', gap: '0.5rem', alignItems: 'center' }}>
                                                    {showFavoritesOnly && Object.keys(getCurrentSetFavorites()).length > 0 && (
                                                        <button
                                                            className="btn"
                                                            onClick={clearAllFavorites}
                                                            style={{
                                                                padding: '0.3rem 0.8rem',
                                                                fontSize: '0.8rem',
                                                                background: 'linear-gradient(45deg, #e74c3c, #c0392b)',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '6px'
                                                            }}
                                                            title="Ï†ÑÏ≤¥ ÌëúÏãú Ìï¥Ï†ú"
                                                        >
                                                            üóëÔ∏è Ï†ÑÏ≤¥ Ìï¥Ï†ú
                                                        </button>
                                                    )}
                                                    <button
                                                        className="btn"
                                                        onClick={() => setShowFavoritesOnly(!showFavoritesOnly)}
                                                        style={{
                                                            padding: '0.3rem 0.8rem',
                                                            fontSize: '0.8rem',
                                                            background: showFavoritesOnly ? 'linear-gradient(45deg, #f39c12, #e67e22)' : 'linear-gradient(45deg, #bdc3c7, #95a5a6)',
                                                            color: 'white',
                                                            border: 'none',
                                                            borderRadius: '6px'
                                                        }}
                                                        title={showFavoritesOnly ? "Î™®Îì† Îã®Ïñ¥ Î≥¥Í∏∞" : "ÌëúÏãúÎêú Îã®Ïñ¥Îßå Î≥¥Í∏∞"}
                                                    >
                                                        {showFavoritesOnly ? 'üìã Ï†ÑÏ≤¥ Î≥¥Í∏∞' : '‚≠ê ÌëúÏãúÎßå Î≥¥Í∏∞'}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        </div>
                                    )}
                                    
                                    {showWrongAnswers ? (
                                        <div className="word-list">
                                            {wrongAnswers.map((wrongItem, index) => {
                                                const questionText = wrongItem.kanji || wrongItem.hiragana;
                                                const isFavorite = wrongAnswerFavorites[index];
                                                
                                                // Î©îÏù∏ Îã®Ïñ¥Ïû•ÏóêÏÑú Ïù¥ÎØ∏ ÌëúÏãúÎêú Îã®Ïñ¥Ïù∏ÏßÄ ÌôïÏù∏
                                                const wordKey = wrongItem.hiragana || wrongItem.question;
                                                const isAlreadyStarred = getCurrentSetFavorites()[wordKey] || false;
                                                
                                                return (
                                                    <div key={index} className="word-item slide-in" style={{
                                                        border: isAlreadyStarred ? '2px solid #f39c12' : '1px solid #e1e8ed',
                                                        backgroundColor: isAlreadyStarred ? 'rgba(243, 156, 18, 0.05)' : 'rgba(231, 76, 60, 0.02)'
                                                    }}>
                                                        <div>
                                                            <strong style={{ color: isAlreadyStarred ? '#f39c12' : '#2c3e50' }}>
                                                                {isAlreadyStarred ? '‚≠ê ' : ''}{questionText}
                                                            </strong>
                                                            {wrongItem.kanji && wrongItem.kanji !== wrongItem.hiragana && <span> ({wrongItem.hiragana})</span>}
                                                            <span style={{ color: '#27ae60' }}> - {wrongItem.korean}</span>
                                                            <br/>
                                                            <small style={{ color: '#7f8c8d' }}>
                                                                ÎÇ¥ Îãµ: <span style={{ color: '#e74c3c' }}>{wrongItem.userAnswer}</span> | 
                                                                Ï†ïÎãµ: <span style={{ color: '#27ae60' }}>{wrongItem.correctAnswer}</span>
                                                                {wrongItem.result && <span> ({wrongItem.result === 'partial' ? 'Î∂ÄÎ∂Ñ Ï†ïÎãµ' : 'Ïò§Îãµ'})</span>}
                                                            </small>
                                                        </div>
                                                        <div style={{ display: 'flex', gap: '0.5rem' }}>
                                                            <button 
                                                                className="btn"
                                                                style={{ 
                                                                    padding: '0.5rem 1rem', 
                                                                    fontSize: '0.9rem',
                                                                    background: isAlreadyStarred ? 'linear-gradient(45deg, #f39c12, #e67e22)' : 'linear-gradient(45deg, #bdc3c7, #95a5a6)',
                                                                    color: 'white'
                                                                }}
                                                                onClick={() => {
                                                                    const wordKey = wrongItem.hiragana || wrongItem.question;
                                                                    // Ïã§Ï†ú Îã®Ïñ¥Ïû•Ïóê Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä/Ï†úÍ±∞
                                                                    toggleWordFavorite(wordKey);
                                                                    // Î°úÏª¨ ÏÉÅÌÉúÎèÑ ÏóÖÎç∞Ïù¥Ìä∏ (ÌãÄÎ¶∞Î¨∏Ï†ú Ï†ÑÏö© Ï¶êÍ≤®Ï∞æÍ∏∞Îäî Ï†úÍ±∞)
                                                                    setWrongAnswerFavorites(prev => ({
                                                                        ...prev,
                                                                        [index]: false
                                                                    }));

                                                                    // ÏÉÅÌÉú Í∞ïÏ†ú ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏúÑÌï¥ Ïû¨Î†åÎçîÎßÅ Ìä∏Î¶¨Í±∞
                                                                    setTimeout(() => {
                                                                        setShowWrongAnswers(false);
                                                                        setShowWrongAnswers(true);
                                                                    }, 50);
                                                                }}
                                                                title={isAlreadyStarred ? "ÌëúÏãú Ìï¥Ï†ú" : "ÌëúÏãú Ï∂îÍ∞Ä"}
                                                            >
                                                                {isAlreadyStarred ? '‚≠ê ÌëúÏãúÎê®' : '‚òÜ ÌëúÏãú'}
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            {wrongAnswers.length === 0 && (
                                                <div style={{ textAlign: 'center', color: '#7f8c8d', padding: '2rem' }}>
                                                    ÌãÄÎ¶∞ Î¨∏Ï†úÍ∞Ä ÏóÜÏäµÎãàÎã§! üéâ
                                                </div>
                                            )}
                                        </div>
                                    ) : (
                                        <div className="word-list">
                                        {Object.entries(getFilteredWords()).map(([hiragana, data]) => {
                                            const isFavorite = getCurrentSetFavorites()[hiragana];
                                            return (
                                                <div key={hiragana} className="word-item slide-in" style={{
                                                    border: isFavorite ? '2px solid #f39c12' : '1px solid #e1e8ed',
                                                    backgroundColor: isFavorite ? 'rgba(241, 196, 15, 0.05)' : 'transparent'
                                                }}>
                                                    <div>
                                                        <strong style={{ color: isFavorite ? '#f39c12' : 'inherit' }}>
                                                            {isFavorite ? '‚≠ê ' : ''}{hiragana}
                                                        </strong>
                                                        {data.kanji && <span> ({data.kanji})</span>}
                                                        <span> - {data.korean}</span>
                                                    </div>
                                                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                                                        <button 
                                                            className="btn"
                                                            style={{ 
                                                                padding: '0.5rem 1rem', 
                                                                fontSize: '0.9rem',
                                                                background: isFavorite ? 'linear-gradient(45deg, #f39c12, #e67e22)' : 'linear-gradient(45deg, #bdc3c7, #95a5a6)',
                                                                color: 'white'
                                                            }}
                                                            onClick={() => toggleWordFavorite(hiragana)}
                                                            title={isFavorite ? "Ï¶êÍ≤®Ï∞æÍ∏∞ Ìï¥Ï†ú" : "Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä"}
                                                        >
                                                            {isFavorite ? '‚≠ê ÌëúÏãúÎê®' : '‚òÜ ÌëúÏãú'}
                                                        </button>
                                                        <button 
                                                            className="btn btn-primary"
                                                            style={{ 
                                                                padding: '0.5rem 1rem', 
                                                                fontSize: '0.9rem',
                                                                background: 'linear-gradient(45deg, #3498db, #2980b9)'
                                                            }}
                                                            onClick={() => startEditWord(hiragana)}
                                                            title="Îã®Ïñ¥ ÏàòÏ†ïÌïòÍ∏∞"
                                                        >
                                                            ‚úèÔ∏è ÏàòÏ†ï
                                                        </button>
                                                        <button 
                                                            className="btn btn-danger"
                                                            style={{ padding: '0.5rem 1rem', fontSize: '0.9rem' }}
                                                            onClick={async () => await deleteWord(hiragana)}
                                                            title="ÌÅ¥Î¶≠ÌïòÎ©¥ ÌôïÏù∏ ÌåùÏóÖÏù¥ ÎÇòÌÉÄÎÇ©ÎãàÎã§"
                                                        >
                                                            üóëÔ∏è ÏÇ≠Ï†ú
                                                        </button>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                        {Object.keys(getFilteredWords()).length === 0 && (
                                            <div style={{ 
                                                textAlign: 'center', 
                                                color: '#7f8c8d', 
                                                padding: '3rem 1rem',
                                                background: 'rgba(189, 195, 199, 0.1)',
                                                borderRadius: '8px',
                                                border: '1px dashed rgba(189, 195, 199, 0.3)'
                                            }}>
                                                {searchQuery ? (
                                                    <div>
                                                        <div style={{ fontSize: '2rem', marginBottom: '1rem' }}>üîç</div>
                                                        <div style={{ fontSize: '1.1rem', marginBottom: '0.5rem' }}>
                                                            '{searchQuery}' Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§
                                                        </div>
                                                        <div style={{ fontSize: '0.9rem', color: '#95a5a6' }}>
                                                            Îã§Î•∏ ÌÇ§ÏõåÎìúÎ°ú Í≤ÄÏÉâÌï¥Î≥¥Í±∞ÎÇò ÏÉà Îã®Ïñ¥Î•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî
                                                        </div>
                                                    </div>
                                                ) : showFavoritesOnly ? (
                                                    <div>
                                                        <div style={{ fontSize: '2rem', marginBottom: '1rem' }}>‚≠ê</div>
                                                        <div style={{ fontSize: '1.1rem', marginBottom: '0.5rem' }}>
                                                            ÌëúÏãúÎêú Îã®Ïñ¥Í∞Ä ÏóÜÏäµÎãàÎã§
                                                        </div>
                                                        <div style={{ fontSize: '0.9rem', color: '#95a5a6' }}>
                                                            Îã®Ïñ¥Ïóê ‚≠ê ÌëúÏãúÎ•º Ìï¥Î≥¥ÏÑ∏Ïöî
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div>
                                                        <div style={{ fontSize: '2rem', marginBottom: '1rem' }}>üìö</div>
                                                        <div style={{ fontSize: '1.1rem', marginBottom: '0.5rem' }}>
                                                            Îã®Ïñ¥Ïû•Ïù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§
                                                        </div>
                                                        <div style={{ fontSize: '0.9rem', color: '#95a5a6' }}>
                                                            ÏÉà Îã®Ïñ¥Î•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                        </div>
                                    )}
                                </div>
                            )}

                            {currentTab === 'add' && (
                                <div className="card fade-in">
                                    <h2 style={{ marginBottom: '2rem', color: '#2c3e50' }}>
                                        {isEditMode ? `üìù Îã®Ïñ¥ ÏàòÏ†ï: ${editingWordKey}` : '‚ûï ÏÉà Îã®Ïñ¥ Ï∂îÍ∞Ä'}
                                    </h2>
                                    
                                    {isEditMode && (
                                        <div style={{
                                            background: 'rgba(241, 196, 15, 0.1)',
                                            border: '2px solid rgba(241, 196, 15, 0.3)',
                                            borderRadius: '12px',
                                            padding: '1rem',
                                            marginBottom: '2rem'
                                        }}>
                                            <div style={{ color: '#f39c12', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                üîÑ ÏàòÏ†ï Î™®Îìú ÌôúÏÑ±Ìôî
                                            </div>
                                            <div style={{ color: '#2c3e50', fontSize: '0.9rem', marginBottom: '1rem' }}>
                                                '{editingWordKey}' Îã®Ïñ¥Î•º ÏàòÏ†ïÌïòÍ≥† ÏûàÏäµÎãàÎã§. Î™®Îì† ÌïÑÎìúÎ•º ÏûêÏú†Î°≠Í≤å Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§.
                                            </div>
                                            <button 
                                                className="btn btn-secondary"
                                                onClick={cancelEdit}
                                                style={{ 
                                                    padding: '0.5rem 1rem', 
                                                    fontSize: '0.9rem',
                                                    background: '#95a5a6'
                                                }}
                                            >
                                                ‚ùå ÏàòÏ†ï Ï∑®ÏÜå
                                            </button>
                                        </div>
                                    )}
                                    
                                    <div className="hangul-converter">
                                        <div className="input-group">
                                            <label className="input-label">ÌïúÍ∏Ä Î∞úÏùå (ÏûêÎèôÎ≥ÄÌôò):</label>
                                            <input
                                                type="text"
                                                className="input-field"
                                                value={hangulInput}
                                                onChange={(e) => setHangulInput(e.target.value)}
                                                placeholder="Ïòà: Í∞ìÏΩîÏö∞, ÏÑºÏÑ∏Ïù¥, Í∞∏Ïø†"
                                            />
                                            <div style={{ fontSize: '0.9rem', color: '#666', marginTop: '0.5rem' }}>
                                                üí° Î≥µÏû°Ìïú Î∞úÏùåÎèÑ ÏßÄÏõê: "Í∞ì" („Å§), "ÏÉ§" („Åó„ÇÉ), "ÌÅê" („Åç„ÇÖ) Îì±
                                            </div>
                                        </div>
                                        {convertedHiragana && (
                                            <div style={{ marginTop: '1rem', padding: '1rem', backgroundColor: 'rgba(52, 152, 219, 0.1)', borderRadius: '8px' }}>
                                                <div style={{ color: '#3498db', fontWeight: 'bold', fontSize: '1.2rem' }}>
                                                    üéå Î≥ÄÌôò Í≤∞Í≥º: {convertedHiragana}
                                                </div>
                                                <button 
                                                    className="btn btn-primary" 
                                                    style={{ marginTop: '0.5rem', padding: '0.5rem 1rem', fontSize: '0.9rem' }}
                                                    onClick={useConvertedWord}
                                                >
                                                    ‚ú® ÌûàÎùºÍ∞ÄÎÇò ÎûÄÏóê Ï†ÅÏö©
                                                </button>
                                            </div>
                                        )}
                                    </div>

                                    <div className="input-group">
                                        <label className="input-label">ÌûàÎùºÍ∞ÄÎÇò/Í∞ÄÌÉÄÏπ¥ÎÇò:</label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            value={newHiragana}
                                            onChange={(e) => setNewHiragana(e.target.value)}
                                            placeholder="Ïòà: „Åå„Å£„Åì„ÅÜ (ÏûÖÎ†•ÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú APIÏóêÏÑú ÌïúÏûê Í≤ÄÏÉâ)"
                                        />
                                    </div>

                                    <div className="input-group">
                                        <label className="input-label">ÌïúÏûê (üåê API ÏûêÎèôÍ≤ÄÏÉâ):</label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            value={newKanji}
                                            onChange={(e) => setNewKanji(e.target.value)}
                                            placeholder="Ïòà: Â≠¶Ê†°"
                                        />
                                        {kanjiStatus && (
                                            <div className={`status-indicator ${kanjiStatus.includes('‚úÖ') || kanjiStatus.includes('üîç') ? 'status-success' : 'status-error'}`}>
                                                {kanjiStatus}
                                            </div>
                                        )}
                                        
                                        {/* ÌïúÏûê ÌõÑÎ≥¥ Î™©Î°ù */}
                                        {kanjiCandidates.length > 0 && (
                                            <div style={{ 
                                                marginTop: '1rem', 
                                                border: '2px solid #3498db', 
                                                borderRadius: '8px', 
                                                padding: '1rem',
                                                backgroundColor: 'rgba(52, 152, 219, 0.05)'
                                            }}>
                                                <div style={{ marginBottom: '0.5rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                    üéØ ÌïúÏûê ÌõÑÎ≥¥ Î™©Î°ù (ÌÅ¥Î¶≠Ìï¥ÏÑú ÏÑ†ÌÉù):
                                                </div>
                                                <div style={{ display: 'grid', gap: '0.5rem' }}>
                                                    {kanjiCandidates.map((candidate, index) => (
                                                        <div 
                                                            key={index}
                                                            onClick={() => selectKanjiCandidate(candidate)}
                                                            style={{
                                                                padding: '0.8rem',
                                                                border: '1px solid #bdc3c7',
                                                                borderRadius: '6px',
                                                                cursor: 'pointer',
                                                                transition: 'all 0.2s ease',
                                                                backgroundColor: newKanji === candidate.kanji ? 'rgba(46, 204, 113, 0.1)' : 'white'
                                                            }}
                                                            onMouseEnter={(e) => e.target.style.backgroundColor = 'rgba(52, 152, 219, 0.1)'}
                                                            onMouseLeave={(e) => e.target.style.backgroundColor = newKanji === candidate.kanji ? 'rgba(46, 204, 113, 0.1)' : 'white'}
                                                        >
                                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                                <div>
                                                                    <span style={{ fontSize: '1.4rem', fontWeight: 'bold', marginRight: '0.5rem' }}>
                                                                        {candidate.kanji}
                                                                    </span>
                                                                    <span style={{ color: '#7f8c8d', fontSize: '0.9rem' }}>
                                                                        ({candidate.reading})
                                                                    </span>
                                                                </div>
                                                                {candidate.meanings && (
                                                                    <div style={{ fontSize: '0.9rem', color: '#34495e', textAlign: 'right', maxWidth: '200px' }}>
                                                                        {candidate.meanings}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                        <div style={{ fontSize: '0.9rem', color: '#666', marginTop: '0.5rem' }}>
                                            üåê Jisho.org APIÎ•º ÌÜµÌï¥ Ïã§ÏãúÍ∞Ñ ÌïúÏûê Í≤ÄÏÉâ
                                        </div>
                                    </div>

                                    <div className="input-group">
                                        <label className="input-label">ÌïúÍµ≠Ïñ¥ Îúª:</label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            value={newKorean}
                                            onChange={(e) => setNewKorean(e.target.value)}
                                            placeholder="Ïòà: ÌïôÍµê"
                                        />
                                    </div>

                                    <div className="btn-group">
                                        <button className="btn btn-success" onClick={async () => await addNewWord()}>
                                            {isEditMode ? '‚úÖ ÏàòÏ†ï ÏôÑÎ£å' : '‚ûï Îã®Ïñ¥ Ï∂îÍ∞Ä'}
                                        </button>
                                        
                                    </div>
                                </div>
                            )}

                            {currentTab === 'data' && (
                                <div className="card fade-in">
                                    <h2 style={{ marginBottom: '2rem', color: '#2c3e50' }}>üíæ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h2>
                                    
                                    {/* Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏÑ§Ï†ï ÏÑπÏÖò */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{ 
                                            color: '#34495e', 
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #e74c3c',
                                            paddingBottom: '0.5rem'
                                        }}>üîß Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏÑ§Ï†ï</h3>
                                        
                                        <div style={{
                                            background: 'rgba(231, 76, 60, 0.1)',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(231, 76, 60, 0.3)',
                                            marginBottom: '1rem'
                                        }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                                                <h4 style={{ color: '#e74c3c', margin: 0 }}>üìã Ìè¨Ìï®Ìï† Îã®Ïñ¥Ïû• ÏÑ†ÌÉù</h4>
                                                <button 
                                                    className="btn btn-warning"
                                                    onClick={() => setShowSetSelector(!showSetSelector)}
                                                    style={{ fontSize: '0.9rem', padding: '0.5rem 1rem' }}
                                                >
                                                    {showSetSelector ? 'üìù ÏÑ†ÌÉù ÏôÑÎ£å' : '‚úèÔ∏è Îã®Ïñ¥Ïû• ÏÑ†ÌÉù'}
                                                </button>
                                            </div>
                                            
                                            {showSetSelector ? (
                                                <div>
                                                    <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                                                        Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•Ïóê Ìè¨Ìï®Ìï† Îã®Ïñ¥Ïû•Îì§ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. ÏÑ†ÌÉùÌïòÏßÄ ÏïäÏúºÎ©¥ Î™®Îì† Îã®Ïñ¥Ïû•Ïù¥ Ìè¨Ìï®Îê©ÎãàÎã§.
                                                    </p>
                                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', gap: '0.8rem' }}>
                                                        {Object.entries(setNames).filter(([setId]) => setId !== 'combined').map(([setId, setName]) => (
                                                            <label 
                                                                key={setId}
                                                                style={{ 
                                                                    display: 'flex', 
                                                                    alignItems: 'center', 
                                                                    gap: '0.5rem',
                                                                    padding: '0.7rem',
                                                                    background: selectedSetsForCombined[setId] ? 'rgba(231, 76, 60, 0.1)' : 'rgba(255, 255, 255, 0.5)',
                                                                    borderRadius: '8px',
                                                                    border: selectedSetsForCombined[setId] ? '2px solid #e74c3c' : '1px solid #ddd',
                                                                    cursor: 'pointer'
                                                                }}
                                                            >
                                                                <input 
                                                                    type="checkbox"
                                                                    checked={selectedSetsForCombined[setId] || false}
                                                                    onChange={(e) => {
                                                                        const newSelection = {
                                                                            ...selectedSetsForCombined,
                                                                            [setId]: e.target.checked
                                                                        };
                                                                        setSelectedSetsForCombined(newSelection);
                                                                        saveSelectedSets(newSelection);
                                                                        // Ï¶âÏãú Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû• ÏóÖÎç∞Ïù¥Ìä∏
                                                                        setTimeout(() => updateCombinedWordSet(), 100);
                                                                    }}
                                                                    style={{ marginRight: '0.3rem' }}
                                                                />
                                                                <span style={{ fontSize: '0.9rem', color: selectedSetsForCombined[setId] ? '#e74c3c' : '#333' }}>
                                                                    {setName} ({Object.keys(wordSets[setId] || {}).length}Í∞ú)
                                                                </span>
                                                            </label>
                                                        ))}
                                                    </div>
                                                    <div style={{ marginTop: '1rem', padding: '0.8rem', background: 'rgba(52, 152, 219, 0.1)', borderRadius: '6px' }}>
                                                        <small style={{ color: '#2980b9' }}>
                                                            üí° ÌòÑÏû¨ ÏÑ†ÌÉù: {Object.values(selectedSetsForCombined).filter(Boolean).length}Í∞ú Îã®Ïñ¥Ïû• |
                                                            Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•Ïóê Ìè¨Ìï®Îê† Îã®Ïñ¥: {(() => {
                                                                const hasSelection = Object.keys(selectedSetsForCombined).some(setId => selectedSetsForCombined[setId]);
                                                                if (!hasSelection) return Object.values(wordSets).filter((_, i) => Object.keys(wordSets)[i] !== 'combined').reduce((total, set) => total + Object.keys(set).length, 0);
                                                                return Object.entries(wordSets)
                                                                    .filter(([setId]) => setId !== 'combined' && selectedSetsForCombined[setId])
                                                                    .reduce((total, [_, set]) => total + Object.keys(set).length, 0);
                                                            })()}Í∞ú
                                                        </small>
                                                    </div>
                                                </div>
                                            ) : (
                                                <p style={{ fontSize: '0.9rem', color: '#666', margin: 0 }}>
                                                    ÌòÑÏû¨ Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•ÏùÄ {(() => {
                                                        const hasSelection = Object.keys(selectedSetsForCombined).some(setId => selectedSetsForCombined[setId]);
                                                        const selectedCount = Object.values(selectedSetsForCombined).filter(Boolean).length;
                                                        const totalSets = Object.keys(setNames).filter(setId => setId !== 'combined').length;
                                                        return hasSelection ? `ÏÑ†ÌÉùÎêú ${selectedCount}Í∞ú Îã®Ïñ¥Ïû•` : `Î™®Îì† ${totalSets}Í∞ú Îã®Ïñ¥Ïû•`;
                                                    })()}ÏúºÎ°ú Íµ¨ÏÑ±Îê©ÎãàÎã§.
                                                </p>
                                            )}
                                        </div>
                                    </div>

                                    {/* Îã®Ïñ¥Ïû• Ìï©ÏπòÍ∏∞ ÏÑπÏÖò */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{
                                            color: '#34495e',
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #3498db',
                                            paddingBottom: '0.5rem'
                                        }}>üîó Îã®Ïñ¥Ïû• Ìï©ÏπòÍ∏∞</h3>

                                        <div style={{
                                            background: 'rgba(52, 152, 219, 0.1)',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(52, 152, 219, 0.3)',
                                            marginBottom: '1rem'
                                        }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                                                <h4 style={{ color: '#3498db', margin: 0 }}>üìã Ìï©Ïπ† Îã®Ïñ¥Ïû• ÏÑ†ÌÉù</h4>
                                                <button
                                                    className="btn btn-primary"
                                                    onClick={() => setShowMergeSelector(!showMergeSelector)}
                                                    style={{ fontSize: '0.9rem', padding: '0.5rem 1rem' }}
                                                >
                                                    {showMergeSelector ? 'üìù ÏÑ†ÌÉù ÏôÑÎ£å' : '‚úèÔ∏è Îã®Ïñ¥Ïû• ÏÑ†ÌÉù'}
                                                </button>
                                            </div>

                                            <p style={{ color: '#34495e', marginBottom: '1rem', fontSize: '0.9rem' }}>
                                                ÏÑ†ÌÉùÌïú Îã®Ïñ¥Ïû•Îì§ÏùÑ Ìï©Ï≥êÏÑú ÏÉàÎ°úÏö¥ Îã®Ïñ¥Ïû•ÏùÑ ÎßåÎì§ Ïàò ÏûàÏäµÎãàÎã§. Ï§ëÎ≥µÎêòÎäî Îã®Ïñ¥Îäî ÏûêÎèôÏúºÎ°ú Ï†úÍ±∞Îê©ÎãàÎã§.
                                            </p>

                                            {showMergeSelector && (
                                                <div style={{ marginTop: '1rem' }}>
                                                    {Object.entries(setNames).filter(([setId]) => setId !== 'combined').map(([setId, setName]) => (
                                                        <label key={setId} style={{
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            marginBottom: '0.5rem',
                                                            cursor: 'pointer',
                                                            padding: '0.5rem',
                                                            borderRadius: '8px',
                                                            backgroundColor: selectedSetsForMerge[setId] ? 'rgba(52, 152, 219, 0.2)' : 'transparent'
                                                        }}>
                                                            <input
                                                                type="checkbox"
                                                                checked={selectedSetsForMerge[setId] || false}
                                                                onChange={(e) => {
                                                                    setSelectedSetsForMerge(prev => ({
                                                                        ...prev,
                                                                        [setId]: e.target.checked
                                                                    }));
                                                                }}
                                                                style={{ marginRight: '0.5rem' }}
                                                            />
                                                            {setName} ({Object.keys(wordSets[setId] || {}).length}Í∞ú Îã®Ïñ¥)
                                                        </label>
                                                    ))}
                                                </div>
                                            )}

                                            <div style={{ marginTop: '1rem' }}>
                                                <p style={{ color: '#34495e', fontSize: '0.9rem', marginBottom: '0.5rem' }}>
                                                    üí° ÌòÑÏû¨ ÏÑ†ÌÉù: {Object.values(selectedSetsForMerge).filter(Boolean).length}Í∞ú Îã®Ïñ¥Ïû• |
                                                    Ìï©Ï≥êÏßà Îã®Ïñ¥: {(() => {
                                                        let totalWords = {};
                                                        Object.entries(selectedSetsForMerge)
                                                            .filter(([_, selected]) => selected)
                                                            .forEach(([setId, _]) => {
                                                                if (wordSets[setId]) {
                                                                    Object.assign(totalWords, wordSets[setId]);
                                                                }
                                                            });
                                                        return Object.keys(totalWords).length;
                                                    })()}Í∞ú
                                                </p>
                                            </div>

                                            {Object.values(selectedSetsForMerge).some(Boolean) && (
                                                <div style={{ marginTop: '1rem' }}>
                                                    <input
                                                        type="text"
                                                        placeholder="ÏÉà Îã®Ïñ¥Ïû• Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                        value={newMergedSetName}
                                                        onChange={(e) => setNewMergedSetName(e.target.value)}
                                                        style={{
                                                            width: '100%',
                                                            padding: '0.8rem',
                                                            borderRadius: '8px',
                                                            border: '2px solid #ddd',
                                                            fontSize: '1rem',
                                                            marginBottom: '1rem'
                                                        }}
                                                    />
                                                    <button
                                                        className="btn btn-success"
                                                        onClick={mergeSelectedSets}
                                                        style={{ width: '100%' }}
                                                    >
                                                        üéØ ÏÑ†ÌÉùÎêú Îã®Ïñ¥Ïû•Îì§ Ìï©ÏπòÍ∏∞
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Îã®Ïñ¥Ïû• ÏÇ≠Ï†ú ÏÑπÏÖò */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{
                                            color: '#34495e',
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #e74c3c',
                                            paddingBottom: '0.5rem'
                                        }}>üóëÔ∏è Îã®Ïñ¥Ïû• ÏÇ≠Ï†ú</h3>

                                        <div style={{
                                            background: 'rgba(231, 76, 60, 0.1)',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(231, 76, 60, 0.3)',
                                            marginBottom: '1rem'
                                        }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                                                <h4 style={{ color: '#e74c3c', margin: 0 }}>üö® ÏÇ≠Ï†úÌï† Îã®Ïñ¥Ïû• ÏÑ†ÌÉù</h4>
                                                <button
                                                    className="btn btn-danger"
                                                    onClick={() => setShowDeleteSelector(!showDeleteSelector)}
                                                    style={{ fontSize: '0.9rem', padding: '0.5rem 1rem' }}
                                                >
                                                    {showDeleteSelector ? 'üìù ÏÑ†ÌÉù ÏôÑÎ£å' : '‚úèÔ∏è Îã®Ïñ¥Ïû• ÏÑ†ÌÉù'}
                                                </button>
                                            </div>

                                            <p style={{ color: '#e74c3c', marginBottom: '1rem', fontSize: '0.9rem', fontWeight: 'bold' }}>
                                                ‚ö†Ô∏è ÏÇ≠Ï†úÎêú Îã®Ïñ¥Ïû•ÏùÄ Î≥µÍµ¨Ìï† Ïàò ÏóÜÏäµÎãàÎã§. Ïã†Ï§ëÌïòÍ≤å ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.
                                            </p>

                                            {showDeleteSelector && (
                                                <div style={{ marginTop: '1rem' }}>
                                                    {Object.entries(setNames).filter(([setId]) => setId !== 'combined').map(([setId, setName]) => (
                                                        <label key={setId} style={{
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            marginBottom: '0.5rem',
                                                            cursor: 'pointer',
                                                            padding: '0.5rem',
                                                            borderRadius: '8px',
                                                            backgroundColor: selectedSetsForDelete[setId] ? 'rgba(231, 76, 60, 0.2)' : 'transparent',
                                                            border: selectedSetsForDelete[setId] ? '2px solid rgba(231, 76, 60, 0.5)' : '1px solid transparent'
                                                        }}>
                                                            <input
                                                                type="checkbox"
                                                                checked={selectedSetsForDelete[setId] || false}
                                                                onChange={(e) => {
                                                                    setSelectedSetsForDelete(prev => ({
                                                                        ...prev,
                                                                        [setId]: e.target.checked
                                                                    }));
                                                                }}
                                                                style={{ marginRight: '0.5rem' }}
                                                            />
                                                            <span style={{
                                                                color: selectedSetsForDelete[setId] ? '#e74c3c' : '#34495e',
                                                                fontWeight: selectedSetsForDelete[setId] ? 'bold' : 'normal'
                                                            }}>
                                                                {setName} ({Object.keys(wordSets[setId] || {}).length}Í∞ú Îã®Ïñ¥)
                                                                {setId === currentSetId && ' (ÌòÑÏû¨ Îã®Ïñ¥Ïû•)'}
                                                            </span>
                                                        </label>
                                                    ))}
                                                </div>
                                            )}

                                            <div style={{ marginTop: '1rem' }}>
                                                <p style={{ color: '#e74c3c', fontSize: '0.9rem', marginBottom: '0.5rem' }}>
                                                    üö® ÏÑ†ÌÉùÎêú Îã®Ïñ¥Ïû•: {Object.values(selectedSetsForDelete).filter(Boolean).length}Í∞ú |
                                                    ÏÇ≠Ï†úÎê† Îã®Ïñ¥: {(() => {
                                                        let totalWords = 0;
                                                        Object.entries(selectedSetsForDelete)
                                                            .filter(([_, selected]) => selected)
                                                            .forEach(([setId, _]) => {
                                                                if (wordSets[setId]) {
                                                                    totalWords += Object.keys(wordSets[setId]).length;
                                                                }
                                                            });
                                                        return totalWords;
                                                    })()}Í∞ú
                                                </p>
                                            </div>

                                            {Object.values(selectedSetsForDelete).some(Boolean) && (
                                                <div style={{ marginTop: '1rem' }}>
                                                    <button
                                                        className="btn btn-danger"
                                                        onClick={deleteSelectedSets}
                                                        style={{
                                                            width: '100%',
                                                            fontSize: '1rem',
                                                            fontWeight: 'bold',
                                                            padding: '1rem'
                                                        }}
                                                    >
                                                        üóëÔ∏è ÏÑ†ÌÉùÎêú Îã®Ïñ¥Ïû•Îì§ ÏÇ≠Ï†úÌïòÍ∏∞
                                                    </button>
                                                </div>
                                            )}

                                            <div style={{
                                                marginTop: '1.5rem',
                                                padding: '1rem',
                                                backgroundColor: 'rgba(255, 255, 255, 0.7)',
                                                borderRadius: '8px',
                                                border: '1px solid rgba(231, 76, 60, 0.2)'
                                            }}>
                                                <h5 style={{ color: '#e74c3c', marginBottom: '0.5rem' }}>üí° ÎèÑÏõÄÎßê</h5>
                                                <ul style={{ color: '#34495e', fontSize: '0.8rem', margin: 0, paddingLeft: '1.2rem' }}>
                                                    <li>Í∞úÎ≥Ñ Îã®Ïñ¥Ïû• ÏÇ≠Ï†úÎäî Îã®Ïñ¥Ïû• ÏÑ†ÌÉù ÏòÅÏó≠Ïùò üóëÔ∏è Î≤ÑÌäºÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî</li>
                                                    <li>Ï†ÑÏ≤¥ Îã®Ïñ¥Ïû•(ÏûêÎèô ÏÉùÏÑ±)ÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§</li>
                                                    <li>ÏÇ≠Ï†ú Ï†ÑÏóê Î∞±ÏóÖÏùÑ Í∂åÏû•Ìï©ÎãàÎã§</li>
                                                    <li>ÌòÑÏû¨ ÏÑ†ÌÉùÎêú Îã®Ïñ¥Ïû•ÏùÑ ÏÇ≠Ï†úÌïòÎ©¥ Îã§Î•∏ Îã®Ïñ¥Ïû•ÏúºÎ°ú ÏûêÎèô Ï†ÑÌôòÎê©ÎãàÎã§</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    {/* ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞ ÏÑπÏÖò */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{ 
                                            color: '#34495e', 
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #3498db',
                                            paddingBottom: '0.5rem'
                                        }}>üìÅ ÌååÏùº ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞</h3>
                                        
                                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1rem', marginBottom: '2rem' }}>
                                            {/* JSON ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞ */}
                                            <div style={{
                                                background: 'rgba(52, 152, 219, 0.1)',
                                                padding: '1.5rem',
                                                borderRadius: '12px',
                                                border: '1px solid rgba(52, 152, 219, 0.3)'
                                            }}>
                                                <h4 style={{ color: '#3498db', marginBottom: '1rem' }}>üóÇÔ∏è JSON ÌòïÏãù</h4>
                                                <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                                                    Î™®Îì† Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏ÏôÄ ÏÑ§Ï†ïÏùÑ ÏôÑÏ†ÑÌûà Î∞±ÏóÖ/Î≥µÏõêÌï©ÎãàÎã§. Îã§Î•∏ Í∏∞Í∏∞Î°ú ÏôÑÏ†ÑÌûà Ïù¥Ï†ÑÌï† Îïå Í∂åÏû•Ìï©ÎãàÎã§.
                                                </p>
                                                <div className="btn-group">
                                                    <button className="btn btn-primary" onClick={exportToJSON}>
                                                        üì• JSON ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                                                    </button>
                                                    <label className="btn btn-success" style={{ cursor: 'pointer' }}>
                                                        üì§ JSON Í∞ÄÏ†∏Ïò§Í∏∞
                                                        <input
                                                            type="file"
                                                            accept=".json"
                                                            onChange={importFromJSON}
                                                            style={{ display: 'none' }}
                                                        />
                                                    </label>
                                                </div>
                                            </div>

                                            {/* CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞/Í∞ÄÏ†∏Ïò§Í∏∞ */}
                                            <div style={{
                                                background: 'rgba(46, 204, 113, 0.1)',
                                                padding: '1.5rem',
                                                borderRadius: '12px',
                                                border: '1px solid rgba(46, 204, 113, 0.3)'
                                            }}>
                                                <h4 style={{ color: '#2ecc71', marginBottom: '1rem' }}>üìä CSV ÌòïÏãù</h4>
                                                <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                                                    ÏóëÏÖÄ, Íµ¨Í∏Ä Ïä§ÌîÑÎ†àÎìúÏãúÌä∏ Îì±ÏóêÏÑú Ìé∏Ïßë Í∞ÄÎä•Ìïú ÌòïÏãùÏûÖÎãàÎã§. ÎåÄÎüâ Ìé∏ÏßëÏù¥ ÌïÑÏöîÌï† Îïå Ïú†Ïö©Ìï©ÎãàÎã§.
                                                </p>
                                                <div className="btn-group">
                                                    <button className="btn btn-success" onClick={exportToCSV}>
                                                        üì• CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                                                    </button>
                                                    <label className="btn btn-warning" style={{ cursor: 'pointer' }}>
                                                        üì§ CSV Í∞ÄÏ†∏Ïò§Í∏∞
                                                        <input
                                                            type="file"
                                                            accept=".csv"
                                                            onChange={importFromCSV}
                                                            style={{ display: 'none' }}
                                                        />
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Î∞±ÏóÖ/Î≥µÏõê ÏÑπÏÖò */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{ 
                                            color: '#34495e', 
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #e67e22',
                                            paddingBottom: '0.5rem'
                                        }}>üîÑ Î∞±ÏóÖ Î∞è Î≥µÏõê</h3>
                                        
                                        <div style={{
                                            background: 'rgba(230, 126, 34, 0.1)',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(230, 126, 34, 0.3)',
                                            marginBottom: '1rem'
                                        }}>
                                            <h4 style={{ color: '#e67e22', marginBottom: '1rem' }}>‚ö° ÏûêÎèô Î∞±ÏóÖ</h4>
                                            <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                                                Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Í±∞ÎÇò ÏÇ≠Ï†úÌï† Îïå ÏûêÎèôÏúºÎ°ú Î∞±ÏóÖÏù¥ ÏÉùÏÑ±Îê©ÎãàÎã§. Î∞±ÏóÖÏùÄ Î∏åÎùºÏö∞Ï†ÄÏóê Ï†ÄÏû•ÎêòÎ©∞ Ïñ∏Ï†úÎì†ÏßÄ Î≥µÏõêÌï† Ïàò ÏûàÏäµÎãàÎã§.
                                            </p>
                                            <button className="btn btn-warning" onClick={restoreBackup}>
                                                üîô ÎßàÏßÄÎßâ Î∞±ÏóÖ Î≥µÏõê
                                            </button>
                                        </div>
                                    </div>

                                    {/* Îç∞Ïù¥ÌÑ∞ Ï†ïÎ≥¥ ÏÑπÏÖò */}
                                    <div style={{ marginBottom: '3rem' }}>
                                        <h3 style={{ 
                                            color: '#34495e', 
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #9b59b6',
                                            paddingBottom: '0.5rem'
                                        }}>üìä ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞ Ï†ïÎ≥¥</h3>
                                        
                                        <div style={{
                                            background: 'rgba(155, 89, 182, 0.1)',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(155, 89, 182, 0.3)'
                                        }}>
                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1rem' }}>
                                                <div>
                                                    <h4 style={{ color: '#9b59b6' }}>üìö Îã®Ïñ¥Ïû• ÏÑ∏Ìä∏</h4>
                                                    <p style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                        {Object.keys(wordSets).length}Í∞ú
                                                    </p>
                                                </div>
                                                <div>
                                                    <h4 style={{ color: '#9b59b6' }}>üìù Ï¥ù Îã®Ïñ¥ Ïàò</h4>
                                                    <p style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                        {Object.values(wordSets).reduce((total, set) => total + Object.keys(set).length, 0)}Í∞ú
                                                    </p>
                                                </div>
                                                <div>
                                                    <h4 style={{ color: '#9b59b6' }}>‚≠ê ÌëúÏãúÎêú Îã®Ïñ¥</h4>
                                                    <p style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                        {Object.values(wordSets).reduce((total, set) => 
                                                            total + Object.values(set).filter(word => word.favorite).length, 0
                                                        )}Í∞ú
                                                    </p>
                                                </div>
                                                <div>
                                                    <h4 style={{ color: '#9b59b6' }}>üìñ ÌòÑÏû¨ ÏÑ∏Ìä∏</h4>
                                                    <p style={{ fontSize: '1.2rem', fontWeight: 'bold', color: '#2c3e50' }}>
                                                        {setNames[currentSetId]}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* ÏúÑÌóòÌïú ÏûëÏóÖ ÏÑπÏÖò */}
                                    <div>
                                        <h3 style={{ 
                                            color: '#e74c3c', 
                                            marginBottom: '1.5rem',
                                            borderBottom: '2px solid #e74c3c',
                                            paddingBottom: '0.5rem'
                                        }}>‚ö†Ô∏è ÏúÑÌóòÌïú ÏûëÏóÖ</h3>
                                        
                                        <div style={{
                                            background: 'rgba(231, 76, 60, 0.1)',
                                            padding: '1.5rem',
                                            borderRadius: '12px',
                                            border: '1px solid rgba(231, 76, 60, 0.3)'
                                        }}>
                                            <h4 style={{ color: '#e74c3c', marginBottom: '1rem' }}>üóëÔ∏è Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú</h4>
                                            <p style={{ fontSize: '0.9rem', color: '#666', marginBottom: '1rem' }}>
                                                Î™®Îì† Îã®Ïñ¥Ïû•, ÏÑ∏Ìä∏, ÏÑ§Ï†ïÏùÑ ÏôÑÏ†ÑÌûà ÏÇ≠Ï†úÌï©ÎãàÎã§. ÏÇ≠Ï†úÌïòÍ∏∞ Ï†ÑÏóê Î∞òÎìúÏãú Î∞±ÏóÖÏùÑ ÎßåÎìúÏÑ∏Ïöî!
                                            </p>
                                            <button 
                                                className="btn btn-danger" 
                                                onClick={clearAllData}
                                                style={{ 
                                                    background: '#e74c3c',
                                                    border: '2px solid #c0392b'
                                                }}
                                            >
                                                ‚ö†Ô∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                                            </button>
                                        </div>
                                    </div>

                                    {/* ÎèÑÏõÄÎßê ÏÑπÏÖò */}
                                    <div style={{ 
                                        marginTop: '3rem',
                                        background: 'rgba(52, 73, 94, 0.1)',
                                        padding: '1.5rem',
                                        borderRadius: '12px',
                                        border: '1px solid rgba(52, 73, 94, 0.3)'
                                    }}>
                                        <h4 style={{ color: '#34495e', marginBottom: '1rem' }}>üí° ÏÇ¨Ïö© ÌåÅ</h4>
                                        <ul style={{ color: '#666', paddingLeft: '1.5rem' }}>
                                            <li>Ï†ïÍ∏∞Ï†ÅÏúºÎ°ú JSON Î∞±ÏóÖÏùÑ ÎßåÎì§Ïñ¥ Îã§Î•∏ Í≥≥Ïóê Ï†ÄÏû•ÌïòÏÑ∏Ïöî</li>
                                            <li>CSV ÌòïÏãùÏùÄ ExcelÏóêÏÑú Îã®Ïñ¥Î•º ÎåÄÎüâ Ìé∏ÏßëÌïú ÌõÑ Îã§Ïãú Í∞ÄÏ†∏Ïò¨ Îïå Ïú†Ïö©Ìï©ÎãàÎã§</li>
                                            <li>Î∏åÎùºÏö∞Ï†Ä Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÍ∏∞ Ï†ÑÏóê Î∞òÎìúÏãú Î∞±ÏóÖÏùÑ ÎßåÎìúÏÑ∏Ïöî</li>
                                            <li>Îã§Î•∏ Í∏∞Í∏∞ÏóêÏÑú ÏÇ¨Ïö©ÌïòÎ†§Î©¥ JSON ÌååÏùºÏùÑ ÎÇ¥Î≥¥ÎÇ∏ ÌõÑ ÏÉà Í∏∞Í∏∞ÏóêÏÑú Í∞ÄÏ†∏Ïò§ÏÑ∏Ïöî</li>
                                        </ul>
                                    </div>
                                </div>
                            )}

                            {currentTab === 'kanji' && (
                                <div className="card fade-in">
                                    <h2 style={{ marginBottom: '2rem', color: '#2c3e50' }}>üîç ÌïúÏûê Î∞úÏùå Ï°∞Ìöå</h2>

                                    <div style={{ marginBottom: '2rem' }}>
                                        <div style={{ marginBottom: '1rem' }}>
                                            <label style={{
                                                display: 'block',
                                                marginBottom: '0.5rem',
                                                color: '#2c3e50',
                                                fontWeight: 'bold'
                                            }}>
                                                ÌïúÏûê Îã®Ïñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:
                                            </label>
                                            <input
                                                type="text"
                                                value={kanjiInput}
                                                onChange={(e) => setKanjiInput(e.target.value)}
                                                onKeyPress={(e) => {
                                                    if (e.key === 'Enter' && kanjiInput.trim() && !kanjiLoading) {
                                                        lookupKanjiPronunciation();
                                                    }
                                                }}
                                                placeholder="‰æã: Â≠¶Ê†°, Âõ≥Êõ∏È§®, Êñ∞ËÅû..."
                                                style={{
                                                    width: '100%',
                                                    padding: '1rem',
                                                    fontSize: '1.2rem',
                                                    border: '2px solid #ddd',
                                                    borderRadius: '8px',
                                                    outline: 'none',
                                                    transition: 'border-color 0.3s'
                                                }}
                                                onFocus={(e) => e.target.style.borderColor = '#3498db'}
                                                onBlur={(e) => e.target.style.borderColor = '#ddd'}
                                            />
                                        </div>

                                        <button
                                            className="btn btn-primary"
                                            onClick={lookupKanjiPronunciation}
                                            disabled={!kanjiInput.trim() || kanjiLoading}
                                            style={{
                                                width: '100%',
                                                padding: '1rem',
                                                fontSize: '1.1rem',
                                                opacity: (kanjiInput.trim() && !kanjiLoading) ? 1 : 0.6
                                            }}
                                        >
                                            {kanjiLoading ? 'üîÑ Ï°∞Ìöå Ï§ë...' : 'üîç Î∞úÏùå Ï°∞Ìöå'}
                                        </button>
                                    </div>

                                    {kanjiLoading && (
                                        <div style={{
                                            background: 'rgba(52, 152, 219, 0.1)',
                                            border: '2px solid rgba(52, 152, 219, 0.3)',
                                            borderRadius: '12px',
                                            padding: '2rem',
                                            marginBottom: '2rem',
                                            textAlign: 'center'
                                        }}>
                                            <div style={{
                                                fontSize: '1.2rem',
                                                color: '#3498db',
                                                marginBottom: '1rem'
                                            }}>
                                                üîç ÌïúÏûê Î∞úÏùåÏùÑ Ï°∞ÌöåÌïòÍ≥† ÏûàÏäµÎãàÎã§...
                                            </div>
                                            <div style={{
                                                fontSize: '0.9rem',
                                                color: '#7f8c8d'
                                            }}>
                                                ÎÇ¥Ïû• ÏÇ¨Ï†Ñ ‚Üí Îã®Ïñ¥Ïû• ‚Üí Jisho API ÏàúÏúºÎ°ú Í≤ÄÏÉâÏ§ë
                                            </div>
                                        </div>
                                    )}

                                    {kanjiResult && (
                                        <div style={{
                                            background: 'rgba(46, 204, 113, 0.1)',
                                            border: '2px solid rgba(46, 204, 113, 0.3)',
                                            borderRadius: '12px',
                                            padding: '2rem',
                                            marginBottom: '2rem'
                                        }}>
                                            <h3 style={{
                                                color: '#27ae60',
                                                marginBottom: '1.5rem',
                                                fontSize: '1.3rem'
                                            }}>
                                                üìù Ï°∞Ìöå Í≤∞Í≥º
                                                <span style={{
                                                    fontSize: '0.8rem',
                                                    background: 'rgba(52, 152, 219, 0.2)',
                                                    color: '#3498db',
                                                    padding: '0.2rem 0.5rem',
                                                    borderRadius: '4px',
                                                    marginLeft: '0.5rem'
                                                }}>
                                                    üìç {kanjiResult.source}
                                                </span>
                                            </h3>

                                            <div style={{ marginBottom: '1.5rem' }}>
                                                <div style={{
                                                    fontSize: '2rem',
                                                    fontWeight: 'bold',
                                                    marginBottom: '0.5rem',
                                                    color: '#2c3e50'
                                                }}>
                                                    {kanjiResult.kanji}
                                                </div>

                                                <div style={{
                                                    fontSize: '1.5rem',
                                                    color: '#e74c3c',
                                                    marginBottom: '0.5rem'
                                                }}>
                                                    üóæ {kanjiResult.hiragana}
                                                </div>

                                                <div style={{
                                                    fontSize: '1.2rem',
                                                    color: '#3498db',
                                                    marginBottom: '1rem'
                                                }}>
                                                    üî§ {kanjiResult.romaji}
                                                </div>

                                                {kanjiResult.meaning && (
                                                    <div style={{
                                                        fontSize: '1.1rem',
                                                        color: '#8e44ad',
                                                        marginBottom: '1rem'
                                                    }}>
                                                        üá∞üá∑ {kanjiResult.meaning}
                                                    </div>
                                                )}
                                            </div>

                                            <div style={{
                                                display: 'flex',
                                                gap: '1rem',
                                                flexWrap: 'wrap'
                                            }}>
                                                <button
                                                    className="btn btn-success"
                                                    onClick={() => playPronunciation(kanjiResult.hiragana)}
                                                    style={{ fontSize: '0.9rem' }}
                                                >
                                                    üîä Î∞úÏùå Îì£Í∏∞
                                                </button>

                                                <button
                                                    className="btn btn-info"
                                                    onClick={() => copyToClipboard(kanjiResult.hiragana)}
                                                    style={{ fontSize: '0.9rem' }}
                                                >
                                                    üìã ÌûàÎùºÍ∞ÄÎÇò Î≥µÏÇ¨
                                                </button>

                                                <button
                                                    className="btn btn-warning"
                                                    onClick={() => addKanjiToWordlist(kanjiResult)}
                                                    style={{ fontSize: '0.9rem' }}
                                                >
                                                    ‚ûï Îã®Ïñ¥Ïû•Ïóê Ï∂îÍ∞Ä
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {kanjiError && (
                                        <div style={{
                                            background: 'rgba(231, 76, 60, 0.1)',
                                            border: '2px solid rgba(231, 76, 60, 0.3)',
                                            borderRadius: '12px',
                                            padding: '1.5rem',
                                            marginBottom: '2rem'
                                        }}>
                                            <div style={{ color: '#e74c3c', fontWeight: 'bold', marginBottom: '0.5rem' }}>
                                                ‚ùå Ï°∞Ìöå Ïã§Ìå®
                                            </div>
                                            <div style={{ color: '#2c3e50', marginBottom: '1rem' }}>
                                                {kanjiError}
                                            </div>
                                            <div style={{
                                                fontSize: '0.9rem',
                                                color: '#7f8c8d',
                                                borderTop: '1px solid rgba(231, 76, 60, 0.2)',
                                                paddingTop: '0.8rem'
                                            }}>
                                                üí° Îã§ÏùåÏùÑ ÏãúÎèÑÌï¥Î≥¥ÏÑ∏Ïöî:
                                                <ul style={{ margin: '0.5rem 0 0 1rem', padding: 0 }}>
                                                    <li>Ï†ïÌôïÌïú ÌïúÏûêÏù∏ÏßÄ ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî</li>
                                                    <li>Îã®Ïñ¥Ïû•Ïóê Î®ºÏ†Ä Ï∂îÍ∞ÄÌïú ÌõÑ Ï°∞ÌöåÌï¥Î≥¥ÏÑ∏Ïöî</li>
                                                    <li>Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî</li>
                                                </ul>
                                            </div>
                                        </div>
                                    )}

                                    <div style={{
                                        background: 'rgba(52, 152, 219, 0.1)',
                                        border: '1px solid rgba(52, 152, 219, 0.3)',
                                        borderRadius: '12px',
                                        padding: '1.5rem'
                                    }}>
                                        <h4 style={{ color: '#3498db', marginBottom: '1rem' }}>üí° ÏÇ¨Ïö© ÌåÅ</h4>
                                        <ul style={{ color: '#666', paddingLeft: '1.5rem', margin: 0 }}>
                                            <li>ÌïúÏûê Îã®Ïñ¥Î•º ÏûÖÎ†•ÌïòÎ©¥ ÌûàÎùºÍ∞ÄÎÇò Î∞úÏùåÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§</li>
                                            <li>Enter ÌÇ§Î•º ÎàåÎü¨ÏÑúÎèÑ Îπ†Î•¥Í≤å Ï°∞ÌöåÌï† Ïàò ÏûàÏäµÎãàÎã§</li>
                                            <li>Î∞úÏùå Îì£Í∏∞ Î≤ÑÌäºÏúºÎ°ú Ï†ïÌôïÌïú Î∞úÏùåÏùÑ Îì§Ïñ¥Î≥¥ÏÑ∏Ïöî</li>
                                            <li>Ïú†Ïö©Ìïú Îã®Ïñ¥Îäî Î∞îÎ°ú Îã®Ïñ¥Ïû•Ïóê Ï∂îÍ∞ÄÌï† Ïàò ÏûàÏäµÎãàÎã§</li>
                                            <li>üìç Ï∂úÏ≤ò ÌëúÏãúÎ°ú Ïñ¥ÎîîÏÑú Ï∞æÏùÄ Ï†ïÎ≥¥Ïù∏ÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî</li>
                                            <li>Îã®Ïñ¥Ïû•Ïóê ÏóÜÎäî Îã®Ïñ¥ÎèÑ Jisho APIÎ°ú ÏûêÎèô Í≤ÄÏÉâÎê©ÎãàÎã§</li>
                                        </ul>
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<JapaneseStudyApp />);
    </script>
    
    <!-- PWA ÏÑúÎπÑÏä§ ÏõåÏª§ Îì±Î°ù -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker Îì±Î°ù ÏÑ±Í≥µ: ', registration.scope);
                    }, function(err) {
                        console.log('ServiceWorker Îì±Î°ù Ïã§Ìå®: ', err);
                    });
            });
        }
        
        // PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA ÏÑ§Ïπò Í∞ÄÎä•!');
            e.preventDefault();
            deferredPrompt = e;
            
            // ÏÑ§Ïπò ÏïàÎÇ¥ ÌëúÏãú (3Ï¥à ÌõÑ)
            setTimeout(() => {
                if (confirm('üì± Ïù¥ Ïï±ÏùÑ Ìôà ÌôîÎ©¥Ïóê ÏÑ§ÏπòÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÑ§ÏπòÌïòÎ©¥ Îçî Îπ†Î•¥Í≥† Ìé∏Î¶¨ÌïòÍ≤å ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏñ¥Ïöî!')) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('ÏÇ¨Ïö©ÏûêÍ∞Ä PWA ÏÑ§ÏπòÎ•º ÌóàÏö©ÌñàÏäµÎãàÎã§');
                        } else {
                            console.log('ÏÇ¨Ïö©ÏûêÍ∞Ä PWA ÏÑ§ÏπòÎ•º Í±∞Î∂ÄÌñàÏäµÎãàÎã§');
                        }
                        deferredPrompt = null;
                    });
                }
            }, 3000);
        });
    </script>
</body>
</html>